<%
// Safe defaults for potentially undefined variables
const safeTheme = typeof theme !== 'undefined' ? theme : 'dark';
%>
<%- include('../partials/header', { pageTitle: 'Earnings Whispers' }) %>

<!-- Bloomberg Header Bar -->
<div class="bg-slate-900 border-l-4 border-green-400 px-6 py-4 mb-6">
<div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
<div>
<h1 class="text-2xl font-bold text-green-400 font-mono">EARNINGS WHISPERS</h1>
<p class="text-slate-400 text-sm mt-1">Whisper numbers & consensus expectations</p>
</div>
<div class="flex gap-2">
<select class="bloomberg-btn w-36"><option selected>This Week</option><option>Next Week</option><option>This Month</option></select>
</div>
</div>
</div>

<!-- Whisper Summary -->
<div class="bloomberg-card p-5 bg-gradient-to-r from-green-900/20 to-emerald-900/20">
<h3 class="font-semibold text-green-400 mb-4 font-mono">THIS WEEK'S WHISPER INSIGHTS</h3>
<div class="grid grid-cols-2 md:grid-cols-5 gap-4">
<div class="text-center">
<p class="text-sm text-slate-400">Reporting</p>
<p class="text-3xl font-bold text-purple-400 font-mono">24</p>
<p class="text-xs text-slate-400">holdings this week</p>
</div>
<div class="text-center">
<p class="text-sm text-slate-400">Whisper > Consensus</p>
<p class="text-3xl font-bold text-emerald-400 font-mono">16</p>
<p class="text-xs text-emerald-400">bullish setup</p>
</div>
<div class="text-center">
<p class="text-sm text-slate-400">Whisper < Consensus</p>
<p class="text-3xl font-bold text-red-400 font-mono">5</p>
<p class="text-xs text-red-400">bearish setup</p>
</div>
<div class="text-center">
<p class="text-sm text-slate-400">In-Line</p>
<p class="text-3xl font-bold text-white font-mono">3</p>
<p class="text-xs text-slate-400">neutral</p>
</div>
<div class="text-center">
<p class="text-sm text-slate-400">Avg Whisper vs Est</p>
<p class="text-3xl font-bold text-emerald-400 font-mono">+4.2%</p>
<p class="text-xs text-slate-400">above consensus</p>
</div>
</div>
</div>

<!-- Upcoming Earnings with Whispers -->
<div class="card overflow-hidden">
<div class="p-4 border-b <%= theme === 'light' ? 'border-gray-200' : 'border-slate-700' %>">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">ðŸ”® Whisper Numbers vs Consensus</h3>
</div>
<table class="w-full text-sm">
<thead>
<tr class="<%= theme === 'light' ? 'bg-gray-50 text-gray-500' : 'bg-slate-800 text-slate-400' %> text-left">
<th class="px-4 py-3">Stock</th>
<th class="px-4 py-3 text-center">Report Date</th>
<th class="px-4 py-3 text-center">Consensus EPS</th>
<th class="px-4 py-3 text-center">Whisper EPS</th>
<th class="px-4 py-3 text-center">Difference</th>
<th class="px-4 py-3 text-center">Last Q Beat</th>
<th class="px-4 py-3 text-center">Signal</th>
</tr>
</thead>
<tbody class="<%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">
<tr class="border-b <%= theme === 'light' ? 'border-gray-100 bg-emerald-50/30' : 'border-slate-700/50 bg-emerald-500/5' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold">NVDA</div><span class="font-medium">NVIDIA</span></div></td>
<td class="px-4 py-3 text-center text-green-400">Jan 28 AMC</td>
<td class="px-4 py-3 text-center">$0.74</td>
<td class="px-4 py-3 text-center font-bold text-emerald-400">$0.82</td>
<td class="px-4 py-3 text-center text-emerald-400 font-bold">+10.8%</td>
<td class="px-4 py-3 text-center text-emerald-400">+12.4%</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 text-xs">Strong Buy</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100 bg-emerald-50/30' : 'border-slate-700/50 bg-emerald-500/5' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">META</div><span class="font-medium">Meta</span></div></td>
<td class="px-4 py-3 text-center text-green-400">Jan 29 AMC</td>
<td class="px-4 py-3 text-center">$5.28</td>
<td class="px-4 py-3 text-center font-bold text-emerald-400">$5.48</td>
<td class="px-4 py-3 text-center text-emerald-400 font-bold">+3.8%</td>
<td class="px-4 py-3 text-center text-emerald-400">+8.2%</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 text-xs">Bullish</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">MSFT</div><span class="font-medium">Microsoft</span></div></td>
<td class="px-4 py-3 text-center text-green-400">Jan 30 AMC</td>
<td class="px-4 py-3 text-center">$3.12</td>
<td class="px-4 py-3 text-center font-bold">$3.16</td>
<td class="px-4 py-3 text-center text-emerald-400">+1.3%</td>
<td class="px-4 py-3 text-center text-emerald-400">+4.8%</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-sky-500/20 text-sky-400 text-xs">Neutral</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100 bg-red-50/30' : 'border-slate-700/50 bg-red-500/5' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">INTC</div><span class="font-medium">Intel</span></div></td>
<td class="px-4 py-3 text-center text-green-400">Jan 30 AMC</td>
<td class="px-4 py-3 text-center">$0.12</td>
<td class="px-4 py-3 text-center font-bold text-red-400">$0.08</td>
<td class="px-4 py-3 text-center text-red-400 font-bold">-33.3%</td>
<td class="px-4 py-3 text-center text-red-400">-8.4%</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-red-500/20 text-red-400 text-xs">Bearish</span></td>
</tr>
<tr>
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white text-xs font-bold">TSLA</div><span class="font-medium">Tesla</span></div></td>
<td class="px-4 py-3 text-center text-green-400">Jan 29 AMC</td>
<td class="px-4 py-3 text-center">$0.72</td>
<td class="px-4 py-3 text-center font-bold text-emerald-400">$0.78</td>
<td class="px-4 py-3 text-center text-emerald-400 font-bold">+8.3%</td>
<td class="px-4 py-3 text-center text-red-400">-4.2%</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-green-500/20 text-green-400 text-xs">Mixed</span></td>
</tr>
</tbody>
</table>
</div>

<!-- Historical Whisper Accuracy -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div class="card p-5">
<h4 class="font-bold text-emerald-400 mb-3">ðŸ“ˆ Best Whisper Accuracy</h4>
<div class="space-y-2">
<div class="flex justify-between"><span>NVDA</span><span class="font-bold text-emerald-400">92% accurate</span></div>
<div class="flex justify-between"><span>AAPL</span><span class="font-bold text-emerald-400">88% accurate</span></div>
<div class="flex justify-between"><span>MSFT</span><span class="font-bold text-emerald-400">84% accurate</span></div>
</div>
</div>
<div class="card p-5">
<h4 class="font-bold text-purple-400 mb-3">ðŸŽ¯ Biggest Whisper Gaps</h4>
<p class="text-xs <%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %> mb-3">Whisper far from consensus</p>
<div class="space-y-2">
<div class="flex justify-between"><span>NVDA</span><span class="font-bold text-emerald-400">+10.8%</span></div>
<div class="flex justify-between"><span>TSLA</span><span class="font-bold text-emerald-400">+8.3%</span></div>
<div class="flex justify-between"><span>INTC</span><span class="font-bold text-red-400">-33.3%</span></div>
</div>
</div>
<div class="card p-5">
<h4 class="font-bold text-sky-400 mb-3">ðŸ“Š Whisper Stats</h4>
<div class="space-y-2">
<div class="flex justify-between"><span>Beat when whisper > cons</span><span class="font-bold text-emerald-400">78%</span></div>
<div class="flex justify-between"><span>Miss when whisper < cons</span><span class="font-bold text-red-400">68%</span></div>
<div class="flex justify-between"><span>Avg post-earnings move</span><span class="font-bold">Â±6.4%</span></div>
</div>
</div>
</div>

<!-- Charts -->
<div class="card p-5">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Whisper vs Consensus Distribution</h3>
<div class="h-48"><canvas id="whisperChart"></canvas></div>
</div>
</div></div></main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Chart(document.getElementById('whisperChart'), {
  type: 'bar',
  data: { labels: ['NVDA','META','TSLA','MSFT','AAPL','GOOGL','INTC'], datasets: [
    { label: 'Consensus', data: [0.74,5.28,0.72,3.12,2.18,1.92,0.12], backgroundColor: '#94a3b8' },
    { label: 'Whisper', data: [0.82,5.48,0.78,3.16,2.24,1.98,0.08], backgroundColor: '#10b981' }
  ]},
  options: { responsive: true, maintainAspectRatio: false }
});
</script>
<%- include('../partials/footer') %>
