<%
// Safe defaults for potentially undefined variables
const safeTheme = typeof theme !== 'undefined' ? theme : 'dark';
%>
<%- include('../partials/header', { pageTitle: 'Guidance Tracker' }) %>

<!-- Bloomberg Header Bar -->
<div class="bloomberg-header">
  <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
    <div>
      <h1 class="text-2xl font-bold text-amber-400">GUIDANCE TRACKER</h1>
      <p class="text-xs text-slate-400 uppercase tracking-wider mt-1">Company guidance vs actual performance</p>
    </div>
    <div class="flex gap-2">
      <select class="bloomberg-select w-40">
        <option selected>My Holdings</option>
        <option>Watchlist</option>
      </select>
    </div>
  </div>
</div>

<!-- Guidance Summary -->
<div class="tufte-stat-card">
  <h3 class="text-xs font-bold text-amber-400 mb-4 uppercase tracking-wider">Portfolio Guidance Summary</h3>
  <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
    <div class="text-center">
      <p class="text-xs text-slate-400 uppercase tracking-wider">Beat Guidance</p>
      <p class="text-3xl font-bold font-mono text-emerald-400 my-2">12</p>
      <p class="text-xs text-emerald-400 uppercase">holdings</p>
    </div>
    <div class="text-center">
      <p class="text-xs text-slate-400 uppercase tracking-wider">Met Guidance</p>
      <p class="text-3xl font-bold font-mono text-sky-400 my-2">3</p>
      <p class="text-xs text-slate-400 uppercase">holdings</p>
    </div>
    <div class="text-center">
      <p class="text-xs text-slate-400 uppercase tracking-wider">Missed Guidance</p>
      <p class="text-3xl font-bold font-mono text-red-400 my-2">1</p>
      <p class="text-xs text-red-400 uppercase">holding</p>
    </div>
    <div class="text-center">
      <p class="text-xs text-slate-400 uppercase tracking-wider">Raised Guidance</p>
      <p class="text-3xl font-bold font-mono text-emerald-400 my-2">8</p>
      <p class="text-xs text-emerald-400 uppercase">this quarter</p>
    </div>
    <div class="text-center">
      <p class="text-xs text-slate-400 uppercase tracking-wider">Lowered Guidance</p>
      <p class="text-3xl font-bold font-mono text-red-400 my-2">2</p>
      <p class="text-xs text-red-400 uppercase">this quarter</p>
    </div>
  </div>
</div>

<!-- Holdings Guidance Table -->
<div class="tufte-stat-card overflow-hidden">
<div class="p-4 border-b <%= safeTheme === 'light' ? 'border-gray-200' : 'border-slate-700' %>">
<h3 class="font-semibold <%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %>">Holdings Guidance vs Actuals</h3>
</div>
<table class="w-full text-sm">
<thead>
<tr class="<%= safeTheme === 'light' ? 'bg-gray-50 text-gray-500' : 'bg-slate-800 text-slate-400' %> text-left">
<th class="px-4 py-3">Stock</th>
<th class="px-4 py-3 text-center">EPS Guidance</th>
<th class="px-4 py-3 text-center">EPS Actual</th>
<th class="px-4 py-3 text-center">Revenue Guide</th>
<th class="px-4 py-3 text-center">Revenue Actual</th>
<th class="px-4 py-3 text-center">Result</th>
<th class="px-4 py-3 text-center">FY Guide Δ</th>
</tr>
</thead>
<tbody class="<%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %>">
<tr class="border-b <%= safeTheme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gray-100" : "bg-slate-800 flex items-center justify-center text-white text-xs font-bold">NVDA</div><span class="font-medium">NVIDIA</span></div></td>
<td class="px-4 py-3 text-center">$0.68-$0.72</td>
<td class="px-4 py-3 text-center font-bold text-emerald-400">$0.78</td>
<td class="px-4 py-3 text-center">$16.0B</td>
<td class="px-4 py-3 text-center font-bold text-emerald-400">$18.1B</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded <%= safeTheme === 'light' ? 'bg-gray-100 text-gray-900' : 'bg-slate-800 text-white' %> text-xs font-bold">BEAT</span></td>
<td class="px-4 py-3 text-center positive font-bold">↑ Raised</td>
</tr>
<tr class="border-b <%= safeTheme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded <%= safeTheme === 'light' ? 'bg-gray-100' : 'bg-slate-800' %> flex items-center justify-center text-white text-xs font-bold">AAPL</div><span class="font-medium">Apple</span></div></td>
<td class="px-4 py-3 text-center">$1.52-$1.58</td>
<td class="px-4 py-3 text-center font-bold text-emerald-400">$1.64</td>
<td class="px-4 py-3 text-center">$89-$93B</td>
<td class="px-4 py-3 text-center font-bold text-emerald-400">$94.9B</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded <%= safeTheme === 'light' ? 'bg-gray-100 text-gray-900' : 'bg-slate-800 text-white' %> text-xs font-bold">BEAT</span></td>
<td class="px-4 py-3 text-center text-sky-400">→ Maintained</td>
</tr>
<tr class="border-b <%= safeTheme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded <%= safeTheme === 'light' ? 'bg-gray-100' : 'bg-slate-800' %> flex items-center justify-center text-white text-xs font-bold">MSFT</div><span class="font-medium">Microsoft</span></div></td>
<td class="px-4 py-3 text-center">$2.94-$3.00</td>
<td class="px-4 py-3 text-center font-bold text-emerald-400">$3.08</td>
<td class="px-4 py-3 text-center">$63.8-$64.8B</td>
<td class="px-4 py-3 text-center font-bold text-emerald-400">$65.6B</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded <%= safeTheme === 'light' ? 'bg-gray-100 text-gray-900' : 'bg-slate-800 text-white' %> text-xs font-bold">BEAT</span></td>
<td class="px-4 py-3 text-center positive font-bold">↑ Raised</td>
</tr>
<tr class="border-b <%= safeTheme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded <%= safeTheme === 'light' ? 'bg-gray-100' : 'bg-slate-800' %> flex items-center justify-center text-white text-xs font-bold">TSLA</div><span class="font-medium">Tesla</span></div></td>
<td class="px-4 py-3 text-center">$0.72-$0.78</td>
<td class="px-4 py-3 text-center font-bold text-red-400">$0.66</td>
<td class="px-4 py-3 text-center">$24.2-$25.8B</td>
<td class="px-4 py-3 text-center font-bold text-red-400">$23.4B</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded <%= safeTheme === 'light' ? 'bg-gray-100 text-gray-900' : 'bg-slate-800 text-white' %> text-xs font-bold">MISS</span></td>
<td class="px-4 py-3 text-center negative font-bold">↓ Lowered</td>
</tr>
<tr class="border-b <%= safeTheme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded <%= safeTheme === 'light' ? 'bg-gray-100' : 'bg-slate-800' %> flex items-center justify-center text-white text-xs font-bold">JNJ</div><span class="font-medium">J&J</span></div></td>
<td class="px-4 py-3 text-center">$2.58-$2.62</td>
<td class="px-4 py-3 text-center font-bold">$2.60</td>
<td class="px-4 py-3 text-center">$21.4-$21.8B</td>
<td class="px-4 py-3 text-center font-bold">$21.6B</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded <%= safeTheme === 'light' ? 'bg-gray-100 text-gray-900' : 'bg-slate-800 text-white' %> text-xs font-bold">MET</span></td>
<td class="px-4 py-3 text-center text-sky-400">→ Maintained</td>
</tr>
</tbody>
</table>
</div>

<!-- Guidance Changes -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div class="tufte-stat-card p-5">
<h3 class="font-semibold <%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Recent Guidance Raises</h3>
<div class="space-y-3">
<div class="flex items-center justify-between p-3 rounded-lg <%= safeTheme === 'light' ? '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>' : '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>0/10' %>">
<div><span class="font-bold">NVDA</span><span class="ml-2 text-sm <%= safeTheme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">FY25 Revenue</span></div>
<div class="text-right">
<p class="positive font-bold">$125B → $135B</p>
<p class="text-xs <%= safeTheme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">+8.0%</p>
</div>
</div>
<div class="flex items-center justify-between p-3 rounded-lg <%= safeTheme === 'light' ? '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>' : '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>0/10' %>">
<div><span class="font-bold">MSFT</span><span class="ml-2 text-sm <%= safeTheme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">FY25 EPS</span></div>
<div class="text-right">
<p class="positive font-bold">$11.80 → $12.20</p>
<p class="text-xs <%= safeTheme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">+3.4%</p>
</div>
</div>
<div class="flex items-center justify-between p-3 rounded-lg <%= safeTheme === 'light' ? '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>' : '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>0/10' %>">
<div><span class="font-bold">META</span><span class="ml-2 text-sm <%= safeTheme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">FY25 Revenue</span></div>
<div class="text-right">
<p class="positive font-bold">$160B → $168B</p>
<p class="text-xs <%= safeTheme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">+5.0%</p>
</div>
</div>
</div>
</div>
<div class="tufte-stat-card p-5">
<h3 class="font-semibold <%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Recent Guidance Cuts</h3>
<div class="space-y-3">
<div class="flex items-center justify-between p-3 rounded-lg <%= safeTheme === 'light' ? '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>' : '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>0/10' %>">
<div><span class="font-bold">TSLA</span><span class="ml-2 text-sm <%= safeTheme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">FY25 Deliveries</span></div>
<div class="text-right">
<p class="negative font-bold">2.2M → 2.0M</p>
<p class="text-xs <%= safeTheme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">-9.1%</p>
</div>
</div>
<div class="flex items-center justify-between p-3 rounded-lg <%= safeTheme === 'light' ? '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>' : '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>0/10' %>">
<div><span class="font-bold">INTC</span><span class="ml-2 text-sm <%= safeTheme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">FY25 EPS</span></div>
<div class="text-right">
<p class="negative font-bold">$1.20 → $0.85</p>
<p class="text-xs <%= safeTheme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">-29.2%</p>
</div>
</div>
</div>
</div>
</div>

<!-- Chart -->
<div class="tufte-stat-card p-5">
<h3 class="font-semibold <%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Guidance Track Record (Last 8 Quarters)</h3>
<div class="h-48"><canvas id="trackChart"></canvas></div>
</div>
</div></div></main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Chart(document.getElementById('trackChart'), {
  type: 'bar',
  data: { labels: ['Q1 23','Q2 23','Q3 23','Q4 23','Q1 24','Q2 24','Q3 24','Q4 24'], datasets: [
    { label: 'Beat', data: [10,11,12,11,12,13,12,12], backgroundColor: '#10b981' },
    { label: 'Met', data: [4,3,2,3,3,2,3,3], backgroundColor: '#0ea5e9' },
    { label: 'Miss', data: [2,2,2,2,1,1,1,1], backgroundColor: '#ef4444' }
  ]},
  options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true } } }
});
</script>
<%- include('../partials/footer') %>
