<%
// Safe defaults for potentially undefined variables
const safeTheme = typeof theme !== 'undefined' ? theme : 'dark';
const safeUser = typeof user !== 'undefined' ? user : {};
%>
<%- include('../partials/header', { pageTitle: 'Dividend Forecast' }) %>

<main class="page-container px-6 py-6">
  <!-- Page Header -->
  <div class="page-header mb-8">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
      <div>
        <h1 class="page-title">Dividend Forecast</h1>
        <p class="page-subtitle">Project future income, analyze scenarios, and track your dividend goals</p>
      </div>
      <div class="flex items-center gap-3">
        <div class="live-indicator">
          <span>Live Data</span>
        </div>
        <button class="premium-btn premium-btn-secondary premium-btn-sm" onclick="exportForecast()">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
          </svg>
          Export Report
        </button>
        <button class="premium-btn premium-btn-forest premium-btn-sm" onclick="refreshForecast()">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
          </svg>
          Refresh
        </button>
      </div>
    </div>
  </div>

  <!-- Total Income Display -->
  <div class="gain-card mb-8 animate-fade-in">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 relative z-10">
      <div>
        <p class="gain-card-label mb-2">Current Annual Income</p>
        <p class="gain-card-value" id="currentIncome">$12,847</p>
        <p class="text-sm text-emerald-400/70 mt-1 font-mono">+$1,447 vs Last Year</p>
      </div>
      <div>
        <p class="gain-card-label mb-2">Projected 2026 Income</p>
        <p class="gain-card-value" id="projectedIncome">$14,634</p>
        <p class="text-sm text-emerald-400/70 mt-1 font-mono">+13.9% Growth</p>
      </div>
      <div>
        <p class="gain-card-label mb-2">5-Year Projection</p>
        <p class="gain-card-value" id="fiveYearIncome">$21,892</p>
        <p class="text-sm text-emerald-400/70 mt-1 font-mono">70.4% Total Growth</p>
      </div>
      <div>
        <p class="gain-card-label mb-2">Monthly Average</p>
        <p class="gain-card-value" id="monthlyAvg">$1,071</p>
        <p class="text-sm text-emerald-400/70 mt-1 font-mono">$35.70/day</p>
      </div>
    </div>
  </div>

  <!-- Projected Income Chart with Scenario Toggle -->
  <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-8">
    <div class="xl:col-span-2 premium-card animate-slide-up">
      <div class="chart-header">
        <div>
          <h3 class="chart-title">Income Trajectory</h3>
          <p class="chart-subtitle">5-Year dividend income projection with scenario analysis</p>
        </div>
        <div class="premium-tabs">
          <button class="premium-tab active" data-scenario="moderate" onclick="switchScenario('moderate')">Moderate</button>
          <button class="premium-tab" data-scenario="conservative" onclick="switchScenario('conservative')">Conservative</button>
          <button class="premium-tab" data-scenario="optimistic" onclick="switchScenario('optimistic')">Optimistic</button>
        </div>
      </div>
      <div class="h-80 mt-4">
        <canvas id="incomeTrajectoryChart"></canvas>
      </div>
      <div class="flex justify-center gap-8 mt-4 text-sm">
        <span class="flex items-center gap-2">
          <span class="w-3 h-3 rounded-full bg-emerald-400"></span>
          <span class="text-secondary">Historical</span>
        </span>
        <span class="flex items-center gap-2">
          <span class="w-3 h-3 rounded-full bg-indigo-400"></span>
          <span class="text-secondary">Projected</span>
        </span>
        <span class="flex items-center gap-2">
          <span class="w-3 h-1 bg-slate-500"></span>
          <span class="text-secondary">Range</span>
        </span>
      </div>
    </div>

    <!-- Scenario Analysis Panel -->
    <div class="premium-card animate-slide-up" style="animation-delay: 0.1s">
      <h3 class="premium-card-title mb-4">Scenario Analysis</h3>
      <div class="space-y-4">
        <!-- Conservative -->
        <div class="p-4 rounded-xl bg-elevated border border-subtle cursor-pointer transition-all hover:border-amber-500/30" onclick="switchScenario('conservative')">
          <div class="flex items-center justify-between mb-2">
            <span class="premium-badge premium-badge-warning">Conservative</span>
            <span class="text-xs text-tertiary">0% Growth</span>
          </div>
          <p class="text-2xl font-bold text-primary font-mono">$12,847</p>
          <p class="text-xs text-tertiary mt-1">No dividend increases assumed</p>
          <div class="mt-3">
            <p class="text-xs text-tertiary mb-1">5-Year Total</p>
            <p class="text-lg font-semibold text-amber-400 font-mono">$64,235</p>
          </div>
        </div>
        <!-- Moderate -->
        <div class="p-4 rounded-xl bg-positive-green-bg border border-positive-green-border cursor-pointer transition-all" onclick="switchScenario('moderate')">
          <div class="flex items-center justify-between mb-2">
            <span class="premium-badge premium-badge-forest">Moderate</span>
            <span class="text-xs text-emerald-400">8.4% CAGR</span>
          </div>
          <p class="text-2xl font-bold gradient-text-gain font-mono">$21,892</p>
          <p class="text-xs text-emerald-400/70 mt-1">Based on historical growth</p>
          <div class="mt-3">
            <p class="text-xs text-tertiary mb-1">5-Year Total</p>
            <p class="text-lg font-semibold text-emerald-400 font-mono">$87,428</p>
          </div>
        </div>
        <!-- Optimistic -->
        <div class="p-4 rounded-xl bg-elevated border border-subtle cursor-pointer transition-all hover:border-indigo-500/30" onclick="switchScenario('optimistic')">
          <div class="flex items-center justify-between mb-2">
            <span class="premium-badge premium-badge-indigo">Optimistic</span>
            <span class="text-xs text-indigo-400">12% CAGR</span>
          </div>
          <p class="text-2xl font-bold text-indigo-400 font-mono">$26,847</p>
          <p class="text-xs text-indigo-400/70 mt-1">Accelerated growth scenario</p>
          <div class="mt-3">
            <p class="text-xs text-tertiary mb-1">5-Year Total</p>
            <p class="text-lg font-semibold text-indigo-400 font-mono">$98,645</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Monthly Income Calendar -->
  <div class="premium-card mb-8 animate-slide-up" style="animation-delay: 0.15s">
    <div class="premium-card-header">
      <div>
        <h3 class="premium-card-title">Monthly Income Calendar</h3>
        <p class="premium-card-subtitle">Expected dividend payments by month</p>
      </div>
      <div class="flex items-center gap-3">
        <select class="premium-input premium-select w-32" id="calendarYear" onchange="updateCalendar()">
          <option value="2025">2025</option>
          <option value="2026" selected>2026</option>
          <option value="2027">2027</option>
        </select>
      </div>
    </div>
    <div class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-12 gap-3 mt-6" id="monthlyCalendar">
      <!-- January -->
      <div class="calendar-month p-3 rounded-xl bg-elevated border border-subtle hover:border-emerald-500/30 transition-all cursor-pointer" data-month="1">
        <p class="text-xs text-tertiary uppercase tracking-wider mb-2">Jan</p>
        <p class="text-lg font-bold text-primary font-mono">$892</p>
        <div class="mt-2 flex flex-wrap gap-1">
          <span class="w-5 h-5 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-[8px] text-white font-bold" title="MSFT - $156">MS</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-[8px] text-white font-bold" title="KO - $194">KO</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-[8px] text-white font-bold" title="JNJ - $248">JJ</span>
        </div>
        <div class="progress-bar mt-2 h-1">
          <div class="progress-bar-fill progress-bar-forest" style="width: 65%"></div>
        </div>
      </div>
      <!-- February -->
      <div class="calendar-month p-3 rounded-xl bg-elevated border border-subtle hover:border-emerald-500/30 transition-all cursor-pointer" data-month="2">
        <p class="text-xs text-tertiary uppercase tracking-wider mb-2">Feb</p>
        <p class="text-lg font-bold text-primary font-mono">$1,245</p>
        <div class="mt-2 flex flex-wrap gap-1">
          <span class="w-5 h-5 rounded bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-[8px] text-white font-bold" title="V - $312">V</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-[8px] text-white font-bold" title="PG - $428">PG</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center text-[8px] text-white font-bold" title="HD - $392">HD</span>
        </div>
        <div class="progress-bar mt-2 h-1">
          <div class="progress-bar-fill progress-bar-forest" style="width: 91%"></div>
        </div>
      </div>
      <!-- March -->
      <div class="calendar-month p-3 rounded-xl bg-positive-green-bg border border-positive-green-border transition-all cursor-pointer" data-month="3">
        <p class="text-xs text-emerald-400 uppercase tracking-wider mb-2">Mar</p>
        <p class="text-lg font-bold gradient-text-gain font-mono">$1,567</p>
        <div class="mt-2 flex flex-wrap gap-1">
          <span class="w-5 h-5 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-[8px] text-white font-bold">AA</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-[8px] text-white font-bold">KO</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-[8px] text-white font-bold">JJ</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center text-[8px] text-white font-bold">O</span>
        </div>
        <div class="progress-bar mt-2 h-1">
          <div class="progress-bar-fill progress-bar-gain" style="width: 100%"></div>
        </div>
      </div>
      <!-- April -->
      <div class="calendar-month p-3 rounded-xl bg-elevated border border-subtle hover:border-emerald-500/30 transition-all cursor-pointer" data-month="4">
        <p class="text-xs text-tertiary uppercase tracking-wider mb-2">Apr</p>
        <p class="text-lg font-bold text-primary font-mono">$1,102</p>
        <div class="mt-2 flex flex-wrap gap-1">
          <span class="w-5 h-5 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-[8px] text-white font-bold">MS</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-[8px] text-white font-bold">JJ</span>
        </div>
        <div class="progress-bar mt-2 h-1">
          <div class="progress-bar-fill progress-bar-forest" style="width: 80%"></div>
        </div>
      </div>
      <!-- May -->
      <div class="calendar-month p-3 rounded-xl bg-elevated border border-subtle hover:border-emerald-500/30 transition-all cursor-pointer" data-month="5">
        <p class="text-xs text-tertiary uppercase tracking-wider mb-2">May</p>
        <p class="text-lg font-bold text-primary font-mono">$1,334</p>
        <div class="mt-2 flex flex-wrap gap-1">
          <span class="w-5 h-5 rounded bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-[8px] text-white font-bold">V</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-[8px] text-white font-bold">PG</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center text-[8px] text-white font-bold">HD</span>
        </div>
        <div class="progress-bar mt-2 h-1">
          <div class="progress-bar-fill progress-bar-forest" style="width: 97%"></div>
        </div>
      </div>
      <!-- June -->
      <div class="calendar-month p-3 rounded-xl bg-positive-green-bg border border-positive-green-border transition-all cursor-pointer" data-month="6">
        <p class="text-xs text-emerald-400 uppercase tracking-wider mb-2">Jun</p>
        <p class="text-lg font-bold gradient-text-gain font-mono">$1,489</p>
        <div class="mt-2 flex flex-wrap gap-1">
          <span class="w-5 h-5 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-[8px] text-white font-bold">AA</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-[8px] text-white font-bold">KO</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-[8px] text-white font-bold">JJ</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center text-[8px] text-white font-bold">UN</span>
        </div>
        <div class="progress-bar mt-2 h-1">
          <div class="progress-bar-fill progress-bar-gain" style="width: 100%"></div>
        </div>
      </div>
      <!-- July -->
      <div class="calendar-month p-3 rounded-xl bg-elevated border border-subtle hover:border-emerald-500/30 transition-all cursor-pointer" data-month="7">
        <p class="text-xs text-tertiary uppercase tracking-wider mb-2">Jul</p>
        <p class="text-lg font-bold text-primary font-mono">$978</p>
        <div class="mt-2 flex flex-wrap gap-1">
          <span class="w-5 h-5 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-[8px] text-white font-bold">MS</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-[8px] text-white font-bold">JJ</span>
        </div>
        <div class="progress-bar mt-2 h-1">
          <div class="progress-bar-fill progress-bar-forest" style="width: 71%"></div>
        </div>
      </div>
      <!-- August -->
      <div class="calendar-month p-3 rounded-xl bg-elevated border border-subtle hover:border-emerald-500/30 transition-all cursor-pointer" data-month="8">
        <p class="text-xs text-tertiary uppercase tracking-wider mb-2">Aug</p>
        <p class="text-lg font-bold text-primary font-mono">$1,156</p>
        <div class="mt-2 flex flex-wrap gap-1">
          <span class="w-5 h-5 rounded bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-[8px] text-white font-bold">V</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-[8px] text-white font-bold">PG</span>
        </div>
        <div class="progress-bar mt-2 h-1">
          <div class="progress-bar-fill progress-bar-forest" style="width: 84%"></div>
        </div>
      </div>
      <!-- September -->
      <div class="calendar-month p-3 rounded-xl bg-positive-green-bg border border-positive-green-border transition-all cursor-pointer" data-month="9">
        <p class="text-xs text-emerald-400 uppercase tracking-wider mb-2">Sep</p>
        <p class="text-lg font-bold gradient-text-gain font-mono">$1,523</p>
        <div class="mt-2 flex flex-wrap gap-1">
          <span class="w-5 h-5 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-[8px] text-white font-bold">AA</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-[8px] text-white font-bold">KO</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-[8px] text-white font-bold">JJ</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center text-[8px] text-white font-bold">O</span>
        </div>
        <div class="progress-bar mt-2 h-1">
          <div class="progress-bar-fill progress-bar-gain" style="width: 100%"></div>
        </div>
      </div>
      <!-- October -->
      <div class="calendar-month p-3 rounded-xl bg-elevated border border-subtle hover:border-emerald-500/30 transition-all cursor-pointer" data-month="10">
        <p class="text-xs text-tertiary uppercase tracking-wider mb-2">Oct</p>
        <p class="text-lg font-bold text-primary font-mono">$1,045</p>
        <div class="mt-2 flex flex-wrap gap-1">
          <span class="w-5 h-5 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-[8px] text-white font-bold">MS</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-[8px] text-white font-bold">JJ</span>
        </div>
        <div class="progress-bar mt-2 h-1">
          <div class="progress-bar-fill progress-bar-forest" style="width: 76%"></div>
        </div>
      </div>
      <!-- November -->
      <div class="calendar-month p-3 rounded-xl bg-elevated border border-subtle hover:border-emerald-500/30 transition-all cursor-pointer" data-month="11">
        <p class="text-xs text-tertiary uppercase tracking-wider mb-2">Nov</p>
        <p class="text-lg font-bold text-primary font-mono">$1,278</p>
        <div class="mt-2 flex flex-wrap gap-1">
          <span class="w-5 h-5 rounded bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-[8px] text-white font-bold">V</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-[8px] text-white font-bold">PG</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center text-[8px] text-white font-bold">HD</span>
        </div>
        <div class="progress-bar mt-2 h-1">
          <div class="progress-bar-fill progress-bar-forest" style="width: 93%"></div>
        </div>
      </div>
      <!-- December -->
      <div class="calendar-month p-3 rounded-xl bg-positive-green-bg border border-positive-green-border transition-all cursor-pointer" data-month="12">
        <p class="text-xs text-emerald-400 uppercase tracking-wider mb-2">Dec</p>
        <p class="text-lg font-bold gradient-text-gain font-mono">$1,625</p>
        <div class="mt-2 flex flex-wrap gap-1">
          <span class="w-5 h-5 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-[8px] text-white font-bold">AA</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-[8px] text-white font-bold">KO</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-[8px] text-white font-bold">JJ</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center text-[8px] text-white font-bold">UN</span>
          <span class="w-5 h-5 rounded bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center text-[8px] text-white font-bold">O</span>
        </div>
        <div class="progress-bar mt-2 h-1">
          <div class="progress-bar-fill progress-bar-gain" style="width: 100%"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Income by Holding Table -->
  <div class="premium-card mb-8 animate-slide-up" style="animation-delay: 0.2s">
    <div class="premium-card-header">
      <div>
        <h3 class="premium-card-title">Income by Holding</h3>
        <p class="premium-card-subtitle">Detailed breakdown of dividend income from each position</p>
      </div>
      <div class="flex items-center gap-2">
        <button class="premium-btn premium-btn-ghost premium-btn-sm" onclick="sortTable('yield')">
          Sort by Yield
        </button>
        <button class="premium-btn premium-btn-ghost premium-btn-sm" onclick="sortTable('income')">
          Sort by Income
        </button>
      </div>
    </div>
    <div class="overflow-x-auto mt-4">
      <table class="premium-table" id="holdingsTable">
        <thead>
          <tr>
            <th class="cursor-pointer hover:text-indigo-400" onclick="sortTable('symbol')">Symbol</th>
            <th class="cursor-pointer hover:text-indigo-400 text-right" onclick="sortTable('annualDiv')">Annual Dividend</th>
            <th class="cursor-pointer hover:text-indigo-400 text-right" onclick="sortTable('yield')">Yield</th>
            <th class="cursor-pointer hover:text-indigo-400 text-right" onclick="sortTable('growth')">5Y Growth</th>
            <th class="cursor-pointer hover:text-indigo-400 text-right" onclick="sortTable('income')">Your Income</th>
            <th class="cursor-pointer hover:text-indigo-400 text-right" onclick="sortTable('percent')">% of Total</th>
            <th>Contribution</th>
          </tr>
        </thead>
        <tbody>
          <tr class="row-positive">
            <td>
              <div class="symbol-badge">
                <div class="symbol-icon bg-gradient-to-br from-amber-500 to-amber-600">JNJ</div>
                <div>
                  <p class="symbol-name">Johnson & Johnson</p>
                  <p class="symbol-company">Healthcare</p>
                </div>
              </div>
            </td>
            <td class="text-right font-mono text-primary">$4.96</td>
            <td class="text-right font-mono value-gain">3.12%</td>
            <td class="text-right font-mono value-positive">+6.1%</td>
            <td class="text-right font-mono font-bold gradient-text-gain">$2,480</td>
            <td class="text-right font-mono text-secondary">19.3%</td>
            <td>
              <div class="w-full max-w-24">
                <div class="progress-bar h-2">
                  <div class="progress-bar-fill progress-bar-gain" style="width: 19.3%"></div>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="symbol-badge">
                <div class="symbol-icon bg-gradient-to-br from-sky-500 to-sky-600">MSFT</div>
                <div>
                  <p class="symbol-name">Microsoft</p>
                  <p class="symbol-company">Technology</p>
                </div>
              </div>
            </td>
            <td class="text-right font-mono text-primary">$3.00</td>
            <td class="text-right font-mono text-secondary">0.72%</td>
            <td class="text-right font-mono value-positive">+10.8%</td>
            <td class="text-right font-mono font-bold text-primary">$1,875</td>
            <td class="text-right font-mono text-secondary">14.6%</td>
            <td>
              <div class="w-full max-w-24">
                <div class="progress-bar h-2">
                  <div class="progress-bar-fill progress-bar-forest" style="width: 14.6%"></div>
                </div>
              </div>
            </td>
          </tr>
          <tr class="row-positive">
            <td>
              <div class="symbol-badge">
                <div class="symbol-icon bg-gradient-to-br from-red-500 to-red-600">KO</div>
                <div>
                  <p class="symbol-name">Coca-Cola</p>
                  <p class="symbol-company">Consumer Staples</p>
                </div>
              </div>
            </td>
            <td class="text-right font-mono text-primary">$1.94</td>
            <td class="text-right font-mono value-gain">3.05%</td>
            <td class="text-right font-mono value-positive">+3.8%</td>
            <td class="text-right font-mono font-bold gradient-text-gain">$1,746</td>
            <td class="text-right font-mono text-secondary">13.6%</td>
            <td>
              <div class="w-full max-w-24">
                <div class="progress-bar h-2">
                  <div class="progress-bar-fill progress-bar-gain" style="width: 13.6%"></div>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="symbol-badge">
                <div class="symbol-icon bg-gradient-to-br from-blue-500 to-blue-600">PG</div>
                <div>
                  <p class="symbol-name">Procter & Gamble</p>
                  <p class="symbol-company">Consumer Staples</p>
                </div>
              </div>
            </td>
            <td class="text-right font-mono text-primary">$4.03</td>
            <td class="text-right font-mono text-secondary">2.48%</td>
            <td class="text-right font-mono value-positive">+6.2%</td>
            <td class="text-right font-mono font-bold text-primary">$1,612</td>
            <td class="text-right font-mono text-secondary">12.5%</td>
            <td>
              <div class="w-full max-w-24">
                <div class="progress-bar h-2">
                  <div class="progress-bar-fill progress-bar-forest" style="width: 12.5%"></div>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="symbol-badge">
                <div class="symbol-icon bg-gradient-to-br from-green-500 to-green-600">O</div>
                <div>
                  <p class="symbol-name">Realty Income</p>
                  <p class="symbol-company">Real Estate</p>
                </div>
              </div>
            </td>
            <td class="text-right font-mono text-primary">$3.08</td>
            <td class="text-right font-mono value-gain">5.62%</td>
            <td class="text-right font-mono value-positive">+3.1%</td>
            <td class="text-right font-mono font-bold text-primary">$1,232</td>
            <td class="text-right font-mono text-secondary">9.6%</td>
            <td>
              <div class="w-full max-w-24">
                <div class="progress-bar h-2">
                  <div class="progress-bar-fill progress-bar-forest" style="width: 9.6%"></div>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="symbol-badge">
                <div class="symbol-icon bg-gradient-to-br from-purple-500 to-purple-600">V</div>
                <div>
                  <p class="symbol-name">Visa</p>
                  <p class="symbol-company">Financials</p>
                </div>
              </div>
            </td>
            <td class="text-right font-mono text-primary">$2.08</td>
            <td class="text-right font-mono text-secondary">0.76%</td>
            <td class="text-right font-mono value-positive">+17.2%</td>
            <td class="text-right font-mono font-bold text-primary">$1,040</td>
            <td class="text-right font-mono text-secondary">8.1%</td>
            <td>
              <div class="w-full max-w-24">
                <div class="progress-bar h-2">
                  <div class="progress-bar-fill progress-bar-forest" style="width: 8.1%"></div>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="symbol-badge">
                <div class="symbol-icon bg-gradient-to-br from-orange-500 to-orange-600">HD</div>
                <div>
                  <p class="symbol-name">Home Depot</p>
                  <p class="symbol-company">Consumer Disc.</p>
                </div>
              </div>
            </td>
            <td class="text-right font-mono text-primary">$8.90</td>
            <td class="text-right font-mono text-secondary">2.31%</td>
            <td class="text-right font-mono value-positive">+12.4%</td>
            <td class="text-right font-mono font-bold text-primary">$890</td>
            <td class="text-right font-mono text-secondary">6.9%</td>
            <td>
              <div class="w-full max-w-24">
                <div class="progress-bar h-2">
                  <div class="progress-bar-fill progress-bar-forest" style="width: 6.9%"></div>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="symbol-badge">
                <div class="symbol-icon bg-gradient-to-br from-teal-500 to-teal-600">UNH</div>
                <div>
                  <p class="symbol-name">UnitedHealth</p>
                  <p class="symbol-company">Healthcare</p>
                </div>
              </div>
            </td>
            <td class="text-right font-mono text-primary">$7.52</td>
            <td class="text-right font-mono text-secondary">1.42%</td>
            <td class="text-right font-mono value-positive">+14.8%</td>
            <td class="text-right font-mono font-bold text-primary">$752</td>
            <td class="text-right font-mono text-secondary">5.9%</td>
            <td>
              <div class="w-full max-w-24">
                <div class="progress-bar h-2">
                  <div class="progress-bar-fill progress-bar-forest" style="width: 5.9%"></div>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="symbol-badge">
                <div class="symbol-icon bg-gradient-to-br from-sky-400 to-sky-500">AAPL</div>
                <div>
                  <p class="symbol-name">Apple</p>
                  <p class="symbol-company">Technology</p>
                </div>
              </div>
            </td>
            <td class="text-right font-mono text-primary">$0.96</td>
            <td class="text-right font-mono text-secondary">0.52%</td>
            <td class="text-right font-mono value-positive">+6.2%</td>
            <td class="text-right font-mono font-bold text-primary">$720</td>
            <td class="text-right font-mono text-secondary">5.6%</td>
            <td>
              <div class="w-full max-w-24">
                <div class="progress-bar h-2">
                  <div class="progress-bar-fill progress-bar-forest" style="width: 5.6%"></div>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <div class="symbol-badge">
                <div class="symbol-icon bg-gradient-to-br from-red-400 to-red-500">T</div>
                <div>
                  <p class="symbol-name">AT&T</p>
                  <p class="symbol-company">Telecom</p>
                </div>
              </div>
            </td>
            <td class="text-right font-mono text-primary">$1.11</td>
            <td class="text-right font-mono value-gain">6.28%</td>
            <td class="text-right font-mono value-negative">-8.2%</td>
            <td class="text-right font-mono font-bold text-primary">$500</td>
            <td class="text-right font-mono text-secondary">3.9%</td>
            <td>
              <div class="w-full max-w-24">
                <div class="progress-bar h-2">
                  <div class="progress-bar-fill progress-bar-forest" style="width: 3.9%"></div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- DRIP vs Cash Analysis & Dividend Safety -->
  <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8">
    <!-- DRIP vs Cash Analysis -->
    <div class="premium-card animate-slide-up" style="animation-delay: 0.25s">
      <div class="premium-card-header">
        <div>
          <h3 class="premium-card-title">DRIP vs Cash Analysis</h3>
          <p class="premium-card-subtitle">Compare reinvesting dividends vs taking cash</p>
        </div>
        <div class="premium-tabs">
          <button class="premium-tab active" data-drip="5" onclick="updateDripChart(5)">5Y</button>
          <button class="premium-tab" data-drip="10" onclick="updateDripChart(10)">10Y</button>
          <button class="premium-tab" data-drip="20" onclick="updateDripChart(20)">20Y</button>
        </div>
      </div>
      <div class="h-64 mt-4">
        <canvas id="dripChart"></canvas>
      </div>
      <div class="grid grid-cols-2 gap-4 mt-6">
        <div class="stat-card-forest">
          <p class="stat-label">With DRIP (5Y)</p>
          <p class="stat-value gradient-text-gain">$98,234</p>
          <p class="text-xs text-emerald-400/70 mt-1">Total portfolio value</p>
        </div>
        <div class="stat-card p-4">
          <p class="stat-label">Cash Only (5Y)</p>
          <p class="stat-value text-primary">$82,456</p>
          <p class="text-xs text-tertiary mt-1">+ $64,235 cash received</p>
        </div>
      </div>
      <div class="mt-4 p-4 rounded-xl bg-positive-green-bg border border-positive-green-border">
        <div class="flex items-center gap-3">
          <div class="icon-box-forest">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
            </svg>
          </div>
          <div>
            <p class="text-sm font-semibold text-emerald-400">DRIP Advantage</p>
            <p class="text-xs text-emerald-400/70">Reinvesting yields <span class="font-bold">$15,778 more</span> over 5 years</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Dividend Safety Scores -->
    <div class="premium-card animate-slide-up" style="animation-delay: 0.3s">
      <div class="premium-card-header">
        <div>
          <h3 class="premium-card-title">Dividend Safety Scores</h3>
          <p class="premium-card-subtitle">Risk assessment for each holding</p>
        </div>
        <span class="premium-badge premium-badge-success">Portfolio: Safe</span>
      </div>
      <div class="space-y-3 mt-4">
        <!-- JNJ -->
        <div class="p-3 rounded-xl bg-elevated border border-subtle hover:border-emerald-500/20 transition-all">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-white text-xs font-bold">JNJ</div>
              <div>
                <p class="font-semibold text-sm text-primary">Johnson & Johnson</p>
                <p class="text-xs text-tertiary">62 year streak</p>
              </div>
            </div>
            <span class="premium-badge premium-badge-success">Very Safe</span>
          </div>
          <div class="grid grid-cols-3 gap-3 mt-3">
            <div>
              <p class="text-xs text-tertiary">Payout Ratio</p>
              <p class="text-sm font-mono font-semibold text-emerald-400">44%</p>
            </div>
            <div>
              <p class="text-xs text-tertiary">FCF Coverage</p>
              <p class="text-sm font-mono font-semibold text-emerald-400">2.3x</p>
            </div>
            <div>
              <p class="text-xs text-tertiary">Debt/EBITDA</p>
              <p class="text-sm font-mono font-semibold text-emerald-400">1.2x</p>
            </div>
          </div>
        </div>
        <!-- KO -->
        <div class="p-3 rounded-xl bg-elevated border border-subtle hover:border-emerald-500/20 transition-all">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white text-xs font-bold">KO</div>
              <div>
                <p class="font-semibold text-sm text-primary">Coca-Cola</p>
                <p class="text-xs text-tertiary">62 year streak</p>
              </div>
            </div>
            <span class="premium-badge premium-badge-success">Safe</span>
          </div>
          <div class="grid grid-cols-3 gap-3 mt-3">
            <div>
              <p class="text-xs text-tertiary">Payout Ratio</p>
              <p class="text-sm font-mono font-semibold text-amber-400">68%</p>
            </div>
            <div>
              <p class="text-xs text-tertiary">FCF Coverage</p>
              <p class="text-sm font-mono font-semibold text-emerald-400">1.5x</p>
            </div>
            <div>
              <p class="text-xs text-tertiary">Debt/EBITDA</p>
              <p class="text-sm font-mono font-semibold text-emerald-400">2.1x</p>
            </div>
          </div>
        </div>
        <!-- O -->
        <div class="p-3 rounded-xl bg-elevated border border-subtle hover:border-emerald-500/20 transition-all">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center text-white text-xs font-bold">O</div>
              <div>
                <p class="font-semibold text-sm text-primary">Realty Income</p>
                <p class="text-xs text-tertiary">29 year streak</p>
              </div>
            </div>
            <span class="premium-badge premium-badge-success">Safe</span>
          </div>
          <div class="grid grid-cols-3 gap-3 mt-3">
            <div>
              <p class="text-xs text-tertiary">AFFO Payout</p>
              <p class="text-sm font-mono font-semibold text-amber-400">76%</p>
            </div>
            <div>
              <p class="text-xs text-tertiary">Occupancy</p>
              <p class="text-sm font-mono font-semibold text-emerald-400">98.7%</p>
            </div>
            <div>
              <p class="text-xs text-tertiary">Debt/EBITDA</p>
              <p class="text-sm font-mono font-semibold text-emerald-400">5.4x</p>
            </div>
          </div>
        </div>
        <!-- T - Warning -->
        <div class="p-3 rounded-xl bg-elevated border border-amber-500/30 transition-all">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded bg-gradient-to-br from-red-400 to-red-500 flex items-center justify-center text-white text-xs font-bold">T</div>
              <div>
                <p class="font-semibold text-sm text-primary">AT&T</p>
                <p class="text-xs text-tertiary">2 year streak (after cut)</p>
              </div>
            </div>
            <span class="premium-badge premium-badge-warning">Monitor</span>
          </div>
          <div class="grid grid-cols-3 gap-3 mt-3">
            <div>
              <p class="text-xs text-tertiary">Payout Ratio</p>
              <p class="text-sm font-mono font-semibold text-amber-400">52%</p>
            </div>
            <div>
              <p class="text-xs text-tertiary">FCF Coverage</p>
              <p class="text-sm font-mono font-semibold text-amber-400">1.1x</p>
            </div>
            <div>
              <p class="text-xs text-tertiary">Debt/EBITDA</p>
              <p class="text-sm font-mono font-semibold text-red-400">3.2x</p>
            </div>
          </div>
          <div class="mt-2 p-2 rounded-lg bg-amber-500/10 border border-amber-500/20">
            <p class="text-xs text-amber-400">Previously cut dividend by 47% in 2022. High debt load remains a concern.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Income Goal Tracker -->
  <div class="wealth-card mb-8 animate-slide-up" style="animation-delay: 0.35s">
    <div class="relative z-10">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6 mb-6">
        <div>
          <h3 class="text-xl font-bold text-primary mb-1">Income Goal Tracker</h3>
          <p class="text-sm text-secondary">Track progress toward your annual dividend income goal</p>
        </div>
        <div class="flex items-center gap-4">
          <div>
            <label class="text-xs text-tertiary block mb-1">Annual Goal</label>
            <div class="flex items-center gap-2">
              <span class="text-lg text-secondary">$</span>
              <input type="number" id="incomeGoal" class="premium-input w-32 text-lg font-mono font-bold" value="20000" onchange="updateGoalProgress()">
            </div>
          </div>
          <button class="premium-btn premium-btn-forest" onclick="updateGoalProgress()">
            Update Goal
          </button>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="mb-6">
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm text-secondary">Current Progress</span>
          <span class="text-sm font-mono font-bold gradient-text-gain" id="progressPercent">64.2%</span>
        </div>
        <div class="progress-bar h-4 rounded-full">
          <div class="progress-bar-fill progress-bar-gain h-full rounded-full transition-all duration-500" id="progressBar" style="width: 64.2%"></div>
        </div>
        <div class="flex items-center justify-between mt-2">
          <span class="text-sm font-mono text-emerald-400">$12,847 earned</span>
          <span class="text-sm font-mono text-tertiary">$7,153 to go</span>
        </div>
      </div>

      <!-- Goal Achievement Projection -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="p-4 rounded-xl bg-white/5 border border-white/10">
          <p class="text-xs text-tertiary uppercase tracking-wider mb-2">Time to Goal</p>
          <p class="text-2xl font-bold text-primary font-mono">2.8 years</p>
          <p class="text-xs text-secondary mt-1">At current growth rate</p>
        </div>
        <div class="p-4 rounded-xl bg-white/5 border border-white/10">
          <p class="text-xs text-tertiary uppercase tracking-wider mb-2">Monthly Shortfall</p>
          <p class="text-2xl font-bold text-amber-400 font-mono">$596</p>
          <p class="text-xs text-secondary mt-1">Needed per month</p>
        </div>
        <div class="p-4 rounded-xl bg-positive-green-bg border border-positive-green-border">
          <p class="text-xs text-emerald-400 uppercase tracking-wider mb-2">With DRIP Enabled</p>
          <p class="text-2xl font-bold gradient-text-gain font-mono">2.1 years</p>
          <p class="text-xs text-emerald-400/70 mt-1">Faster with reinvestment</p>
        </div>
      </div>

      <!-- What to Buy Section -->
      <div>
        <h4 class="text-sm font-semibold text-primary mb-4">Recommended Purchases to Reach Goal</h4>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <!-- SCHD -->
          <div class="p-4 rounded-xl bg-white/5 border border-white/10 hover:border-emerald-500/30 transition-all cursor-pointer">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-500 to-indigo-600 flex items-center justify-center text-white text-xs font-bold">SCHD</div>
              <div>
                <p class="font-semibold text-sm text-primary">Schwab US Div Equity</p>
                <p class="text-xs text-tertiary">3.52% yield</p>
              </div>
            </div>
            <div class="space-y-1">
              <div class="flex justify-between text-xs">
                <span class="text-tertiary">Invest</span>
                <span class="font-mono font-semibold text-primary">$10,000</span>
              </div>
              <div class="flex justify-between text-xs">
                <span class="text-tertiary">Annual Income</span>
                <span class="font-mono font-semibold text-emerald-400">+$352</span>
              </div>
            </div>
          </div>
          <!-- VYM -->
          <div class="p-4 rounded-xl bg-white/5 border border-white/10 hover:border-emerald-500/30 transition-all cursor-pointer">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center text-white text-xs font-bold">VYM</div>
              <div>
                <p class="font-semibold text-sm text-primary">Vanguard High Div</p>
                <p class="text-xs text-tertiary">2.98% yield</p>
              </div>
            </div>
            <div class="space-y-1">
              <div class="flex justify-between text-xs">
                <span class="text-tertiary">Invest</span>
                <span class="font-mono font-semibold text-primary">$12,000</span>
              </div>
              <div class="flex justify-between text-xs">
                <span class="text-tertiary">Annual Income</span>
                <span class="font-mono font-semibold text-emerald-400">+$358</span>
              </div>
            </div>
          </div>
          <!-- JEPI -->
          <div class="p-4 rounded-xl bg-white/5 border border-white/10 hover:border-emerald-500/30 transition-all cursor-pointer">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-white text-xs font-bold">JEPI</div>
              <div>
                <p class="font-semibold text-sm text-primary">JPM Equity Premium</p>
                <p class="text-xs text-tertiary">7.84% yield</p>
              </div>
            </div>
            <div class="space-y-1">
              <div class="flex justify-between text-xs">
                <span class="text-tertiary">Invest</span>
                <span class="font-mono font-semibold text-primary">$5,000</span>
              </div>
              <div class="flex justify-between text-xs">
                <span class="text-tertiary">Annual Income</span>
                <span class="font-mono font-semibold text-emerald-400">+$392</span>
              </div>
            </div>
          </div>
          <!-- O -->
          <div class="p-4 rounded-xl bg-white/5 border border-white/10 hover:border-emerald-500/30 transition-all cursor-pointer">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center text-white text-xs font-bold">O</div>
              <div>
                <p class="font-semibold text-sm text-primary">Realty Income</p>
                <p class="text-xs text-tertiary">5.62% yield</p>
              </div>
            </div>
            <div class="space-y-1">
              <div class="flex justify-between text-xs">
                <span class="text-tertiary">Invest</span>
                <span class="font-mono font-semibold text-primary">$8,000</span>
              </div>
              <div class="flex justify-between text-xs">
                <span class="text-tertiary">Annual Income</span>
                <span class="font-mono font-semibold text-emerald-400">+$450</span>
              </div>
            </div>
          </div>
        </div>
        <div class="mt-4 p-4 rounded-xl bg-positive-green-bg border border-positive-green-border">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="icon-box-forest">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <div>
                <p class="text-sm font-semibold text-emerald-400">Total Investment Required: $35,000</p>
                <p class="text-xs text-emerald-400/70">This would add $1,552/year, bringing you to $14,399 (72% of goal)</p>
              </div>
            </div>
            <button class="premium-btn premium-btn-forest premium-btn-sm">
              Simulate Purchase
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Year Over Year Comparison -->
  <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8">
    <div class="premium-card animate-slide-up" style="animation-delay: 0.4s">
      <h3 class="premium-card-title mb-4">Year Over Year Income</h3>
      <div class="h-64">
        <canvas id="yoyChart"></canvas>
      </div>
    </div>
    <div class="premium-card animate-slide-up" style="animation-delay: 0.45s">
      <h3 class="premium-card-title mb-4">Income by Sector</h3>
      <div class="h-64">
        <canvas id="sectorChart"></canvas>
      </div>
    </div>
  </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Sample Portfolio Data
const portfolioData = {
  holdings: [
    { symbol: 'JNJ', name: 'Johnson & Johnson', annualDiv: 4.96, yield: 3.12, growth5Y: 6.1, yourIncome: 2480, shares: 500 },
    { symbol: 'MSFT', name: 'Microsoft', annualDiv: 3.00, yield: 0.72, growth5Y: 10.8, yourIncome: 1875, shares: 625 },
    { symbol: 'KO', name: 'Coca-Cola', annualDiv: 1.94, yield: 3.05, growth5Y: 3.8, yourIncome: 1746, shares: 900 },
    { symbol: 'PG', name: 'Procter & Gamble', annualDiv: 4.03, yield: 2.48, growth5Y: 6.2, yourIncome: 1612, shares: 400 },
    { symbol: 'O', name: 'Realty Income', annualDiv: 3.08, yield: 5.62, growth5Y: 3.1, yourIncome: 1232, shares: 400 },
    { symbol: 'V', name: 'Visa', annualDiv: 2.08, yield: 0.76, growth5Y: 17.2, yourIncome: 1040, shares: 500 },
    { symbol: 'HD', name: 'Home Depot', annualDiv: 8.90, yield: 2.31, growth5Y: 12.4, yourIncome: 890, shares: 100 },
    { symbol: 'UNH', name: 'UnitedHealth', annualDiv: 7.52, yield: 1.42, growth5Y: 14.8, yourIncome: 752, shares: 100 },
    { symbol: 'AAPL', name: 'Apple', annualDiv: 0.96, yield: 0.52, growth5Y: 6.2, yourIncome: 720, shares: 750 },
    { symbol: 'T', name: 'AT&T', annualDiv: 1.11, yield: 6.28, growth5Y: -8.2, yourIncome: 500, shares: 450 }
  ],
  currentIncome: 12847,
  avgGrowthRate: 0.084 // 8.4%
};

// Scenario Data
const scenarios = {
  conservative: { rate: 0, data: [12847, 12847, 12847, 12847, 12847, 12847] },
  moderate: { rate: 0.084, data: [12847, 13927, 15097, 16365, 17740, 19230] },
  optimistic: { rate: 0.12, data: [12847, 14389, 16116, 18050, 20216, 22642] }
};

let currentScenario = 'moderate';
let incomeChart, dripChart, yoyChart, sectorChart;

// Income Trajectory Chart
function initIncomeChart() {
  const ctx = document.getElementById('incomeTrajectoryChart').getContext('2d');
  incomeChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['2021', '2022', '2023', '2024', '2025', '2026', '2027', '2028', '2029', '2030'],
      datasets: [{
        label: 'Historical',
        data: [8200, 9100, 10200, 11400, 12847, null, null, null, null, null],
        borderColor: '#34d399',
        backgroundColor: 'rgba(52, 211, 153, 0.1)',
        fill: true,
        tension: 0.4,
        pointRadius: 4,
        pointBackgroundColor: '#34d399'
      }, {
        label: 'Projected',
        data: [null, null, null, null, 12847, 13927, 15097, 16365, 17740, 19230],
        borderColor: '#818cf8',
        backgroundColor: 'rgba(129, 140, 248, 0.1)',
        fill: true,
        tension: 0.4,
        borderDash: [5, 5],
        pointRadius: 4,
        pointBackgroundColor: '#818cf8'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { intersect: false, mode: 'index' },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: 'rgba(15, 15, 17, 0.95)',
          titleColor: '#fafafa',
          bodyColor: '#a1a1aa',
          borderColor: 'rgba(99, 102, 241, 0.3)',
          borderWidth: 1,
          padding: 12,
          callbacks: {
            label: function(context) {
              return '$' + context.parsed.y.toLocaleString();
            }
          }
        }
      },
      scales: {
        x: {
          grid: { color: 'rgba(255, 255, 255, 0.04)' },
          ticks: { color: '#71717a', font: { family: 'Inter' } }
        },
        y: {
          grid: { color: 'rgba(255, 255, 255, 0.04)' },
          ticks: {
            color: '#71717a',
            font: { family: 'JetBrains Mono' },
            callback: function(value) { return '$' + value.toLocaleString(); }
          }
        }
      }
    }
  });
}

// Switch Scenario
function switchScenario(scenario) {
  currentScenario = scenario;

  // Update tabs
  document.querySelectorAll('.premium-tabs .premium-tab').forEach(tab => {
    tab.classList.toggle('active', tab.dataset.scenario === scenario);
  });

  // Update chart
  const data = scenarios[scenario].data;
  incomeChart.data.datasets[1].data = [null, null, null, null, 12847, data[1], data[2], data[3], data[4], data[5]];
  incomeChart.update();

  // Update projected income display
  document.getElementById('projectedIncome').textContent = '$' + data[1].toLocaleString();
  document.getElementById('fiveYearIncome').textContent = '$' + data[5].toLocaleString();
}

// DRIP vs Cash Chart
function initDripChart() {
  const ctx = document.getElementById('dripChart').getContext('2d');
  dripChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Year 0', 'Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5'],
      datasets: [{
        label: 'With DRIP',
        data: [82456, 85234, 88567, 92145, 95678, 98234],
        borderColor: '#34d399',
        backgroundColor: 'rgba(52, 211, 153, 0.1)',
        fill: true,
        tension: 0.4
      }, {
        label: 'Cash Only',
        data: [82456, 82456, 82456, 82456, 82456, 82456],
        borderColor: '#71717a',
        backgroundColor: 'rgba(113, 113, 122, 0.1)',
        fill: true,
        tension: 0.4,
        borderDash: [5, 5]
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          position: 'bottom',
          labels: { color: '#a1a1aa', font: { family: 'Inter', size: 11 }, boxWidth: 12, padding: 20 }
        }
      },
      scales: {
        x: { grid: { color: 'rgba(255, 255, 255, 0.04)' }, ticks: { color: '#71717a' } },
        y: {
          grid: { color: 'rgba(255, 255, 255, 0.04)' },
          ticks: { color: '#71717a', callback: function(v) { return '$' + (v/1000) + 'k'; } }
        }
      }
    }
  });
}

function updateDripChart(years) {
  document.querySelectorAll('[data-drip]').forEach(btn => {
    btn.classList.toggle('active', parseInt(btn.dataset.drip) === years);
  });

  const dripData = {
    5: { drip: [82456, 85234, 88567, 92145, 95678, 98234], cash: 82456, cashTotal: 64235 },
    10: { drip: [82456, 88000, 94500, 102000, 110500, 120000, 130500, 142000, 155000, 169000, 184500], cash: 82456, cashTotal: 128470 },
    20: { drip: [82456, 95000, 115000, 140000, 170000, 205000, 245000, 295000, 350000, 420000, 500000, 590000, 700000, 820000, 960000, 1120000, 1300000, 1510000, 1750000, 2020000, 2340000], cash: 82456, cashTotal: 256940 }
  };

  const data = dripData[years];
  const labels = Array.from({length: data.drip.length}, (_, i) => `Year ${i}`);

  dripChart.data.labels = labels;
  dripChart.data.datasets[0].data = data.drip;
  dripChart.data.datasets[1].data = Array(data.drip.length).fill(data.cash);
  dripChart.update();
}

// Year over Year Chart
function initYoyChart() {
  const ctx = document.getElementById('yoyChart').getContext('2d');
  yoyChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['2020', '2021', '2022', '2023', '2024', '2025 (Proj)'],
      datasets: [{
        label: 'Annual Dividend Income',
        data: [8200, 9100, 10200, 11400, 12847, 13927],
        backgroundColor: [
          'rgba(52, 211, 153, 0.6)',
          'rgba(52, 211, 153, 0.6)',
          'rgba(52, 211, 153, 0.6)',
          'rgba(52, 211, 153, 0.6)',
          'rgba(52, 211, 153, 0.8)',
          'rgba(129, 140, 248, 0.6)'
        ],
        borderColor: [
          '#34d399',
          '#34d399',
          '#34d399',
          '#34d399',
          '#34d399',
          '#818cf8'
        ],
        borderWidth: 1,
        borderRadius: 8
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false }
      },
      scales: {
        x: { grid: { display: false }, ticks: { color: '#71717a' } },
        y: {
          grid: { color: 'rgba(255, 255, 255, 0.04)' },
          ticks: { color: '#71717a', callback: function(v) { return '$' + (v/1000) + 'k'; } }
        }
      }
    }
  });
}

// Sector Chart
function initSectorChart() {
  const ctx = document.getElementById('sectorChart').getContext('2d');
  sectorChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['Healthcare', 'Technology', 'Consumer Staples', 'Real Estate', 'Financials', 'Consumer Disc.', 'Telecom'],
      datasets: [{
        data: [3232, 2595, 3358, 1232, 1040, 890, 500],
        backgroundColor: [
          '#34d399',
          '#818cf8',
          '#f59e0b',
          '#10b981',
          '#8b5cf6',
          '#f97316',
          '#6366f1'
        ],
        borderWidth: 0,
        hoverOffset: 10
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '65%',
      plugins: {
        legend: {
          display: true,
          position: 'right',
          labels: {
            color: '#a1a1aa',
            font: { family: 'Inter', size: 11 },
            boxWidth: 12,
            padding: 12
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = ((context.parsed / total) * 100).toFixed(1);
              return '$' + context.parsed.toLocaleString() + ' (' + percentage + '%)';
            }
          }
        }
      }
    }
  });
}

// Goal Progress Update
function updateGoalProgress() {
  const goal = parseFloat(document.getElementById('incomeGoal').value) || 20000;
  const current = portfolioData.currentIncome;
  const progress = Math.min((current / goal) * 100, 100);
  const remaining = Math.max(goal - current, 0);

  document.getElementById('progressPercent').textContent = progress.toFixed(1) + '%';
  document.getElementById('progressBar').style.width = progress + '%';
}

// Export Forecast
function exportForecast() {
  alert('Exporting dividend forecast report...');
}

// Refresh Forecast
function refreshForecast() {
  location.reload();
}

// Sort Table
function sortTable(column) {
  // Placeholder for table sorting functionality
  console.log('Sorting by:', column);
}

// Calendar Update
function updateCalendar() {
  const year = document.getElementById('calendarYear').value;
  console.log('Updating calendar for year:', year);
}

// Initialize all charts
document.addEventListener('DOMContentLoaded', function() {
  initIncomeChart();
  initDripChart();
  initYoyChart();
  initSectorChart();
  updateGoalProgress();
});
</script>

<%- include('../partials/footer') %>
