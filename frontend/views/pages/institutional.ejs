<%
// Safe defaults for potentially undefined variables
if (typeof theme === 'undefined') theme = 'dark';
if (typeof pageTitle === 'undefined') pageTitle = 'Institutional Ownership';
%>
<%- include('../partials/header', { pageTitle: pageTitle }) %>

<!-- Bloomberg Header Bar -->
<div class="bloomberg-header">
  <h1 class="text-2xl font-bold text-amber-400">INSTITUTIONAL OWNERSHIP</h1>
  <p class="text-slate-400">Track hedge fund & institutional holdings</p>
</div>

<div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
<div class="flex gap-2">
<input type="text" value="AAPL" class="form-input w-32 font-mono uppercase">
<button class="bloomberg-btn bloomberg-btn-primary">LOOKUP</button>
</div>
</div>

<!-- Stock Header -->
<div class="bloomberg-card p-5">
<div class="flex items-center gap-6">
<div class="w-16 h-16 rounded bg-amber-400/10 border border-amber-400/30 flex items-center justify-center text-amber-400 font-bold text-2xl font-mono">AAPL</div>
<div class="flex-1">
<h2 class="text-xl font-bold text-amber-400">APPLE INC.</h2>
<p class="text-slate-400 font-mono">$<span class="font-mono">189.65</span> • Market Cap: <span class="font-mono">$2.94T</span></p>
</div>
<div class="text-center px-6 border-l border-slate-700">
<p class="text-sm text-slate-400 uppercase tracking-wider">Institutional %</p>
<p class="text-3xl font-bold text-emerald-400 font-mono">61.2%</p>
</div>
<div class="text-center px-6 border-l border-slate-700">
<p class="text-sm text-slate-400 uppercase tracking-wider">Institutions</p>
<p class="text-3xl font-bold text-white font-mono">5,842</p>
</div>
</div>
</div>

<!-- Ownership Summary -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-4">
<div class="bloomberg-card p-4">
<p class="text-slate-400 text-sm uppercase tracking-wider">Shares Held</p>
<p class="text-2xl font-bold text-white font-mono">9.52B</p>
<p class="text-xs text-emerald-400 font-mono">+124M QoQ</p>
</div>
<div class="bloomberg-card p-4">
<p class="text-slate-400 text-sm uppercase tracking-wider">13F Filers</p>
<p class="text-2xl font-bold text-white font-mono">5,842</p>
<p class="text-xs text-slate-400">Last quarter</p>
</div>
<div class="bloomberg-card p-4">
<p class="text-slate-400 text-sm uppercase tracking-wider">New Positions</p>
<p class="text-2xl font-bold text-emerald-400 font-mono">342</p>
<p class="text-xs text-emerald-400 font-mono">↑ 18% QoQ</p>
</div>
<div class="bloomberg-card p-4">
<p class="text-slate-400 text-sm uppercase tracking-wider">Closed Positions</p>
<p class="text-2xl font-bold text-red-400 font-mono">186</p>
<p class="text-xs text-red-400 font-mono">↓ 12% QoQ</p>
</div>
</div>

<!-- Top Holders -->
<div class="bloomberg-card overflow-hidden">
<div class="p-4 border-b border-amber-400/20 bg-slate-800/50">
<h3 class="font-semibold text-amber-400 uppercase tracking-wider">Top Institutional Holders</h3>
</div>
<table class="bloomberg-table w-full text-sm">
<thead>
<tr class="bg-slate-800 text-slate-400 text-left">
<th class="px-4 py-3 uppercase tracking-wider">Institution</th>
<th class="px-4 py-3 text-center uppercase tracking-wider">Shares</th>
<th class="px-4 py-3 text-center uppercase tracking-wider">Value</th>
<th class="px-4 py-3 text-center uppercase tracking-wider">% Outstanding</th>
<th class="px-4 py-3 text-center uppercase tracking-wider">Change</th>
<th class="px-4 py-3 text-center uppercase tracking-wider">% Portfolio</th>
</tr>
</thead>
<tbody class="text-white">
<tr class="border-b border-slate-700/50 hover:bg-slate-800/30">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-amber-400/10 border border-amber-400/30 flex items-center justify-center text-amber-400 text-xs font-bold">V</div><span class="font-medium">Vanguard Group</span></div></td>
<td class="px-4 py-3 text-center font-mono">1.31B</td>
<td class="px-4 py-3 text-center font-mono">$248.4B</td>
<td class="px-4 py-3 text-center font-bold font-mono">8.42%</td>
<td class="px-4 py-3 text-center text-emerald-400 font-mono">+12.4M</td>
<td class="px-4 py-3 text-center font-mono">4.2%</td>
</tr>
<tr class="border-b border-slate-700/50 hover:bg-slate-800/30">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-amber-400/10 border border-amber-400/30 flex items-center justify-center text-amber-400 text-xs font-bold">BR</div><span class="font-medium">BlackRock</span></div></td>
<td class="px-4 py-3 text-center font-mono">1.02B</td>
<td class="px-4 py-3 text-center font-mono">$193.4B</td>
<td class="px-4 py-3 text-center font-bold font-mono">6.56%</td>
<td class="px-4 py-3 text-center text-emerald-400 font-mono">+8.2M</td>
<td class="px-4 py-3 text-center font-mono">3.8%</td>
</tr>
<tr class="border-b border-slate-700/50 hover:bg-slate-800/30">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-amber-400/10 border border-amber-400/30 flex items-center justify-center text-amber-400 text-xs font-bold">BH</div><span class="font-medium">Berkshire Hathaway</span></div></td>
<td class="px-4 py-3 text-center font-mono">915.6M</td>
<td class="px-4 py-3 text-center font-mono">$173.6B</td>
<td class="px-4 py-3 text-center font-bold font-mono">5.89%</td>
<td class="px-4 py-3 text-center text-slate-400 font-mono">0</td>
<td class="px-4 py-3 text-center font-mono">48.2%</td>
</tr>
<tr class="border-b border-slate-700/50 hover:bg-slate-800/30">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-amber-400/10 border border-amber-400/30 flex items-center justify-center text-amber-400 text-xs font-bold">SS</div><span class="font-medium">State Street</span></div></td>
<td class="px-4 py-3 text-center font-mono">624.8M</td>
<td class="px-4 py-3 text-center font-mono">$118.5B</td>
<td class="px-4 py-3 text-center font-bold font-mono">4.02%</td>
<td class="px-4 py-3 text-center text-red-400 font-mono">-4.2M</td>
<td class="px-4 py-3 text-center font-mono">2.4%</td>
</tr>
<tr class="border-b border-slate-700/50 hover:bg-slate-800/30">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-amber-400/10 border border-amber-400/30 flex items-center justify-center text-amber-400 text-xs font-bold">F</div><span class="font-medium">FMR LLC (Fidelity)</span></div></td>
<td class="px-4 py-3 text-center font-mono">412.4M</td>
<td class="px-4 py-3 text-center font-mono">$78.2B</td>
<td class="px-4 py-3 text-center font-bold font-mono">2.65%</td>
<td class="px-4 py-3 text-center text-emerald-400 font-mono">+18.6M</td>
<td class="px-4 py-3 text-center font-mono">1.8%</td>
</tr>
</tbody>
</table>
</div>

<!-- Recent Activity -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div class="bloomberg-card p-5">
<h3 class="font-semibold text-amber-400 mb-4 uppercase tracking-wider">Notable Buyers (Q3 2024)</h3>
<div class="space-y-3">
<div class="flex items-center justify-between p-3 rounded bg-emerald-500/10 border border-emerald-500/20">
<div><p class="font-medium text-white">Citadel Advisors</p><p class="text-xs text-slate-400 uppercase tracking-wider">New position</p></div>
<div class="text-right"><p class="font-bold text-emerald-400 font-mono">+$842M</p><p class="text-xs text-slate-400 font-mono">4.4M shares</p></div>
</div>
<div class="flex items-center justify-between p-3 rounded bg-emerald-500/10 border border-emerald-500/20">
<div><p class="font-medium text-white">Two Sigma</p><p class="text-xs text-slate-400 uppercase tracking-wider">Added to position</p></div>
<div class="text-right"><p class="font-bold text-emerald-400 font-mono">+$524M</p><p class="text-xs text-slate-400 font-mono">2.8M shares</p></div>
</div>
<div class="flex items-center justify-between p-3 rounded bg-emerald-500/10 border border-emerald-500/20">
<div><p class="font-medium text-white">Renaissance Tech</p><p class="text-xs text-slate-400 uppercase tracking-wider">Added to position</p></div>
<div class="text-right"><p class="font-bold text-emerald-400 font-mono">+$312M</p><p class="text-xs text-slate-400 font-mono">1.6M shares</p></div>
</div>
</div>
</div>
<div class="bloomberg-card p-5">
<h3 class="font-semibold text-amber-400 mb-4 uppercase tracking-wider">Notable Sellers (Q3 2024)</h3>
<div class="space-y-3">
<div class="flex items-center justify-between p-3 rounded bg-red-500/10 border border-red-500/20">
<div><p class="font-medium text-white">Tiger Global</p><p class="text-xs text-slate-400 uppercase tracking-wider">Reduced position</p></div>
<div class="text-right"><p class="font-bold text-red-400 font-mono">-$428M</p><p class="text-xs text-slate-400 font-mono">2.3M shares</p></div>
</div>
<div class="flex items-center justify-between p-3 rounded bg-red-500/10 border border-red-500/20">
<div><p class="font-medium text-white">Coatue Management</p><p class="text-xs text-slate-400 uppercase tracking-wider">Exited position</p></div>
<div class="text-right"><p class="font-bold text-red-400 font-mono">-$284M</p><p class="text-xs text-slate-400 font-mono">1.5M shares</p></div>
</div>
<div class="flex items-center justify-between p-3 rounded bg-red-500/10 border border-red-500/20">
<div><p class="font-medium text-white">D1 Capital</p><p class="text-xs text-slate-400 uppercase tracking-wider">Reduced position</p></div>
<div class="text-right"><p class="font-bold text-red-400 font-mono">-$186M</p><p class="text-xs text-slate-400 font-mono">1.0M shares</p></div>
</div>
</div>
</div>
</div>

<!-- Ownership Trend -->
<div class="bloomberg-card p-5">
<h3 class="font-semibold text-amber-400 mb-4 uppercase tracking-wider">Institutional Ownership Trend</h3>
<div class="h-48"><canvas id="ownershipChart"></canvas></div>
</div>
</div></div></main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Chart(document.getElementById('ownershipChart'), {
  type: 'line',
  data: {
    labels: ['Q1 23','Q2 23','Q3 23','Q4 23','Q1 24','Q2 24','Q3 24'],
    datasets: [{ label: 'Institutional %', data: [58.4,59.2,60.1,59.8,60.4,60.8,61.2], borderColor: '#10b981', fill: false, tension: 0.3 }]
  },
  options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { min: 55, max: 65 } } }
});
</script>
<%- include('../partials/footer') %>
