<%
// Safe defaults for potentially undefined variables
const safeTheme = typeof theme !== 'undefined' ? theme : 'dark';
const safeUser = typeof user !== 'undefined' ? user : {};
const userName = safeUser?.name || 'User';
const userInitial = userName.charAt(0).toUpperCase();
%>
<%- include('../partials/header', { pageTitle: 'AI Assistant' }) %>

<main class="p-4 lg:p-6 min-h-screen">
  <div class="max-w-5xl mx-auto">

    <!-- Hero Header with Glassmorphism -->
    <div class="relative overflow-hidden glass-card p-5 mb-4">
      <!-- Background Gradient Orbs -->
      <div class="absolute -top-16 -right-16 w-48 h-48 bg-gradient-to-br from-violet-500/20 to-purple-500/20 rounded-full blur-3xl"></div>
      <div class="absolute -bottom-16 -left-16 w-40 h-40 bg-gradient-to-br from-sky-500/10 to-cyan-500/10 rounded-full blur-3xl"></div>

      <div class="relative flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shadow-lg shadow-violet-500/25">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
            </svg>
          </div>
          <div>
            <div class="flex items-center gap-3">
              <h1 class="text-2xl lg:text-3xl font-bold text-white">WealthPilot AI</h1>
              <span class="flex items-center gap-1.5 px-2 py-1 rounded-full bg-emerald-500/10 border border-emerald-500/20">
                <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                <span class="text-xs text-emerald-400 font-mono">ONLINE</span>
              </span>
            </div>
            <p class="text-slate-400 text-sm mt-1">Your personal investment assistant powered by AI</p>
          </div>
        </div>
        <button onclick="clearChat()" class="btn-glass flex items-center gap-2 px-4 py-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
          </svg>
          New Chat
        </button>
      </div>
    </div>

    <!-- Chat Container -->
    <div class="glass-card overflow-hidden flex flex-col" style="height: calc(100vh - 280px); min-height: 500px;">

      <!-- Chat Messages -->
      <div class="flex-1 overflow-y-auto p-4 space-y-4" id="chatMessages">

        <!-- Welcome Message -->
        <div class="flex gap-3">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg shadow-violet-500/20">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
            </svg>
          </div>
          <div class="glass-card p-4 max-w-[80%] border-l-2 border-violet-500">
            <p class="text-white font-medium mb-3">Hi <%= userName %>! I'm your WealthPilot AI assistant. I can help you with:</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
              <div class="flex items-center gap-2 p-2 rounded-lg bg-white/5">
                <span class="w-8 h-8 rounded-lg bg-sky-500/20 flex items-center justify-center text-sky-400">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                </span>
                <span class="text-sm text-slate-300">Portfolio Analysis</span>
              </div>
              <div class="flex items-center gap-2 p-2 rounded-lg bg-white/5">
                <span class="w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center text-emerald-400">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
                </span>
                <span class="text-sm text-slate-300">Investment Ideas</span>
              </div>
              <div class="flex items-center gap-2 p-2 rounded-lg bg-white/5">
                <span class="w-8 h-8 rounded-lg bg-amber-500/20 flex items-center justify-center text-amber-400">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                </span>
                <span class="text-sm text-slate-300">Risk Assessment</span>
              </div>
              <div class="flex items-center gap-2 p-2 rounded-lg bg-white/5">
                <span class="w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center text-purple-400">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                </span>
                <span class="text-sm text-slate-300">Market Insights</span>
              </div>
            </div>
            <p class="mt-4 text-slate-400">What would you like to know?</p>
          </div>
        </div>

        <!-- Example User Message -->
        <div class="flex gap-3 justify-end">
          <div class="glass-card p-4 max-w-[80%] bg-gradient-to-r from-violet-500/10 to-purple-500/10 border-r-2 border-violet-500">
            <p class="text-white">What's my best performing stock this year?</p>
          </div>
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-sky-500 to-cyan-600 flex items-center justify-center flex-shrink-0 text-white font-bold text-sm shadow-lg shadow-sky-500/20">
            <%= userInitial %>
          </div>
        </div>

        <!-- AI Response with Data -->
        <div class="flex gap-3">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg shadow-violet-500/20">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
            </svg>
          </div>
          <div class="glass-card p-4 max-w-[80%] border-l-2 border-violet-500">
            <p class="text-white">Looking at your portfolio, <span class="font-bold text-emerald-400 font-mono">NVDA (NVIDIA)</span> is your best performer this year with a <span class="text-emerald-400 font-bold">+142.8%</span> return!</p>

            <!-- Stock Card -->
            <div class="mt-4 p-4 rounded-xl bg-gradient-to-r from-emerald-500/10 to-green-500/10 border border-emerald-500/20">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center text-white font-bold shadow-lg shadow-emerald-500/20">
                    NV
                  </div>
                  <div>
                    <p class="font-semibold text-white">NVIDIA Corp</p>
                    <p class="text-xs text-slate-400 font-mono">50 shares @ $485.20</p>
                  </div>
                </div>
                <div class="text-right">
                  <p class="text-emerald-400 font-bold text-xl font-mono">+142.8%</p>
                  <p class="text-xs text-emerald-400/70 font-mono">+$14,280</p>
                </div>
              </div>
            </div>

            <p class="mt-4 text-slate-400 text-sm">The AI chip demand has driven exceptional growth. Your cost basis of $200/share is well below current prices. Want me to analyze if you should take some profits?</p>
          </div>
        </div>

        <!-- User Follow-up -->
        <div class="flex gap-3 justify-end">
          <div class="glass-card p-4 max-w-[80%] bg-gradient-to-r from-violet-500/10 to-purple-500/10 border-r-2 border-violet-500">
            <p class="text-white">Yes, should I sell some NVDA?</p>
          </div>
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-sky-500 to-cyan-600 flex items-center justify-center flex-shrink-0 text-white font-bold text-sm shadow-lg shadow-sky-500/20">
            <%= userInitial %>
          </div>
        </div>

        <!-- AI Analysis Response -->
        <div class="flex gap-3">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg shadow-violet-500/20">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
            </svg>
          </div>
          <div class="glass-card p-4 max-w-[80%] border-l-2 border-violet-500">
            <p class="text-white font-medium mb-3">Here's my analysis on your NVDA position:</p>

            <div class="space-y-2">
              <div class="flex items-center gap-3 p-2 rounded-lg bg-amber-500/10 border border-amber-500/20">
                <div class="w-8 h-8 rounded-lg bg-amber-500/20 flex items-center justify-center">
                  <svg class="w-4 h-4 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                </div>
                <span class="text-sm text-slate-300"><strong class="text-amber-400">Concentration Risk:</strong> NVDA is now 18% of your portfolio (recommend &lt;15%)</span>
              </div>
              <div class="flex items-center gap-3 p-2 rounded-lg bg-emerald-500/10 border border-emerald-500/20">
                <div class="w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center">
                  <svg class="w-4 h-4 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                </div>
                <span class="text-sm text-slate-300"><strong class="text-emerald-400">Strong Fundamentals:</strong> AI demand remains robust</span>
              </div>
              <div class="flex items-center gap-3 p-2 rounded-lg bg-sky-500/10 border border-sky-500/20">
                <div class="w-8 h-8 rounded-lg bg-sky-500/20 flex items-center justify-center">
                  <svg class="w-4 h-4 text-sky-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                </div>
                <span class="text-sm text-slate-300"><strong class="text-sky-400">Technical:</strong> RSI at 72 (slightly overbought)</span>
              </div>
              <div class="flex items-center gap-3 p-2 rounded-lg bg-purple-500/10 border border-purple-500/20">
                <div class="w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center">
                  <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <span class="text-sm text-slate-300"><strong class="text-purple-400">Tax:</strong> Long-term gains eligible (15% tax rate)</span>
              </div>
            </div>

            <div class="mt-4 p-3 rounded-xl bg-gradient-to-r from-violet-500/10 to-purple-500/10 border border-violet-500/20">
              <p class="text-white text-sm"><strong class="text-violet-400">My Suggestion:</strong> Consider selling 10 shares (~$4,850) to reduce concentration to ~15% while maintaining AI exposure. This locks in $2,850 profit.</p>
            </div>

            <div class="mt-4 flex gap-2">
              <button onclick="showToast('Trade preview coming soon!', 'info')" class="btn-gradient px-4 py-2 text-sm flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                Preview Trade
              </button>
              <button onclick="showToast('Added to watchlist', 'success')" class="btn-glass px-4 py-2 text-sm flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg>
                Set Alert
              </button>
            </div>
          </div>
        </div>

        <!-- Quick Suggestions -->
        <div class="flex flex-wrap gap-2 justify-center pt-4 pb-2">
          <button onclick="askQuestion('What stocks should I add to diversify?')" class="px-4 py-2 rounded-xl text-sm glass-card text-slate-300 hover:border-violet-500/30 hover:text-violet-400 transition-all flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
            Diversification ideas
          </button>
          <button onclick="askQuestion('Analyze my sector allocation')" class="px-4 py-2 rounded-xl text-sm glass-card text-slate-300 hover:border-violet-500/30 hover:text-violet-400 transition-all flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/></svg>
            Sector analysis
          </button>
          <button onclick="askQuestion('What are the risks in my portfolio?')" class="px-4 py-2 rounded-xl text-sm glass-card text-slate-300 hover:border-violet-500/30 hover:text-violet-400 transition-all flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            Risk assessment
          </button>
        </div>
      </div>

      <!-- Input Area -->
      <div class="p-4 border-t border-white/10 bg-gradient-to-r from-slate-900/80 to-slate-800/80">
        <div class="flex gap-3">
          <div class="flex-1 relative">
            <input type="text" id="chatInput"
                   class="w-full bg-slate-800/50 border border-white/10 rounded-xl px-4 py-3 pr-12 text-white placeholder-slate-500 focus:outline-none focus:border-violet-500/50 focus:ring-2 focus:ring-violet-500/20 transition-all"
                   placeholder="Ask me anything about your portfolio..."
                   onkeyup="if(event.key==='Enter')sendMessage()">
            <button onclick="toggleVoice()" class="absolute right-3 top-1/2 -translate-y-1/2 p-2 text-slate-500 hover:text-violet-400 transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
              </svg>
            </button>
          </div>
          <button onclick="sendMessage()" class="btn-gradient px-5 py-3 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
            </svg>
            Send
          </button>
        </div>
        <p class="text-xs text-slate-500 mt-3 text-center">AI responses are for informational purposes only. Not financial advice.</p>
      </div>
    </div>

  </div>
</main>

<script>
function sendMessage() {
  const input = document.getElementById('chatInput');
  const message = input.value.trim();
  if (!message) return;

  const container = document.getElementById('chatMessages');
  const userInitial = '<%= userInitial %>';

  // Add user message
  container.innerHTML += `
    <div class="flex gap-3 justify-end">
      <div class="glass-card p-4 max-w-[80%] bg-gradient-to-r from-violet-500/10 to-purple-500/10 border-r-2 border-violet-500">
        <p class="text-white">${escapeHtml(message)}</p>
      </div>
      <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-sky-500 to-cyan-600 flex items-center justify-center flex-shrink-0 text-white font-bold text-sm shadow-lg shadow-sky-500/20">
        ${userInitial}
      </div>
    </div>
  `;

  input.value = '';
  container.scrollTop = container.scrollHeight;

  // Add typing indicator
  const typingId = 'typing-' + Date.now();
  container.innerHTML += `
    <div class="flex gap-3" id="${typingId}">
      <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg shadow-violet-500/20">
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
        </svg>
      </div>
      <div class="glass-card p-4 border-l-2 border-violet-500">
        <div class="flex items-center gap-2">
          <div class="flex gap-1">
            <div class="w-2 h-2 rounded-full bg-violet-400 animate-bounce" style="animation-delay: 0ms"></div>
            <div class="w-2 h-2 rounded-full bg-violet-400 animate-bounce" style="animation-delay: 150ms"></div>
            <div class="w-2 h-2 rounded-full bg-violet-400 animate-bounce" style="animation-delay: 300ms"></div>
          </div>
          <span class="text-slate-400 text-sm">Analyzing your portfolio...</span>
        </div>
      </div>
    </div>
  `;
  container.scrollTop = container.scrollHeight;

  // Simulate AI response
  setTimeout(() => {
    document.getElementById(typingId)?.remove();
    container.innerHTML += `
      <div class="flex gap-3">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg shadow-violet-500/20">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
          </svg>
        </div>
        <div class="glass-card p-4 max-w-[80%] border-l-2 border-violet-500">
          <p class="text-white">I'm analyzing your portfolio to answer that question. Let me pull up the relevant data...</p>
          <div class="mt-3 p-3 rounded-lg bg-violet-500/10 border border-violet-500/20">
            <p class="text-sm text-violet-400 flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              This is a demo - full AI integration coming soon!
            </p>
          </div>
        </div>
      </div>
    `;
    container.scrollTop = container.scrollHeight;
  }, 1500);
}

function askQuestion(question) {
  document.getElementById('chatInput').value = question;
  sendMessage();
}

function clearChat() {
  const container = document.getElementById('chatMessages');
  container.innerHTML = `
    <div class="flex gap-3">
      <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg shadow-violet-500/20">
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
        </svg>
      </div>
      <div class="glass-card p-4 max-w-[80%] border-l-2 border-violet-500">
        <p class="text-white">Chat cleared! How can I help you today?</p>
      </div>
    </div>
  `;
  showToast('Chat cleared', 'success');
}

function toggleVoice() {
  showToast('Voice input coming soon!', 'info');
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}
</script>

<%- include('../partials/footer') %>
