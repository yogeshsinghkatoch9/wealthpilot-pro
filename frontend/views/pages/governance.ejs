<%
// Safe defaults for potentially undefined variables
const theme = typeof theme !== 'undefined' ? theme : 'dark';
const pageTitle = typeof pageTitle !== 'undefined' ? pageTitle : 'Governance Score';
%>
<%- include('../partials/header', { pageTitle: pageTitle }) %>

<!-- Bloomberg-style Header Bar -->
<div class="bloomberg-header">
<div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
<div>
<h1 class="text-2xl font-bold text-amber-400">GOVERNANCE SCORE</h1>
<p class="<%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Corporate governance & board analysis</p>
</div>
<div class="flex gap-2">
<select class="form-input w-32"><option selected>My Holdings</option><option>Watchlist</option></select>
</div>
</div>
</div>

<!-- Portfolio Governance Overview -->
<div class="bloomberg-card p-5 bg-gradient-to-r <%= theme === 'light' ? 'from-emerald-50 to-sky-50' : 'from-emerald-900/20 to-sky-900/20' %>">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Portfolio Governance Summary</h3>
<div class="grid grid-cols-2 md:grid-cols-5 gap-4">
<div class="text-center">
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Avg Gov Score</p>
<p class="text-3xl font-bold font-mono text-emerald-400">82/100</p>
<p class="text-xs text-emerald-400">Strong</p>
</div>
<div class="text-center">
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Board Independence</p>
<p class="text-3xl font-bold font-mono text-emerald-400">84%</p>
<p class="text-xs text-emerald-400">Above avg</p>
</div>
<div class="text-center">
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Women on Boards</p>
<p class="text-3xl font-bold font-mono text-sky-400">32%</p>
<p class="text-xs text-sky-400">Good diversity</p>
</div>
<div class="text-center">
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Separate CEO/Chair</p>
<p class="text-3xl font-bold font-mono text-emerald-400">75%</p>
<p class="text-xs">12 of 16 holdings</p>
</div>
<div class="text-center">
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Red Flags</p>
<p class="text-3xl font-bold font-mono text-amber-400">2</p>
<p class="text-xs text-amber-400">Holdings flagged</p>
</div>
</div>
</div>

<!-- Holdings Governance Table -->
<div class="bloomberg-card overflow-hidden">
<div class="p-4 border-b <%= theme === 'light' ? 'border-gray-200' : 'border-slate-700' %>">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">Holdings Governance Scores</h3>
</div>
<table class="w-full text-sm">
<thead>
<tr class="<%= theme === 'light' ? 'bg-gray-50 text-gray-500' : 'bg-slate-800 text-slate-400' %> text-left">
<th class="px-4 py-3">Stock</th>
<th class="px-4 py-3 text-center">Gov Score</th>
<th class="px-4 py-3 text-center">Board Size</th>
<th class="px-4 py-3 text-center">Independence</th>
<th class="px-4 py-3 text-center">Diversity</th>
<th class="px-4 py-3 text-center">CEO/Chair</th>
<th class="px-4 py-3 text-center">Issues</th>
</tr>
</thead>
<tbody class="<%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">MSFT</div><span class="font-medium">Microsoft</span></div></td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 font-bold font-mono">92</span></td>
<td class="px-4 py-3 text-center font-mono">12</td>
<td class="px-4 py-3 text-center text-emerald-400 font-mono">92%</td>
<td class="px-4 py-3 text-center text-emerald-400 font-mono">42%</td>
<td class="px-4 py-3 text-center text-emerald-400">‚úì Separate</td>
<td class="px-4 py-3 text-center"><span class="text-emerald-400">None</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">AAPL</div><span class="font-medium">Apple</span></div></td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 font-bold font-mono">88</span></td>
<td class="px-4 py-3 text-center font-mono">8</td>
<td class="px-4 py-3 text-center text-emerald-400 font-mono">88%</td>
<td class="px-4 py-3 text-center text-emerald-400 font-mono">38%</td>
<td class="px-4 py-3 text-center text-emerald-400">‚úì Separate</td>
<td class="px-4 py-3 text-center"><span class="text-emerald-400">None</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold">NVDA</div><span class="font-medium">NVIDIA</span></div></td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-sky-500/20 text-sky-400 font-bold font-mono">78</span></td>
<td class="px-4 py-3 text-center font-mono">13</td>
<td class="px-4 py-3 text-center font-mono">85%</td>
<td class="px-4 py-3 text-center font-mono">31%</td>
<td class="px-4 py-3 text-center text-amber-400">‚ö†Ô∏è Combined</td>
<td class="px-4 py-3 text-center"><span class="text-amber-400 font-mono">1</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white text-xs font-bold">TSLA</div><span class="font-medium">Tesla</span></div></td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-red-500/20 text-red-400 font-bold font-mono">54</span></td>
<td class="px-4 py-3 text-center font-mono">7</td>
<td class="px-4 py-3 text-center text-amber-400 font-mono">71%</td>
<td class="px-4 py-3 text-center text-amber-400 font-mono">29%</td>
<td class="px-4 py-3 text-center text-red-400">‚ö†Ô∏è Combined</td>
<td class="px-4 py-3 text-center"><span class="text-red-400 font-mono">3</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-white text-xs font-bold">JNJ</div><span class="font-medium">J&J</span></div></td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 font-bold font-mono">90</span></td>
<td class="px-4 py-3 text-center font-mono">11</td>
<td class="px-4 py-3 text-center text-emerald-400 font-mono">91%</td>
<td class="px-4 py-3 text-center text-emerald-400 font-mono">36%</td>
<td class="px-4 py-3 text-center text-emerald-400">‚úì Separate</td>
<td class="px-4 py-3 text-center"><span class="text-emerald-400">None</span></td>
</tr>
</tbody>
</table>
</div>

<!-- Governance Issues -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div class="card p-5">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">üö© Governance Red Flags</h3>
<div class="space-y-3">
<div class="p-4 rounded-lg border-l-4 border-red-500 <%= theme === 'light' ? 'bg-red-50' : 'bg-red-500/10' %>">
<div class="flex justify-between items-start">
<div><p class="font-bold">TSLA - Multiple Issues</p><p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %> mt-1">Combined CEO/Chair, related party transactions, executive compensation concerns</p></div>
<span class="px-2 py-1 rounded bg-red-500/20 text-red-400 text-xs font-bold">3 flags</span>
</div>
</div>
<div class="p-4 rounded-lg border-l-4 border-amber-500 <%= theme === 'light' ? 'bg-amber-50' : 'bg-amber-500/10' %>">
<div class="flex justify-between items-start">
<div><p class="font-bold">NVDA - CEO/Chair Combined</p><p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %> mt-1">Jensen Huang serves as both CEO and Chairman</p></div>
<span class="px-2 py-1 rounded bg-amber-500/20 text-amber-400 text-xs font-bold">1 flag</span>
</div>
</div>
</div>
</div>
<div class="card p-5">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">üìä Governance Breakdown</h3>
<div class="h-48"><canvas id="govChart"></canvas></div>
</div>
</div>

<!-- Executive Compensation -->
<div class="card p-5">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">üí∞ CEO Compensation (Top Holdings)</h3>
<div class="grid grid-cols-1 md:grid-cols-4 gap-4">
<div class="p-4 rounded-lg <%= theme === 'light' ? 'bg-gray-50' : 'bg-slate-800' %>">
<p class="font-bold">Tim Cook</p>
<p class="text-xs <%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">Apple CEO</p>
<p class="text-xl font-bold text-sky-400 mt-2">$63.2M</p>
<p class="text-xs text-emerald-400">94% performance-based</p>
</div>
<div class="p-4 rounded-lg <%= theme === 'light' ? 'bg-gray-50' : 'bg-slate-800' %>">
<p class="font-bold">Satya Nadella</p>
<p class="text-xs <%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">Microsoft CEO</p>
<p class="text-xl font-bold text-sky-400 mt-2">$55.4M</p>
<p class="text-xs text-emerald-400">91% performance-based</p>
</div>
<div class="p-4 rounded-lg <%= theme === 'light' ? 'bg-gray-50' : 'bg-slate-800' %>">
<p class="font-bold">Jensen Huang</p>
<p class="text-xs <%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">NVIDIA CEO</p>
<p class="text-xl font-bold text-sky-400 mt-2">$34.2M</p>
<p class="text-xs text-emerald-400">88% performance-based</p>
</div>
<div class="p-4 rounded-lg <%= theme === 'light' ? 'bg-red-50' : 'bg-red-500/10' %>">
<p class="font-bold">Elon Musk</p>
<p class="text-xs <%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">Tesla CEO</p>
<p class="text-xl font-bold text-red-400 mt-2">$0 (disputed)</p>
<p class="text-xs text-red-400">$56B package voided</p>
</div>
</div>
</div>

<!-- Best Practices -->
<div class="card p-5">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">‚úÖ Governance Best Practices Checklist</h3>
<div class="grid grid-cols-2 md:grid-cols-4 gap-4">
<div class="p-3 rounded-lg text-center <%= theme === 'light' ? 'bg-emerald-50' : 'bg-emerald-500/10' %>">
<p class="text-2xl mb-1">‚úì</p>
<p class="text-sm font-medium">Independent Board Majority</p>
<p class="text-xs text-emerald-400">14/16 holdings</p>
</div>
<div class="p-3 rounded-lg text-center <%= theme === 'light' ? 'bg-emerald-50' : 'bg-emerald-500/10' %>">
<p class="text-2xl mb-1">‚úì</p>
<p class="text-sm font-medium">Annual Director Elections</p>
<p class="text-xs text-emerald-400">15/16 holdings</p>
</div>
<div class="p-3 rounded-lg text-center <%= theme === 'light' ? 'bg-amber-50' : 'bg-amber-500/10' %>">
<p class="text-2xl mb-1">‚ö†Ô∏è</p>
<p class="text-sm font-medium">Separate CEO/Chair</p>
<p class="text-xs text-amber-400">12/16 holdings</p>
</div>
<div class="p-3 rounded-lg text-center <%= theme === 'light' ? 'bg-emerald-50' : 'bg-emerald-500/10' %>">
<p class="text-2xl mb-1">‚úì</p>
<p class="text-sm font-medium">Majority Vote Standard</p>
<p class="text-xs text-emerald-400">16/16 holdings</p>
</div>
</div>
</div>
</div></div></main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Chart(document.getElementById('govChart'), {
  type: 'radar',
  data: {
    labels: ['Board Independence','Diversity','Compensation','Shareholder Rights','Audit','Ethics'],
    datasets: [
      { label: 'Portfolio Avg', data: [84,72,78,82,88,85], borderColor: '#0ea5e9', backgroundColor: 'rgba(14,165,233,0.2)' },
      { label: 'S&P 500 Avg', data: [78,65,72,75,82,80], borderColor: '#94a3b8', backgroundColor: 'rgba(148,163,184,0.1)' }
    ]
  },
  options: { responsive: true, maintainAspectRatio: false, scales: { r: { beginAtZero: true, max: 100 } } }
});
</script>
<%- include('../partials/footer') %>
