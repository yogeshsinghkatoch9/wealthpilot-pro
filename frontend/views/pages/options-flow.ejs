<%
// Safe defaults for potentially undefined variables
const safeTheme = typeof theme !== 'undefined' ? theme : 'dark';
%>
<%- include('../partials/header', { pageTitle: 'Options Flow' }) %>

<!-- Bloomberg Header Bar -->
<div class="bg-black border-b-2 border-amber-400 px-6 py-3 -mx-6 -mt-6 mb-6">
  <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
    <div>
      <h1 class="text-2xl font-bold text-amber-400 tracking-wider">OPTIONS FLOW</h1>
      <p class="text-slate-400 text-sm mt-1">Unusual options activity tracker</p>
    </div>
    <div class="flex gap-2">
      <select class="form-input w-32 bg-slate-900 border-slate-700 text-white">
        <option>All Tickers</option>
        <option>My Holdings</option>
        <option>Watchlist</option>
      </select>
      <select class="form-input w-24 bg-slate-900 border-slate-700 text-white">
        <option selected>Today</option>
        <option>Week</option>
      </select>
      <button class="bloomberg-btn">REFRESH</button>
    </div>
  </div>
</div>

<!-- Market Overview -->
<div class="grid grid-cols-1 md:grid-cols-5 gap-4">
  <div class="tufte-stat-card p-4">
    <p class="text-slate-400 text-sm uppercase tracking-wide">Call Volume</p>
    <p class="text-2xl font-bold text-emerald-400 tabular-nums">12.4M</p>
    <p class="text-xs text-emerald-400">+18% vs avg</p>
  </div>
  <div class="tufte-stat-card p-4">
    <p class="text-slate-400 text-sm uppercase tracking-wide">Put Volume</p>
    <p class="text-2xl font-bold text-red-400 tabular-nums">8.2M</p>
    <p class="text-xs text-red-400">+12% vs avg</p>
  </div>
  <div class="tufte-stat-card p-4">
    <p class="text-slate-400 text-sm uppercase tracking-wide">Put/Call Ratio</p>
    <p class="text-2xl font-bold text-emerald-400 tabular-nums">0.66</p>
    <p class="text-xs text-emerald-400">Bullish</p>
  </div>
  <div class="tufte-stat-card p-4">
    <p class="text-slate-400 text-sm uppercase tracking-wide">Premium Flow</p>
    <p class="text-2xl font-bold text-emerald-400 tabular-nums">$4.2B</p>
    <p class="text-xs text-emerald-400">Net bullish</p>
  </div>
  <div class="tufte-stat-card p-4">
    <p class="text-slate-400 text-sm uppercase tracking-wide">Unusual Alerts</p>
    <p class="text-2xl font-bold text-purple-400 tabular-nums">48</p>
    <p class="text-xs text-slate-400">Today</p>
  </div>
</div>

<!-- Unusual Flow Table -->
<div class="bloomberg-card overflow-hidden">
  <div class="p-4 border-b border-amber-400/30">
    <h3 class="font-semibold text-amber-400 uppercase tracking-wider">Unusual Options Activity</h3>
  </div>
  <table class="bloomberg-table w-full text-sm">
    <thead>
      <tr class="bg-slate-900 text-slate-400 text-left">
        <th class="px-4 py-3 uppercase tracking-wider text-xs">TIME</th>
        <th class="px-4 py-3 uppercase tracking-wider text-xs">TICKER</th>
        <th class="px-4 py-3 text-center uppercase tracking-wider text-xs">TYPE</th>
        <th class="px-4 py-3 text-center uppercase tracking-wider text-xs">STRIKE</th>
        <th class="px-4 py-3 text-center uppercase tracking-wider text-xs">EXP</th>
        <th class="px-4 py-3 text-center uppercase tracking-wider text-xs">VOLUME</th>
        <th class="px-4 py-3 text-center uppercase tracking-wider text-xs">OI</th>
        <th class="px-4 py-3 text-center uppercase tracking-wider text-xs">PREMIUM</th>
        <th class="px-4 py-3 text-center uppercase tracking-wider text-xs">SPOT</th>
        <th class="px-4 py-3 uppercase tracking-wider text-xs">SIGNAL</th>
      </tr>
    </thead>
    <tbody class="text-white">
      <tr class="border-b border-slate-700/50 bg-emerald-500/5 hover:bg-emerald-500/10 transition-colors">
        <td class="px-4 py-3 text-xs text-slate-400 tabular-nums">14:32</td>
        <td class="px-4 py-3 font-bold text-white">NVDA</td>
        <td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-emerald-500 text-white text-xs font-bold">CALL</span></td>
        <td class="px-4 py-3 text-center tabular-nums text-white">$520</td>
        <td class="px-4 py-3 text-center text-slate-300">Jan 17</td>
        <td class="px-4 py-3 text-center font-bold tabular-nums text-white">15,420</td>
        <td class="px-4 py-3 text-center tabular-nums text-slate-300">2,840</td>
        <td class="px-4 py-3 text-center positive font-bold tabular-nums">$8.4M</td>
        <td class="px-4 py-3 text-center tabular-nums text-white">$485</td>
        <td class="px-4 py-3"><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 text-xs font-bold">SWEEP</span></td>
      </tr>
      <tr class="border-b border-slate-700/50 bg-emerald-500/5 hover:bg-emerald-500/10 transition-colors">
        <td class="px-4 py-3 text-xs text-slate-400 font-mono">14:18</td>
        <td class="px-4 py-3 font-bold text-white">AAPL</td>
        <td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-emerald-500 text-white text-xs font-bold">CALL</span></td>
        <td class="px-4 py-3 text-center font-mono text-white">$200</td>
        <td class="px-4 py-3 text-center text-slate-300">Dec 20</td>
        <td class="px-4 py-3 text-center font-bold font-mono text-white">8,240</td>
        <td class="px-4 py-3 text-center font-mono text-slate-300">12,480</td>
        <td class="px-4 py-3 text-center text-emerald-400 font-bold font-mono">$2.1M</td>
        <td class="px-4 py-3 text-center font-mono text-white">$189</td>
        <td class="px-4 py-3"><span class="px-2 py-1 rounded bg-sky-500/20 text-sky-400 text-xs font-bold">BLOCK</span></td>
      </tr>
      <tr class="border-b border-slate-700/50 bg-red-500/5 hover:bg-red-500/10 transition-colors">
        <td class="px-4 py-3 text-xs text-slate-400 font-mono">13:54</td>
        <td class="px-4 py-3 font-bold text-white">TSLA</td>
        <td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-red-500 text-white text-xs font-bold">PUT</span></td>
        <td class="px-4 py-3 text-center font-mono text-white">$320</td>
        <td class="px-4 py-3 text-center text-slate-300">Jan 17</td>
        <td class="px-4 py-3 text-center font-bold font-mono text-white">6,840</td>
        <td class="px-4 py-3 text-center font-mono text-slate-300">1,240</td>
        <td class="px-4 py-3 text-center text-red-400 font-bold font-mono">$4.8M</td>
        <td class="px-4 py-3 text-center font-mono text-white">$356</td>
        <td class="px-4 py-3"><span class="px-2 py-1 rounded bg-red-500/20 text-red-400 text-xs font-bold">SWEEP</span></td>
      </tr>
      <tr class="border-b border-slate-700/50 bg-emerald-500/5 hover:bg-emerald-500/10 transition-colors">
        <td class="px-4 py-3 text-xs text-slate-400 font-mono">13:22</td>
        <td class="px-4 py-3 font-bold text-white">META</td>
        <td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-emerald-500 text-white text-xs font-bold">CALL</span></td>
        <td class="px-4 py-3 text-center font-mono text-white">$600</td>
        <td class="px-4 py-3 text-center text-slate-300">Mar 21</td>
        <td class="px-4 py-3 text-center font-bold font-mono text-white">4,280</td>
        <td class="px-4 py-3 text-center font-mono text-slate-300">840</td>
        <td class="px-4 py-3 text-center text-emerald-400 font-bold font-mono">$3.2M</td>
        <td class="px-4 py-3 text-center font-mono text-white">$568</td>
        <td class="px-4 py-3"><span class="px-2 py-1 rounded bg-purple-500/20 text-purple-400 text-xs font-bold">UNUSUAL</span></td>
      </tr>
      <tr class="border-b border-slate-700/50 hover:bg-slate-800/50 transition-colors">
        <td class="px-4 py-3 text-xs text-slate-400 font-mono">12:48</td>
        <td class="px-4 py-3 font-bold text-white">AMZN</td>
        <td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-emerald-500 text-white text-xs font-bold">CALL</span></td>
        <td class="px-4 py-3 text-center font-mono text-white">$200</td>
        <td class="px-4 py-3 text-center text-slate-300">Jan 17</td>
        <td class="px-4 py-3 text-center font-bold font-mono text-white">5,620</td>
        <td class="px-4 py-3 text-center font-mono text-slate-300">8,420</td>
        <td class="px-4 py-3 text-center text-emerald-400 font-bold font-mono">$1.8M</td>
        <td class="px-4 py-3 text-center font-mono text-white">$185</td>
        <td class="px-4 py-3"><span class="px-2 py-1 rounded bg-sky-500/20 text-sky-400 text-xs font-bold">BLOCK</span></td>
      </tr>
    </tbody>
</table>
</div>

<!-- Flow Charts -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <div class="bloomberg-card p-5">
    <h3 class="font-semibold text-amber-400 uppercase tracking-wider mb-4">Premium Flow by Ticker</h3>
    <div class="h-48"><canvas id="flowChart"></canvas></div>
  </div>
  <div class="bloomberg-card p-5">
    <h3 class="font-semibold text-amber-400 uppercase tracking-wider mb-4">Call vs Put Premium</h3>
    <div class="h-48"><canvas id="cpChart"></canvas></div>
  </div>
</div>

<!-- Hot Tickers -->
<div class="bloomberg-card p-5">
  <h3 class="font-semibold text-amber-400 uppercase tracking-wider mb-4">Most Active Option Tickers</h3>
  <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
    <div class="p-4 rounded text-center bg-emerald-500/10 border border-emerald-500/20">
      <p class="font-bold text-lg text-white">NVDA</p>
      <p class="text-emerald-400 font-bold tabular-nums">$42.8M</p>
      <p class="text-xs text-slate-400">78% calls</p>
    </div>
    <div class="p-4 rounded-lg text-center bg-emerald-500/10 border border-emerald-500/20">
      <p class="font-bold text-lg text-white">TSLA</p>
      <p class="text-emerald-400 font-bold font-mono">$28.4M</p>
      <p class="text-xs text-slate-400">52% calls</p>
    </div>
    <div class="p-4 rounded-lg text-center bg-emerald-500/10 border border-emerald-500/20">
      <p class="font-bold text-lg text-white">AAPL</p>
      <p class="text-emerald-400 font-bold font-mono">$18.2M</p>
      <p class="text-xs text-slate-400">65% calls</p>
    </div>
    <div class="p-4 rounded-lg text-center bg-red-500/10 border border-red-500/20">
      <p class="font-bold text-lg text-white">SPY</p>
      <p class="text-red-400 font-bold font-mono">$124.6M</p>
      <p class="text-xs text-slate-400">58% puts</p>
    </div>
    <div class="p-4 rounded-lg text-center bg-emerald-500/10 border border-emerald-500/20">
      <p class="font-bold text-lg text-white">META</p>
      <p class="text-emerald-400 font-bold font-mono">$12.4M</p>
      <p class="text-xs text-slate-400">72% calls</p>
    </div>
  </div>
</div>
</div></div></main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Chart(document.getElementById('flowChart'), {
  type: 'bar',
  data: {
    labels: ['NVDA','TSLA','SPY','AAPL','META','AMZN'],
    datasets: [
      { label: 'Call', data: [33.4,14.8,52.4,11.8,8.9,7.2], backgroundColor: '#10b981' },
      { label: 'Put', data: [9.4,13.6,72.2,6.4,3.5,4.1], backgroundColor: '#ef4444' }
    ]
  },
  options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, scales: { x: { stacked: true }, y: { stacked: true } } }
});
new Chart(document.getElementById('cpChart'), {
  type: 'doughnut',
  data: { labels: ['Call Premium','Put Premium'], datasets: [{ data: [2.8,1.4], backgroundColor: ['#10b981','#ef4444'] }] },
  options: { responsive: true, maintainAspectRatio: false }
});
</script>
<%- include('../partials/footer') %>
