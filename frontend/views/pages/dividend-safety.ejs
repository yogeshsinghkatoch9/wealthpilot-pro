<%
// Safe defaults for potentially undefined variables
const safeTheme = typeof theme !== 'undefined' ? theme : 'dark';
const safeUser = typeof user !== 'undefined' ? user : {};
const safePageTitle = typeof pageTitle !== 'undefined' ? pageTitle : 'Dividend Safety';
%>
<%- include('../partials/header', { pageTitle: 'Dividend Safety' }) %>

<!-- Bloomberg-style Header Bar -->
<div class="bloomberg-header">
<div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
<div>
<h1 class="text-2xl font-bold text-green-400">DIVIDEND SAFETY SCORE</h1>
<p class="text-slate-400 text-sm font-mono">Comprehensive dividend sustainability analysis</p>
</div>
<div class="flex gap-2">
<select class="form-input w-40 bg-slate-800 border-green-400/30 text-slate-200 font-mono text-sm">
<option selected>Dividend Payers</option>
<option>All Holdings</option>
</select>
</div>
</div>
</div>

<!-- Safety Summary -->
<div class="bloomberg-card p-5 bg-gradient-to-r from-emerald-900/20 to-sky-900/20 border-l-4 border-green-400">
<h3 class="font-semibold text-green-400 mb-4 font-mono uppercase tracking-wide">Portfolio Dividend Safety Overview</h3>
<div class="grid grid-cols-2 md:grid-cols-5 gap-4">
<div class="text-center">
<p class="text-sm text-slate-400 font-mono">Avg Safety Score</p>
<p class="text-3xl font-bold text-emerald-400 font-mono">78/100</p>
<p class="text-xs text-emerald-400 font-mono">Safe</p>
</div>
<div class="text-center">
<p class="text-sm text-slate-400 font-mono">Very Safe (80+)</p>
<p class="text-3xl font-bold text-emerald-400 font-mono">6</p>
<p class="text-xs text-slate-300 font-mono">holdings</p>
</div>
<div class="text-center">
<p class="text-sm text-slate-400 font-mono">Safe (60-79)</p>
<p class="text-3xl font-bold text-sky-400 font-mono">4</p>
<p class="text-xs text-slate-300 font-mono">holdings</p>
</div>
<div class="text-center">
<p class="text-sm text-slate-400 font-mono">Borderline (40-59)</p>
<p class="text-3xl font-bold text-green-400 font-mono">2</p>
<p class="text-xs text-slate-300 font-mono">holdings</p>
</div>
<div class="text-center">
<p class="text-sm text-slate-400 font-mono">Unsafe (<40)</p>
<p class="text-3xl font-bold text-red-400 font-mono">1</p>
<p class="text-xs text-green-400 font-mono">REVIEW</p>
</div>
</div>
</div>

<!-- Safety Score Components -->
<div class="bloomberg-card p-4">
<p class="text-xs text-slate-400 mb-3 font-mono">Safety Score based on: Payout Ratio (25%), Free Cash Flow (25%), Debt Levels (20%), Earnings Stability (15%), Dividend History (15%)</p>
<div class="flex items-center gap-2">
<div class="flex-1 h-6 rounded bg-gradient-to-r from-red-500 via-amber-500 to-emerald-500 border border-slate-700"></div>
</div>
<div class="flex justify-between text-xs mt-2 font-mono">
<span class="text-red-400">0-39 Unsafe</span>
<span class="text-green-400">40-59 Borderline</span>
<span class="text-sky-400">60-79 Safe</span>
<span class="text-emerald-400">80-100 Very Safe</span>
</div>
</div>

<!-- Holdings Safety Table -->
<div class="card overflow-hidden">
<div class="p-4 border-b <%= theme === 'light' ? 'border-gray-200' : 'border-slate-700' %>">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">Holdings Dividend Safety Analysis</h3>
</div>
<table class="w-full text-sm">
<thead>
<tr class="<%= theme === 'light' ? 'bg-gray-50 text-gray-500' : 'bg-slate-800 text-slate-400' %> text-left">
<th class="px-4 py-3">Stock</th>
<th class="px-4 py-3 text-center">Yield</th>
<th class="px-4 py-3 text-center">Payout</th>
<th class="px-4 py-3 text-center">FCF Cover</th>
<th class="px-4 py-3 text-center">Debt/Equity</th>
<th class="px-4 py-3 text-center">Streak</th>
<th class="px-4 py-3 text-center">Safety Score</th>
<th class="px-4 py-3 text-center">Rating</th>
</tr>
</thead>
<tbody class="<%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">JNJ</div><span class="font-medium">J&J</span></div></td>
<td class="px-4 py-3 text-center">2.94%</td>
<td class="px-4 py-3 text-center text-emerald-400">47%</td>
<td class="px-4 py-3 text-center text-emerald-400">1.8x</td>
<td class="px-4 py-3 text-center text-emerald-400">0.42</td>
<td class="px-4 py-3 text-center font-bold">62 yrs</td>
<td class="px-4 py-3 text-center"><span class="text-2xl font-bold text-emerald-400">92</span></td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 text-xs">Very Safe</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">MSFT</div><span class="font-medium">Microsoft</span></div></td>
<td class="px-4 py-3 text-center">0.70%</td>
<td class="px-4 py-3 text-center text-emerald-400">25%</td>
<td class="px-4 py-3 text-center text-emerald-400">3.2x</td>
<td class="px-4 py-3 text-center text-emerald-400">0.28</td>
<td class="px-4 py-3 text-center font-bold">22 yrs</td>
<td class="px-4 py-3 text-center"><span class="text-2xl font-bold text-emerald-400">95</span></td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 text-xs">Very Safe</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white text-xs font-bold">VZ</div><span class="font-medium">Verizon</span></div></td>
<td class="px-4 py-3 text-center text-green-400">6.82%</td>
<td class="px-4 py-3 text-center text-green-400">56%</td>
<td class="px-4 py-3 text-center text-green-400">1.4x</td>
<td class="px-4 py-3 text-center text-green-400">1.62</td>
<td class="px-4 py-3 text-center">19 yrs</td>
<td class="px-4 py-3 text-center"><span class="text-2xl font-bold text-sky-400">68</span></td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-sky-500/20 text-sky-400 text-xs">Safe</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white text-xs font-bold">T</div><span class="font-medium">AT&T</span></div></td>
<td class="px-4 py-3 text-center text-green-400">5.48%</td>
<td class="px-4 py-3 text-center text-green-400">51%</td>
<td class="px-4 py-3 text-center text-red-400">0.8x</td>
<td class="px-4 py-3 text-center text-red-400">1.84</td>
<td class="px-4 py-3 text-center text-green-400">2 yrs*</td>
<td class="px-4 py-3 text-center"><span class="text-2xl font-bold text-green-400">48</span></td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-green-500/20 text-green-400 text-xs">Borderline</span></td>
</tr>
<tr>
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">INTC</div><span class="font-medium">Intel</span></div></td>
<td class="px-4 py-3 text-center text-green-400">1.65%</td>
<td class="px-4 py-3 text-center text-red-400">N/M</td>
<td class="px-4 py-3 text-center text-red-400">N/A</td>
<td class="px-4 py-3 text-center text-green-400">0.48</td>
<td class="px-4 py-3 text-center text-red-400">1 yr*</td>
<td class="px-4 py-3 text-center"><span class="text-2xl font-bold text-red-400">28</span></td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-red-500/20 text-red-400 text-xs">Unsafe</span></td>
</tr>
</tbody>
</table>
<p class="p-3 text-xs <%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">* Recently cut dividend</p>
</div>

<!-- Safety Breakdown -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div class="card p-5">
<h4 class="font-bold text-emerald-400 mb-3">‚úÖ Most Reliable</h4>
<p class="text-xs <%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %> mb-3">25+ year dividend streak</p>
<div class="space-y-2">
<div class="flex justify-between"><span>JNJ</span><span class="font-bold">62 years</span></div>
<div class="flex justify-between"><span>KO</span><span class="font-bold">62 years</span></div>
<div class="flex justify-between"><span>PG</span><span class="font-bold">68 years</span></div>
</div>
</div>
<div class="card p-5">
<h4 class="font-bold text-sky-400 mb-3">üí∞ Best FCF Coverage</h4>
<p class="text-xs <%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %> mb-3">Dividend well covered by cash</p>
<div class="space-y-2">
<div class="flex justify-between"><span>AAPL</span><span class="font-bold text-emerald-400">7.6x</span></div>
<div class="flex justify-between"><span>NVDA</span><span class="font-bold text-emerald-400">42.8x</span></div>
<div class="flex justify-between"><span>MSFT</span><span class="font-bold text-emerald-400">3.2x</span></div>
</div>
</div>
<div class="card p-5">
<h4 class="font-bold text-red-400 mb-3">‚ö†Ô∏è Cut Risk</h4>
<p class="text-xs <%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %> mb-3">Low coverage or recent cuts</p>
<div class="space-y-2">
<div class="flex justify-between"><span>INTC</span><span class="font-bold text-red-400">Score: 28</span></div>
<div class="flex justify-between"><span>T</span><span class="font-bold text-green-400">Score: 48</span></div>
<div class="flex justify-between"><span>WBA</span><span class="font-bold text-red-400">Score: 32</span></div>
</div>
</div>
</div>

<!-- Charts -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div class="card p-5">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Safety Score Distribution</h3>
<div class="h-48"><canvas id="distChart"></canvas></div>
</div>
<div class="card p-5">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">JNJ Safety Breakdown</h3>
<div class="h-48"><canvas id="radarChart"></canvas></div>
</div>
</div>
</div></div></main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Chart(document.getElementById('distChart'), {
  type: 'doughnut',
  data: { labels: ['Very Safe 80+','Safe 60-79','Borderline 40-59','Unsafe <40'], datasets: [{ data: [6,4,2,1], backgroundColor: ['#10b981','#0ea5e9','#f59e0b','#ef4444'] }] },
  options: { responsive: true, maintainAspectRatio: false }
});
new Chart(document.getElementById('radarChart'), {
  type: 'radar',
  data: { labels: ['Payout Ratio','FCF Coverage','Debt Level','Earnings Stability','Dividend History'], datasets: [
    { label: 'JNJ', data: [90,85,92,88,100], borderColor: '#10b981', backgroundColor: 'rgba(16,185,129,0.2)' },
    { label: 'Avg', data: [70,70,70,70,70], borderColor: '#94a3b8', borderDash: [5,5], backgroundColor: 'transparent' }
  ]},
  options: { responsive: true, maintainAspectRatio: false, scales: { r: { min: 0, max: 100 } } }
});
</script>
<%- include('../partials/footer') %>
