<%
// Safe defaults for potentially undefined variables
const safeTheme = typeof theme !== 'undefined' ? theme : 'dark';
const safeUser = typeof user !== 'undefined' ? user : null;
const safePageTitle = typeof pageTitle !== 'undefined' ? pageTitle : 'Dividend Screener';
%>
<%- include('../partials/header', { pageTitle: safePageTitle }) %>

<!-- Bloomberg-style header bar -->
<div class="bg-slate-900 border-b-2 border-amber-400 px-6 py-4 -mx-6 -mt-6 mb-6">
  <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
    <div>
      <h1 class="text-2xl font-bold text-amber-400 font-mono tracking-tight">DIVIDEND SCREENER</h1>
      <p class="text-slate-400 text-sm mt-1">Find the best dividend stocks for your portfolio</p>
    </div>
    <div class="flex gap-2">
      <button onclick="saveScreen()" class="bloomberg-btn bloomberg-btn-secondary">SAVE SCREEN</button>
      <button onclick="runScreen()" class="bloomberg-btn bloomberg-btn-primary">RUN SCREENER</button>
    </div>
  </div>
</div>

<!-- Quick Filters -->
<div class="bloomberg-card">
  <h3 class="text-amber-400 font-mono font-semibold mb-4 text-sm tracking-wide">QUICK FILTERS</h3>
  <div class="flex flex-wrap gap-2 mb-4">
    <button onclick="applyPreset('aristocrats')" class="bloomberg-btn bloomberg-btn-filter">DIVIDEND ARISTOCRATS</button>
    <button onclick="applyPreset('high-yield')" class="bloomberg-btn bloomberg-btn-filter">HIGH YIELD (>4%)</button>
    <button onclick="applyPreset('growth')" class="bloomberg-btn bloomberg-btn-filter">DIVIDEND GROWTH</button>
    <button onclick="applyPreset('safe')" class="bloomberg-btn bloomberg-btn-filter">SAFE PAYOUT (<50%)</button>
    <button onclick="applyPreset('monthly')" class="bloomberg-btn bloomberg-btn-filter">MONTHLY PAYERS</button>
  </div>
  <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
    <div>
      <label class="text-xs text-slate-400 uppercase font-mono tracking-wide block mb-1">Min Yield</label>
      <input type="text" value="2%" class="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 text-white font-mono focus:outline-none focus:border-amber-400">
    </div>
    <div>
      <label class="text-xs text-slate-400 uppercase font-mono tracking-wide block mb-1">Max Yield</label>
      <input type="text" value="10%" class="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 text-white font-mono focus:outline-none focus:border-amber-400">
    </div>
    <div>
      <label class="text-xs text-slate-400 uppercase font-mono tracking-wide block mb-1">Min Years Inc.</label>
      <input type="text" value="5" class="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 text-white font-mono focus:outline-none focus:border-amber-400">
    </div>
    <div>
      <label class="text-xs text-slate-400 uppercase font-mono tracking-wide block mb-1">Max Payout</label>
      <input type="text" value="75%" class="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 text-white font-mono focus:outline-none focus:border-amber-400">
    </div>
    <div>
      <label class="text-xs text-slate-400 uppercase font-mono tracking-wide block mb-1">Min Market Cap</label>
      <select class="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 text-white font-mono focus:outline-none focus:border-amber-400">
        <option>Any</option>
        <option selected>$1B+</option>
        <option>$10B+</option>
        <option>$100B+</option>
      </select>
    </div>
    <div>
      <label class="text-xs text-slate-400 uppercase font-mono tracking-wide block mb-1">Sector</label>
      <select class="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 text-white font-mono focus:outline-none focus:border-amber-400">
        <option selected>All Sectors</option>
        <option>Utilities</option>
        <option>REITs</option>
        <option>Consumer Staples</option>
        <option>Healthcare</option>
        <option>Financials</option>
      </select>
    </div>
  </div>
</div>

<!-- Results Summary -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-4">
  <div class="tufte-stat-card">
    <p class="text-slate-400 text-xs uppercase font-mono tracking-wide">Matches</p>
    <p class="text-2xl font-bold text-white font-mono tabular-nums mt-2">47 Stocks</p>
    <p class="text-sm text-slate-400 mt-1">Passed all filters</p>
  </div>
  <div class="tufte-stat-card">
    <p class="text-slate-400 text-xs uppercase font-mono tracking-wide">Avg Yield</p>
    <p class="text-2xl font-bold positive font-mono tabular-nums mt-2">4.2%</p>
    <p class="text-sm text-slate-400 mt-1">In results</p>
  </div>
  <div class="tufte-stat-card">
    <p class="text-slate-400 text-xs uppercase font-mono tracking-wide">Avg Growth</p>
    <p class="text-2xl font-bold text-white font-mono tabular-nums mt-2">8.4%</p>
    <p class="text-sm text-slate-400 mt-1">5Y CAGR</p>
  </div>
  <div class="tufte-stat-card">
    <p class="text-slate-400 text-xs uppercase font-mono tracking-wide">Avg Payout</p>
    <p class="text-2xl font-bold text-white font-mono tabular-nums mt-2">52%</p>
    <p class="text-sm text-slate-400 mt-1">Payout ratio</p>
  </div>
</div>

<!-- Results Table -->
<div class="bloomberg-card overflow-hidden">
  <div class="p-4 border-b border-amber-400/30 flex justify-between items-center">
    <h3 class="font-semibold text-amber-400 font-mono text-sm tracking-wide">SCREENER RESULTS</h3>
    <select class="bg-slate-800 border border-slate-700 rounded px-3 py-2 text-white font-mono text-xs focus:outline-none focus:border-amber-400">
      <option>Sort: Yield ↓</option>
      <option>Sort: Growth ↓</option>
      <option>Sort: Years ↓</option>
      <option>Sort: Safety ↑</option>
    </select>
  </div>
  <table class="bloomberg-table">
    <thead>
      <tr>
        <th>STOCK</th>
        <th>YIELD</th>
        <th>ANNUAL DIV</th>
        <th>5Y GROWTH</th>
        <th>YEARS ↑</th>
        <th>PAYOUT</th>
        <th>EX-DATE</th>
        <th>SCORE</th>
        <th></th>
      </tr>
    </thead>
<tbody>
      <tr>
        <td>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold">O</div>
            <div>
              <p class="font-bold text-white">Realty Income</p>
              <p class="text-xs text-slate-400">REIT • <span class="font-mono">$54.82</span></p>
            </div>
          </div>
        </td>
        <td class="font-bold text-emerald-400 font-mono">5.82%</td>
        <td class="font-mono">$3.19</td>
        <td class="text-sky-400 font-mono">+4.2%</td>
        <td><span class="px-2 py-1 rounded bg-purple-500/20 text-purple-400 text-xs font-bold font-mono">29</span></td>
        <td class="font-mono">76%</td>
        <td>Dec 29</td>
        <td><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 font-bold font-mono">92</span></td>
        <td><button class="bloomberg-btn bloomberg-btn-sm">ADD</button></td>
      </tr>
<tr>
        <td>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-white text-xs font-bold">JNJ</div>
            <div>
              <p class="font-bold text-white">Johnson & Johnson</p>
              <p class="text-xs text-slate-400">Healthcare • <span class="font-mono">$158.40</span></p>
            </div>
          </div>
        </td>
        <td class="font-bold text-emerald-400 font-mono">3.02%</td>
        <td class="font-mono">$4.78</td>
        <td class="text-sky-400 font-mono">+5.8%</td>
        <td><span class="px-2 py-1 rounded bg-purple-500/20 text-purple-400 text-xs font-bold font-mono">62</span></td>
        <td class="font-mono">44%</td>
        <td>Feb 24</td>
        <td><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 font-bold font-mono">95</span></td>
        <td><button class="bloomberg-btn bloomberg-btn-sm">ADD</button></td>
      </tr>
<tr>
        <td>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white text-xs font-bold">KO</div>
            <div>
              <p class="font-bold text-white">Coca-Cola</p>
              <p class="text-xs text-slate-400">Consumer • <span class="font-mono">$59.20</span></p>
            </div>
          </div>
        </td>
        <td class="font-bold text-emerald-400 font-mono">3.14%</td>
        <td class="font-mono">$1.86</td>
        <td class="text-sky-400 font-mono">+3.4%</td>
        <td><span class="px-2 py-1 rounded bg-purple-500/20 text-purple-400 text-xs font-bold font-mono">62</span></td>
        <td class="font-mono">68%</td>
        <td>Mar 14</td>
        <td><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 font-bold font-mono">88</span></td>
        <td><button class="bloomberg-btn bloomberg-btn-sm">ADD</button></td>
      </tr>
<tr>
        <td>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">PG</div>
            <div>
              <p class="font-bold text-white">Procter & Gamble</p>
              <p class="text-xs text-slate-400">Consumer • <span class="font-mono">$158.90</span></p>
            </div>
          </div>
        </td>
        <td class="font-bold text-emerald-400 font-mono">2.48%</td>
        <td class="font-mono">$3.94</td>
        <td class="text-sky-400 font-mono">+6.2%</td>
        <td><span class="px-2 py-1 rounded bg-purple-500/20 text-purple-400 text-xs font-bold font-mono">68</span></td>
        <td class="font-mono">58%</td>
        <td>Jan 18</td>
        <td><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 font-bold font-mono">94</span></td>
        <td><button class="bloomberg-btn bloomberg-btn-sm">ADD</button></td>
      </tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-4">
<div class="flex items-center gap-3">
<div class="w-10 h-10 rounded bg-gradient-to-br from-indigo-500 to-indigo-600 flex items-center justify-center text-white text-xs font-bold">T</div>
<div><p class="font-bold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">AT&T</p><p class="text-xs <%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">Telecom • $17.40</p></div>
</div>
</td>
<td class="px-4 py-4 font-bold text-emerald-400">6.32%</td>
<td class="px-4 py-4">$1.10</td>
<td class="px-4 py-4 text-red-400">-46%</td>
<td class="px-4 py-4"><span class="px-2 py-1 rounded bg-amber-500/20 text-amber-400 text-xs font-bold">2</span></td>
<td class="px-4 py-4">52%</td>
<td class="px-4 py-4">Jan 9</td>
<td class="px-4 py-4"><span class="px-2 py-1 rounded bg-amber-500/20 text-amber-400 font-bold">62</span></td>
<td class="px-4 py-4"><button class="btn-ghost btn-sm">Add</button></td>
</tr>
</tbody>
</table>
</div>
</div></div></main>

<script>
function saveScreen() { showToast('Screen saved!', 'success'); }
function runScreen() { showToast('Running screener...', 'info'); }
function applyPreset(preset) { showToast(`Applied ${preset} preset`, 'success'); }
</script>
<%- include('../partials/footer') %>
