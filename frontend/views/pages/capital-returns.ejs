<%
// Safe defaults for potentially undefined variables
const safeTheme = typeof theme !== 'undefined' ? theme : 'dark';
%>
<%- include('../partials/header', { pageTitle: 'Capital Returns' }) %>

<!-- Bloomberg Header Bar -->
<div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6 pb-4 border-b-2 border-amber-400">
<div>
<h1 class="text-2xl font-bold text-amber-400 font-mono">CAPITAL RETURNS</h1>
<p class="<%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %> text-sm">Total shareholder yield: dividends + buybacks</p>
</div>
<div class="flex gap-2">
<select class="form-input w-32 bg-black border-amber-400/30 text-amber-400 font-mono">
<option selected>My Holdings</option>
<option>Watchlist</option>
<option>High Yield</option>
</select>
</div>
</div>

<!-- Capital Returns Summary -->
<div class="card p-5">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Portfolio Capital Returns</h3>
<div class="grid grid-cols-2 md:grid-cols-5 gap-4">
<div class="tufte-stat-card">
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Total Shareholder Yield</p>
<p class="text-3xl font-bold text-purple-400 tabular-nums">4.8%</p>
<p class="text-xs positive tabular-nums">Above S&P 3.2%</p>
</div>
<div class="text-center">
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Dividend Yield</p>
<p class="text-3xl font-bold text-emerald-400">1.8%</p>
<p class="text-xs">$4,982/year</p>
</div>
<div class="text-center">
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Buyback Yield</p>
<p class="text-3xl font-bold text-sky-400">3.0%</p>
<p class="text-xs">Share reduction</p>
</div>
<div class="text-center">
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Capital Returned</p>
<p class="text-3xl font-bold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">$248B</p>
<p class="text-xs">TTM (holdings)</p>
</div>
<div class="text-center">
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Yield > 5%</p>
<p class="text-3xl font-bold text-purple-400">5</p>
<p class="text-xs">holdings</p>
</div>
</div>
</div>

<!-- Holdings Capital Returns Table -->
<div class="card overflow-hidden">
<div class="p-4 border-b <%= theme === 'light' ? 'border-gray-200' : 'border-slate-700' %>">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">Holdings Shareholder Yield</h3>
</div>
<table class="w-full text-sm">
<thead>
<tr class="<%= theme === 'light' ? 'bg-gray-50 text-gray-500' : 'bg-slate-800 text-slate-400' %> text-left">
<th class="px-4 py-3">Stock</th>
<th class="px-4 py-3 text-center">Div Yield</th>
<th class="px-4 py-3 text-center">Buyback Yield</th>
<th class="px-4 py-3 text-center">Total Yield</th>
<th class="px-4 py-3">Yield Breakdown</th>
<th class="px-4 py-3 text-center">TTM Returned</th>
<th class="px-4 py-3 text-center">5Y Avg</th>
</tr>
</thead>
<tbody class="<%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><span class="font-medium">AAPL Apple</span></div></td>
<td class="px-4 py-3 text-center positive tabular-nums">0.5%</td>
<td class="px-4 py-3 text-center text-sky-400 font-bold tabular-nums">3.4%</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-purple-500/20 text-purple-400 font-bold tabular-nums">3.9%</span></td>
<td class="px-4 py-3"><div class="flex gap-0.5"><div class="h-3 bg-emerald-500 rounded-l" style="width:13%"></div><div class="h-3 bg-sky-500 rounded-r" style="width:87%"></div></div></td>
<td class="px-4 py-3 text-center">$112.8B</td>
<td class="px-4 py-3 text-center">4.2%</td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">META</div><span class="font-medium">Meta</span></div></td>
<td class="px-4 py-3 text-center text-emerald-400">0.4%</td>
<td class="px-4 py-3 text-center text-sky-400 font-bold">4.8%</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-purple-500/20 text-purple-400 font-bold">5.2%</span></td>
<td class="px-4 py-3"><div class="flex gap-0.5"><div class="h-3 bg-emerald-500 rounded-l" style="width:8%"></div><div class="h-3 bg-sky-500 rounded-r" style="width:92%"></div></div></td>
<td class="px-4 py-3 text-center">$58.4B</td>
<td class="px-4 py-3 text-center">3.8%</td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-white text-xs font-bold">JNJ</div><span class="font-medium">J&J</span></div></td>
<td class="px-4 py-3 text-center text-emerald-400 font-bold">2.9%</td>
<td class="px-4 py-3 text-center text-sky-400">1.2%</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-purple-500/20 text-purple-400 font-bold">4.1%</span></td>
<td class="px-4 py-3"><div class="flex gap-0.5"><div class="h-3 bg-emerald-500 rounded-l" style="width:71%"></div><div class="h-3 bg-sky-500 rounded-r" style="width:29%"></div></div></td>
<td class="px-4 py-3 text-center">$18.2B</td>
<td class="px-4 py-3 text-center">4.4%</td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">MSFT</div><span class="font-medium">Microsoft</span></div></td>
<td class="px-4 py-3 text-center text-emerald-400">0.7%</td>
<td class="px-4 py-3 text-center text-sky-400">2.2%</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-sky-500/20 text-sky-400 font-bold">2.9%</span></td>
<td class="px-4 py-3"><div class="flex gap-0.5"><div class="h-3 bg-emerald-500 rounded-l" style="width:24%"></div><div class="h-3 bg-sky-500 rounded-r" style="width:76%"></div></div></td>
<td class="px-4 py-3 text-center">$84.6B</td>
<td class="px-4 py-3 text-center">3.2%</td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white text-xs font-bold">TSLA</div><span class="font-medium">Tesla</span></div></td>
<td class="px-4 py-3 text-center <%= theme === 'light' ? 'text-gray-400' : 'text-slate-500' %>">0%</td>
<td class="px-4 py-3 text-center <%= theme === 'light' ? 'text-gray-400' : 'text-slate-500' %>">0%</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-slate-500/20 text-slate-400 font-bold">0%</span></td>
<td class="px-4 py-3"><div class="h-3 rounded <%= theme === 'light' ? 'bg-gray-200' : 'bg-slate-700' %>"></div></td>
<td class="px-4 py-3 text-center">$0</td>
<td class="px-4 py-3 text-center">0%</td>
</tr>
</tbody>
</table>
</div>

<!-- Breakdown Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div class="card p-5">
<h4 class="font-bold positive mb-3">Dividend Focus</h4>
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %> mb-3">Top dividend payers</p>
<div class="space-y-2">
<div class="flex justify-between"><span>JNJ</span><span class="font-bold text-emerald-400">2.94%</span></div>
<div class="flex justify-between"><span>KO</span><span class="font-bold text-emerald-400">3.12%</span></div>
<div class="flex justify-between"><span>VZ</span><span class="font-bold text-emerald-400">6.48%</span></div>
</div>
</div>
<div class="card p-5">
<h4 class="font-bold text-sky-400 mb-3">üîÑ Buyback Focus</h4>
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %> mb-3">Top buyback yield</p>
<div class="space-y-2">
<div class="flex justify-between"><span>META</span><span class="font-bold text-sky-400">4.8%</span></div>
<div class="flex justify-between"><span>AAPL</span><span class="font-bold text-sky-400">3.4%</span></div>
<div class="flex justify-between"><span>GOOGL</span><span class="font-bold text-sky-400">2.8%</span></div>
</div>
</div>
<div class="card p-5">
<h4 class="font-bold text-purple-400 mb-3">üèÜ Total Yield Leaders</h4>
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %> mb-3">Combined yield</p>
<div class="space-y-2">
<div class="flex justify-between"><span>VZ</span><span class="font-bold text-purple-400">8.2%</span></div>
<div class="flex justify-between"><span>META</span><span class="font-bold text-purple-400">5.2%</span></div>
<div class="flex justify-between"><span>JNJ</span><span class="font-bold text-purple-400">4.1%</span></div>
</div>
</div>
</div>

<!-- Charts -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div class="card p-5">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Capital Returns Breakdown</h3>
<div class="h-48"><canvas id="breakdownChart"></canvas></div>
</div>
<div class="card p-5">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">5-Year Capital Returns Trend</h3>
<div class="h-48"><canvas id="trendChart"></canvas></div>
</div>
</div>
</div></div></main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Chart(document.getElementById('breakdownChart'), {
  type: 'bar',
  data: { labels: ['AAPL','META','JNJ','MSFT','GOOGL','NVDA'], datasets: [
    { label: 'Dividends', data: [0.5,0.4,2.9,0.7,0,0], backgroundColor: '#10b981' },
    { label: 'Buybacks', data: [3.4,4.8,1.2,2.2,2.8,0.8], backgroundColor: '#0ea5e9' }
  ]},
  options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true } } }
});
new Chart(document.getElementById('trendChart'), {
  type: 'line',
  data: { labels: ['2020','2021','2022','2023','2024'], datasets: [
    { label: 'Dividends', data: [1.4,1.5,1.6,1.7,1.8], borderColor: '#10b981', fill: false },
    { label: 'Buybacks', data: [2.2,2.6,2.8,2.9,3.0], borderColor: '#0ea5e9', fill: false },
    { label: 'Total', data: [3.6,4.1,4.4,4.6,4.8], borderColor: '#8b5cf6', fill: false }
  ]},
  options: { responsive: true, maintainAspectRatio: false }
});
</script>
<%- include('../partials/footer') %>
