<%
// Safe defaults for all potentially undefined variables
const safeTheme = typeof theme !== 'undefined' ? theme : 'dark';
const safeUser = typeof user !== 'undefined' ? user : {};
const safePageTitle = typeof pageTitle !== 'undefined' ? pageTitle : 'Debt Maturity Schedule';
%>
<%- include('../partials/header', { pageTitle: safePageTitle }) %>

<!-- Bloomberg Header Bar -->
<div class="bloomberg-header mb-6">
<div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
<div>
<h1 class="text-2xl font-bold text-amber-400">Debt Maturity Schedule</h1>
<p class="<%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %> mt-1">Corporate bond maturities & refinancing risk</p>
</div>
<div class="flex gap-2">
<select class="form-input w-36"><option selected>My Holdings</option><option>Watchlist</option></select>
<select class="form-input w-28"><option selected>All Years</option><option>Next 3Y</option><option>Next 5Y</option></select>
</div>
</div>
</div>

<!-- Debt Summary -->
<div class="bloomberg-card p-5 bg-gradient-to-r <%= safeTheme === 'light' ? 'from-red-50 to-amber-50' : 'from-red-900/20 to-amber-900/20' %>">
<h3 class="font-semibold <%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Portfolio Debt Overview</h3>
<div class="grid grid-cols-2 md:grid-cols-5 gap-4">
<div class="text-center">
<p class="text-sm <%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Total Debt Held</p>
<p class="text-3xl font-bold font-mono <%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %>">$842B</p>
<p class="text-xs">across holdings</p>
</div>
<div class="text-center">
<p class="text-sm <%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Maturing 2025</p>
<p class="text-3xl font-bold font-mono text-amber-400">$124B</p>
<p class="text-xs">14.7% of total</p>
</div>
<div class="text-center">
<p class="text-sm <%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Maturing 2026</p>
<p class="text-3xl font-bold font-mono text-sky-400">$186B</p>
<p class="text-xs">22.1% of total</p>
</div>
<div class="text-center">
<p class="text-sm <%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Avg Coupon</p>
<p class="text-3xl font-bold font-mono text-emerald-400">3.8%</p>
<p class="text-xs text-emerald-400">below market</p>
</div>
<div class="text-center">
<p class="text-sm <%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Refinance Risk</p>
<p class="text-3xl font-bold font-mono text-amber-400">Medium</p>
<p class="text-xs">2 high risk</p>
</div>
</div>
</div>

<!-- Maturity by Year -->
<div class="bloomberg-card p-5">
<h3 class="font-semibold <%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Maturity Wall</h3>
<div class="h-56"><canvas id="maturityChart"></canvas></div>
</div>

<!-- Holdings Debt Table -->
<div class="card overflow-hidden">
<div class="p-4 border-b <%= theme === 'light' ? 'border-gray-200' : 'border-slate-700' %>">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">Holdings Debt Profile</h3>
</div>
<table class="w-full text-sm">
<thead>
<tr class="<%= theme === 'light' ? 'bg-gray-50 text-gray-500' : 'bg-slate-800 text-slate-400' %> text-left">
<th class="px-4 py-3">Company</th>
<th class="px-4 py-3 text-center">Total Debt</th>
<th class="px-4 py-3 text-center">Due 2025</th>
<th class="px-4 py-3 text-center">Due 2026</th>
<th class="px-4 py-3 text-center">Avg Coupon</th>
<th class="px-4 py-3 text-center">Debt/EBITDA</th>
<th class="px-4 py-3 text-center">Risk</th>
</tr>
</thead>
<tbody class="<%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">AAPL</div><span class="font-medium">Apple</span></div></td>
<td class="px-4 py-3 text-center font-bold">$111B</td>
<td class="px-4 py-3 text-center">$12.4B</td>
<td class="px-4 py-3 text-center">$18.2B</td>
<td class="px-4 py-3 text-center">2.9%</td>
<td class="px-4 py-3 text-center text-emerald-400">0.8x</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 text-xs">Low</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">MSFT</div><span class="font-medium">Microsoft</span></div></td>
<td class="px-4 py-3 text-center font-bold">$79B</td>
<td class="px-4 py-3 text-center">$8.2B</td>
<td class="px-4 py-3 text-center">$14.6B</td>
<td class="px-4 py-3 text-center">3.1%</td>
<td class="px-4 py-3 text-center text-emerald-400">0.6x</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 text-xs">Low</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">META</div><span class="font-medium">Meta</span></div></td>
<td class="px-4 py-3 text-center font-bold">$37B</td>
<td class="px-4 py-3 text-center">$0</td>
<td class="px-4 py-3 text-center">$4.8B</td>
<td class="px-4 py-3 text-center">4.2%</td>
<td class="px-4 py-3 text-center text-emerald-400">0.4x</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 text-xs">Low</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white text-xs font-bold">T</div><span class="font-medium">AT&T</span></div></td>
<td class="px-4 py-3 text-center font-bold text-amber-400">$142B</td>
<td class="px-4 py-3 text-center text-amber-400">$18.4B</td>
<td class="px-4 py-3 text-center text-amber-400">$24.2B</td>
<td class="px-4 py-3 text-center">4.8%</td>
<td class="px-4 py-3 text-center text-amber-400">3.2x</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-amber-500/20 text-amber-400 text-xs">Medium</span></td>
</tr>
<tr>
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">BA</div><span class="font-medium">Boeing</span></div></td>
<td class="px-4 py-3 text-center font-bold text-red-400">$58B</td>
<td class="px-4 py-3 text-center text-red-400">$8.2B</td>
<td class="px-4 py-3 text-center text-red-400">$12.4B</td>
<td class="px-4 py-3 text-center">5.2%</td>
<td class="px-4 py-3 text-center text-red-400">N/M</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-red-500/20 text-red-400 text-xs">High</span></td>
</tr>
</tbody>
</table>
</div>

<!-- Refinancing Analysis -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div class="card p-5">
<h4 class="font-bold text-emerald-400 mb-3">‚úÖ Low Risk</h4>
<p class="text-xs <%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %> mb-3">Strong balance sheets, ample liquidity</p>
<div class="space-y-2">
<div class="flex justify-between"><span>AAPL</span><span class="font-bold">$200B cash</span></div>
<div class="flex justify-between"><span>MSFT</span><span class="font-bold">$144B cash</span></div>
<div class="flex justify-between"><span>GOOGL</span><span class="font-bold">$119B cash</span></div>
</div>
</div>
<div class="card p-5">
<h4 class="font-bold text-amber-400 mb-3">‚ö†Ô∏è Monitor</h4>
<p class="text-xs <%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %> mb-3">Higher leverage, watch refinancing costs</p>
<div class="space-y-2">
<div class="flex justify-between"><span>T</span><span class="font-bold">3.2x Debt/EBITDA</span></div>
<div class="flex justify-between"><span>VZ</span><span class="font-bold">2.8x Debt/EBITDA</span></div>
<div class="flex justify-between"><span>CVS</span><span class="font-bold">2.4x Debt/EBITDA</span></div>
</div>
</div>
<div class="card p-5">
<h4 class="font-bold text-red-400 mb-3">üö® Elevated Risk</h4>
<p class="text-xs <%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %> mb-3">Near-term maturities, stress potential</p>
<div class="space-y-2">
<div class="flex justify-between"><span>BA</span><span class="font-bold text-red-400">Neg EBITDA</span></div>
<div class="flex justify-between"><span>INTC</span><span class="font-bold text-red-400">Cash burn</span></div>
</div>
</div>
</div>

<!-- Interest Rate Impact -->
<div class="card p-5">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">üìà Interest Rate Impact Analysis</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<h4 class="font-medium mb-3">Refinancing Cost Increase (if rates +100bp)</h4>
<div class="space-y-2">
<div class="flex items-center justify-between">
<span>AAPL</span>
<div class="flex items-center gap-2">
<div class="w-32 h-2 bg-slate-700 rounded-full"><div class="h-2 bg-emerald-500 rounded-full" style="width:15%"></div></div>
<span class="text-sm">+$124M/yr</span>
</div>
</div>
<div class="flex items-center justify-between">
<span>T</span>
<div class="flex items-center gap-2">
<div class="w-32 h-2 bg-slate-700 rounded-full"><div class="h-2 bg-amber-500 rounded-full" style="width:65%"></div></div>
<span class="text-sm">+$426M/yr</span>
</div>
</div>
<div class="flex items-center justify-between">
<span>BA</span>
<div class="flex items-center gap-2">
<div class="w-32 h-2 bg-slate-700 rounded-full"><div class="h-2 bg-red-500 rounded-full" style="width:85%"></div></div>
<span class="text-sm">+$206M/yr</span>
</div>
</div>
</div>
</div>
<div class="h-40"><canvas id="rateChart"></canvas></div>
</div>
</div>
</div></div></main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Chart(document.getElementById('maturityChart'), {
  type: 'bar',
  data: { labels: ['2025','2026','2027','2028','2029','2030+'], datasets: [{ label: 'Debt Maturing ($B)', data: [124,186,142,98,84,208], backgroundColor: ['#f59e0b','#0ea5e9','#8b5cf6','#10b981','#94a3b8','#64748b'] }] },
  options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
});
new Chart(document.getElementById('rateChart'), {
  type: 'line',
  data: { labels: ['Current','+50bp','+100bp','+150bp','+200bp'], datasets: [
    { label: 'AAPL', data: [0,62,124,186,248], borderColor: '#10b981', fill: false },
    { label: 'T', data: [0,213,426,639,852], borderColor: '#f59e0b', fill: false },
    { label: 'BA', data: [0,103,206,309,412], borderColor: '#ef4444', fill: false }
  ]},
  options: { responsive: true, maintainAspectRatio: false, scales: { y: { title: { display: true, text: 'Additional Cost ($M/yr)' } } } }
});
</script>
<%- include('../partials/footer') %>
