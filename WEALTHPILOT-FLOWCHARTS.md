# WealthPilot Pro - Visual Flowcharts & Diagrams

## System Architecture Overview

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                           WEALTHPILOT PRO SYSTEM                              ║
╠══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────┐    ║
║   │                         USER INTERFACE                               │    ║
║   │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐             │    ║
║   │  │Dashboard │  │Portfolios│  │ Analysis │  │ Research │             │    ║
║   │  │          │  │          │  │          │  │          │             │    ║
║   │  │• Overview│  │• Holdings│  │• Tech    │  │• Peers   │             │    ║
║   │  │• Charts  │  │• Perf    │  │• Options │  │• Insider │             │    ║
║   │  │• Alerts  │  │• Risk    │  │• Factors │  │• Earnings│             │    ║
║   │  └──────────┘  └──────────┘  └──────────┘  └──────────┘             │    ║
║   └─────────────────────────────────────────────────────────────────────┘    ║
║                                    │                                          ║
║                                    ▼                                          ║
║   ┌─────────────────────────────────────────────────────────────────────┐    ║
║   │                      FRONTEND SERVER (Express + EJS)                 │    ║
║   │                           Port: 3000                                 │    ║
║   │  • Route Handling    • Template Rendering    • Session Management    │    ║
║   └─────────────────────────────────────────────────────────────────────┘    ║
║                                    │                                          ║
║                                    ▼                                          ║
║   ┌─────────────────────────────────────────────────────────────────────┐    ║
║   │                      BACKEND API (Express REST)                      │    ║
║   │                           Port: 5000                                 │    ║
║   │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐    │    ║
║   │  │   Auth     │  │ Portfolios │  │  Research  │  │ Analytics  │    │    ║
║   │  │   Routes   │  │   Routes   │  │   Routes   │  │   Routes   │    │    ║
║   │  └────────────┘  └────────────┘  └────────────┘  └────────────┘    │    ║
║   └─────────────────────────────────────────────────────────────────────┘    ║
║                                    │                                          ║
║              ┌─────────────────────┼─────────────────────┐                   ║
║              ▼                     ▼                     ▼                   ║
║   ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐          ║
║   │     DATABASE     │  │      CACHE       │  │  EXTERNAL APIs   │          ║
║   │     (SQLite)     │  │    (In-Memory)   │  │                  │          ║
║   │                  │  │                  │  │ • Yahoo Finance  │          ║
║   │ • Users          │  │ • Quotes (1min)  │  │ • Alpha Vantage  │          ║
║   │ • Portfolios     │  │ • Profiles (1hr) │  │ • Finnhub        │          ║
║   │ • Holdings       │  │ • Analytics      │  │ • OpenAI         │          ║
║   │ • Transactions   │  │                  │  │                  │          ║
║   └──────────────────┘  └──────────────────┘  └──────────────────┘          ║
║                                                                               ║
╚══════════════════════════════════════════════════════════════════════════════╝
```

---

## User Journey Flow

```
                              ┌─────────────┐
                              │   START     │
                              └──────┬──────┘
                                     │
                                     ▼
                          ┌─────────────────────┐
                          │   Landing Page      │
                          │   /welcome          │
                          └──────────┬──────────┘
                                     │
                    ┌────────────────┼────────────────┐
                    ▼                                 ▼
          ┌─────────────────┐               ┌─────────────────┐
          │  New User?      │               │ Existing User   │
          │  Register       │               │ Login           │
          └────────┬────────┘               └────────┬────────┘
                   │                                  │
                   ▼                                  ▼
          ┌─────────────────┐               ┌─────────────────┐
          │  Create Account │               │  Authenticate   │
          │  POST /register │               │  POST /login    │
          └────────┬────────┘               └────────┬────────┘
                   │                                  │
                   └──────────────┬───────────────────┘
                                  │
                                  ▼
                       ┌─────────────────────┐
                       │    DASHBOARD        │
                       │    /dashboard       │
                       └──────────┬──────────┘
                                  │
           ┌──────────────────────┼──────────────────────┐
           │                      │                      │
           ▼                      ▼                      ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   PORTFOLIOS    │    │    ANALYSIS     │    │    RESEARCH     │
│                 │    │                 │    │                 │
│ • View Holdings │    │ • Technicals    │    │ • Stock Search  │
│ • Add Stocks    │    │ • Options       │    │ • Peer Compare  │
│ • Performance   │    │ • Risk          │    │ • Insider Trade │
│ • Transactions  │    │ • Factors       │    │ • Earnings      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

---

## Data Flow: Technical Analysis Request

```
┌──────────────────────────────────────────────────────────────────────────┐
│                    TECHNICAL ANALYSIS DATA FLOW                          │
└──────────────────────────────────────────────────────────────────────────┘

   User                  Frontend               Backend              Yahoo Finance
    │                       │                      │                       │
    │  /technicals?symbol=AAPL                     │                       │
    │──────────────────────>│                      │                       │
    │                       │                      │                       │
    │                       │  GET /api/research/technicals/AAPL          │
    │                       │─────────────────────>│                       │
    │                       │                      │                       │
    │                       │                      │  1. Check Cache       │
    │                       │                      │  ┌──────────────┐    │
    │                       │                      │  │ Cached? No   │    │
    │                       │                      │  └──────┬───────┘    │
    │                       │                      │         │            │
    │                       │                      │  2. Fetch Quote      │
    │                       │                      │────────────────────> │
    │                       │                      │                      │
    │                       │                      │     Quote Data       │
    │                       │                      │ <────────────────────│
    │                       │                      │                      │
    │                       │                      │  3. Fetch History    │
    │                       │                      │────────────────────> │
    │                       │                      │                      │
    │                       │                      │    Historical Data   │
    │                       │                      │ <────────────────────│
    │                       │                      │                       │
    │                       │                      │  4. Calculate Indicators
    │                       │                      │  ┌────────────────────┐
    │                       │                      │  │ • RSI (14-period)  │
    │                       │                      │  │ • MACD (12,26,9)   │
    │                       │                      │  │ • Bollinger (20,2) │
    │                       │                      │  │ • SMA (20,50,200)  │
    │                       │                      │  │ • Stochastic       │
    │                       │                      │  │ • ADX              │
    │                       │                      │  └────────────────────┘
    │                       │                      │                       │
    │                       │    Technical Data    │                       │
    │                       │<─────────────────────│                       │
    │                       │                      │                       │
    │                       │  5. Render Template  │                       │
    │                       │  ┌────────────────────────────────────────┐ │
    │                       │  │ technicals.ejs                         │ │
    │                       │  │ • Inject data into template            │ │
    │                       │  │ • Generate Chart.js configurations     │ │
    │                       │  └────────────────────────────────────────┘ │
    │                       │                      │                       │
    │   HTML + Charts       │                      │                       │
    │<──────────────────────│                      │                       │
    │                       │                      │                       │
```

---

## Portfolio Management Flow

```
┌──────────────────────────────────────────────────────────────────────────┐
│                    PORTFOLIO MANAGEMENT FLOW                              │
└──────────────────────────────────────────────────────────────────────────┘

                        ┌─────────────────┐
                        │  USER ACTIONS   │
                        └────────┬────────┘
                                 │
         ┌───────────────────────┼───────────────────────┐
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ Create Portfolio│    │   Add Holding   │    │  Record Trade   │
└────────┬────────┘    └────────┬────────┘    └────────┬────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ POST /portfolios│    │POST /holdings   │    │POST /transactions│
│                 │    │                 │    │                 │
│ {               │    │ {               │    │ {               │
│   name,         │    │   symbol,       │    │   type,         │
│   description   │    │   shares,       │    │   shares,       │
│ }               │    │   costBasis     │    │   price,        │
│                 │    │ }               │    │   fees          │
└────────┬────────┘    └────────┬────────┘    │ }               │
         │                       │            └────────┬────────┘
         │                       │                     │
         └───────────────────────┼─────────────────────┘
                                 │
                                 ▼
                   ┌─────────────────────────┐
                   │      DATABASE           │
                   │                         │
                   │  ┌─────────────────┐   │
                   │  │   Portfolios    │   │
                   │  │   Table         │   │
                   │  └────────┬────────┘   │
                   │           │            │
                   │  ┌────────▼────────┐   │
                   │  │    Holdings     │   │
                   │  │    Table        │   │
                   │  └────────┬────────┘   │
                   │           │            │
                   │  ┌────────▼────────┐   │
                   │  │  Transactions   │   │
                   │  │    Table        │   │
                   │  └─────────────────┘   │
                   └─────────────────────────┘
                                 │
                                 ▼
                   ┌─────────────────────────┐
                   │   PORTFOLIO DASHBOARD   │
                   │                         │
                   │  ┌─────────────────┐   │
                   │  │   Holdings      │   │
                   │  │   + Real-time   │   │
                   │  │   Prices        │   │
                   │  └─────────────────┘   │
                   │                         │
                   │  ┌─────────────────┐   │
                   │  │   Performance   │   │
                   │  │   Metrics       │   │
                   │  └─────────────────┘   │
                   │                         │
                   │  ┌─────────────────┐   │
                   │  │   Allocation    │   │
                   │  │   Charts        │   │
                   │  └─────────────────┘   │
                   └─────────────────────────┘
```

---

## Analysis Module Structure

```
┌──────────────────────────────────────────────────────────────────────────┐
│                        ANALYSIS MODULES                                   │
└──────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                           FUNDAMENTALS                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐│
│  │  Analytics   │  │ Gross Margin │  │   Margin     │  │  Revenue/    ││
│  │  Dashboard   │  │  Analysis    │  │  Expansion   │  │  Employee    ││
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘│
│                                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐│
│  │ Price/Sales  │  │    Debt      │  │  Interest    │  │   Working    ││
│  │   Ratio      │  │  Maturity    │  │  Coverage    │  │   Capital    ││
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘│
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                            TECHNICAL                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐│
│  │  Technical   │  │  Fibonacci   │  │  Bollinger   │  │   Volume     ││
│  │  Analysis    │  │   Levels     │  │   Bands      │  │   Profile    ││
│  │              │  │              │  │              │  │              ││
│  │ • RSI        │  │ • 23.6%      │  │ • Upper Band │  │ • POC        ││
│  │ • MACD       │  │ • 38.2%      │  │ • Middle     │  │ • VAH        ││
│  │ • Stochastic │  │ • 50.0%      │  │ • Lower Band │  │ • VAL        ││
│  │ • ADX        │  │ • 61.8%      │  │ • %B         │  │              ││
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘│
│                                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐│
│  │   Moving     │  │  Stochastic  │  │     ADX      │  │    Float     ││
│  │  Averages    │  │  Oscillator  │  │  Indicator   │  │  Analysis    ││
│  │              │  │              │  │              │  │              ││
│  │ • SMA 20     │  │ • %K         │  │ • ADX Line   │  │ • Float %    ││
│  │ • SMA 50     │  │ • %D         │  │ • +DI        │  │ • Insider %  ││
│  │ • SMA 200    │  │ • Signal     │  │ • -DI        │  │ • Inst %     ││
│  │ • EMA        │  │              │  │              │  │              ││
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘│
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                             OPTIONS                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐│
│  │   Options    │  │   Options    │  │  Straddles   │  │ IV Surface   ││
│  │    Chain     │  │   Greeks     │  │              │  │              ││
│  │              │  │              │  │              │  │              ││
│  │ • Calls      │  │ • Delta (Δ)  │  │ • ATM        │  │ • Strike ×   ││
│  │ • Puts       │  │ • Gamma (Γ)  │  │   Straddle   │  │   Expiration ││
│  │ • Bid/Ask    │  │ • Theta (Θ)  │  │ • Cost       │  │ • IV Smile   ││
│  │ • Volume     │  │ • Vega (ν)   │  │ • Breakeven  │  │ • Term       ││
│  │ • Open Int   │  │ • Rho (ρ)    │  │              │  │   Structure  ││
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘│
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                              RISK                                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐│
│  │    Risk      │  │   Stress     │  │ Correlation  │  │   Factor     ││
│  │  Analysis    │  │    Test      │  │   Matrix     │  │  Analysis    ││
│  │              │  │              │  │              │  │              ││
│  │ • Beta       │  │ • 2008       │  │ • Heatmap    │  │ • Market β   ││
│  │ • Sharpe     │  │ • COVID      │  │ • Pairwise   │  │ • Size       ││
│  │ • VaR        │  │ • 2022       │  │ • Clustering │  │ • Value      ││
│  │ • Max DD     │  │ • Custom     │  │              │  │ • Momentum   ││
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘│
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                             RESEARCH                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐│
│  │   Stock      │  │    Peer      │  │   Insider    │  │  Earnings    ││
│  │  Compare     │  │  Comparison  │  │   Trading    │  │  Analysis    ││
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘│
│                                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                   │
│  │ Seasonality  │  │  Valuation   │  │   Analyst    │                   │
│  │              │  │   Metrics    │  │   Ratings    │                   │
│  └──────────────┘  └──────────────┘  └──────────────┘                   │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## Calculation Pipeline

```
┌──────────────────────────────────────────────────────────────────────────┐
│                     INDICATOR CALCULATION PIPELINE                        │
└──────────────────────────────────────────────────────────────────────────┘

Raw Price Data
      │
      ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          DATA PREPROCESSING                              │
│  • Sort by date                                                          │
│  • Handle missing values                                                 │
│  • Calculate returns: (P_t - P_{t-1}) / P_{t-1}                         │
│  • Calculate log returns: ln(P_t / P_{t-1})                             │
└─────────────────────────────────────────────────────────────────────────┘
      │
      ├──────────────────┬──────────────────┬──────────────────┐
      ▼                  ▼                  ▼                  ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│    RSI       │  │    MACD      │  │  Bollinger   │  │   Moving     │
│ Calculation  │  │ Calculation  │  │   Bands      │  │  Averages    │
├──────────────┤  ├──────────────┤  ├──────────────┤  ├──────────────┤
│              │  │              │  │              │  │              │
│ 1. Δ = P_t - │  │ 1. EMA(12)   │  │ 1. SMA(20)   │  │ 1. SMA(N) =  │
│    P_{t-1}   │  │    calc      │  │    calc      │  │    Σ(P)/N    │
│              │  │              │  │              │  │              │
│ 2. Gains =   │  │ 2. EMA(26)   │  │ 2. σ = std   │  │ 2. EMA(N) =  │
│    Δ > 0     │  │    calc      │  │    dev of    │  │    P×k +     │
│              │  │              │  │    last 20   │  │    EMA×(1-k) │
│ 3. Losses =  │  │ 3. MACD =    │  │              │  │              │
│    |Δ < 0|   │  │    EMA12 -   │  │ 3. Upper =   │  │ where k =    │
│              │  │    EMA26     │  │    SMA + 2σ  │  │    2/(N+1)   │
│ 4. Avg Gain  │  │              │  │              │  │              │
│    Avg Loss  │  │ 4. Signal =  │  │ 4. Lower =   │  │              │
│    (14 per)  │  │    EMA(9) of │  │    SMA - 2σ  │  │              │
│              │  │    MACD      │  │              │  │              │
│ 5. RS =      │  │              │  │              │  │              │
│    AG/AL     │  │ 5. Hist =    │  │              │  │              │
│              │  │    MACD -    │  │              │  │              │
│ 6. RSI =     │  │    Signal    │  │              │  │              │
│   100 -      │  │              │  │              │  │              │
│   100/(1+RS) │  │              │  │              │  │              │
└──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘
      │                  │                  │                  │
      └──────────────────┴──────────────────┴──────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         SIGNAL GENERATION                                │
│                                                                          │
│  RSI:          < 30 = Oversold (BUY)    > 70 = Overbought (SELL)        │
│  MACD:         Cross above signal (BUY)  Cross below signal (SELL)      │
│  Bollinger:    Touch lower band (BUY)    Touch upper band (SELL)        │
│  MA Cross:     Short > Long (BUY)        Short < Long (SELL)            │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         TRADING SIGNAL                                   │
│                                                                          │
│           BULLISH / BEARISH / NEUTRAL                                    │
│                                                                          │
│  Combined score from all indicators with configurable weights            │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## Options Greeks Calculation Flow

```
┌──────────────────────────────────────────────────────────────────────────┐
│                    OPTIONS GREEKS CALCULATION                             │
└──────────────────────────────────────────────────────────────────────────┘

                              INPUT PARAMETERS
                                     │
           ┌─────────────────────────┼─────────────────────────┐
           │                         │                         │
           ▼                         ▼                         ▼
    ┌─────────────┐          ┌─────────────┐          ┌─────────────┐
    │ Stock Price │          │ Strike (K)  │          │   Time (T)  │
    │    (S)      │          │             │          │  (in years) │
    └─────────────┘          └─────────────┘          └─────────────┘
           │                         │                         │
           │         ┌───────────────┼───────────────┐         │
           │         │               │               │         │
           │         ▼               ▼               ▼         │
           │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐  │
           │  │   Risk-Free │ │  Implied    │ │  Dividend   │  │
           │  │   Rate (r)  │ │  Vol (σ)    │ │  Yield (q)  │  │
           │  └─────────────┘ └─────────────┘ └─────────────┘  │
           │         │               │               │         │
           └─────────┴───────────────┴───────────────┴─────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                      BLACK-SCHOLES CALCULATION                           │
│                                                                          │
│   d1 = [ln(S/K) + (r - q + σ²/2)T] / (σ√T)                             │
│                                                                          │
│   d2 = d1 - σ√T                                                         │
│                                                                          │
│   N(x) = Cumulative standard normal distribution                         │
│   N'(x) = Standard normal probability density function                   │
└─────────────────────────────────────────────────────────────────────────┘
                                     │
           ┌─────────────────────────┼─────────────────────────┐
           │                         │                         │
           ▼                         ▼                         ▼
    ┌─────────────┐          ┌─────────────┐          ┌─────────────┐
    │   DELTA     │          │   GAMMA     │          │   THETA     │
    │             │          │             │          │             │
    │ Call: N(d1) │          │    N'(d1)   │          │  See full   │
    │ Put: N(d1)-1│          │  ─────────  │          │  formula    │
    │             │          │  S×σ×√T     │          │  in docs    │
    └─────────────┘          └─────────────┘          └─────────────┘
           │                         │                         │
           │                         │                         │
           ▼                         ▼                         ▼
    ┌─────────────┐          ┌─────────────┐          ┌─────────────┐
    │   VEGA      │          │    RHO      │          │   LAMBDA    │
    │             │          │             │          │             │
    │ S×√T×N'(d1) │          │ K×T×e^(-rT) │          │  Δ × S / V  │
    │  ─────────  │          │    × N(d2)  │          │  (leverage) │
    │     100     │          │             │          │             │
    └─────────────┘          └─────────────┘          └─────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        GREEK INTERPRETATION                              │
│                                                                          │
│  Delta: $X change in option for $1 change in stock                      │
│  Gamma: Rate of change of Delta                                          │
│  Theta: Time decay per day (negative for long options)                   │
│  Vega:  $X change in option for 1% change in IV                         │
│  Rho:   $X change in option for 1% change in interest rate              │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## Risk Analysis Pipeline

```
┌──────────────────────────────────────────────────────────────────────────┐
│                       RISK ANALYSIS PIPELINE                              │
└──────────────────────────────────────────────────────────────────────────┘

Portfolio Holdings
       │
       ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                    FETCH HISTORICAL DATA                                  │
│                                                                          │
│  For each holding:                                                        │
│  • Get 252 trading days of prices                                        │
│  • Calculate daily returns                                                │
│  • Fetch benchmark (S&P 500) returns                                     │
└──────────────────────────────────────────────────────────────────────────┘
       │
       ├──────────────────┬──────────────────┬──────────────────┐
       ▼                  ▼                  ▼                  ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│    BETA      │  │   SHARPE     │  │     VaR      │  │   MAX DD     │
│              │  │    RATIO     │  │              │  │              │
├──────────────┤  ├──────────────┤  ├──────────────┤  ├──────────────┤
│              │  │              │  │              │  │              │
│ Cov(R_p,R_m) │  │  R_p - R_f   │  │ Historical:  │  │ For each t:  │
│ ───────────  │  │ ─────────   │  │ Sort returns │  │              │
│   Var(R_m)   │  │    σ_p      │  │ Find 5th     │  │ Peak = max   │
│              │  │              │  │ percentile   │  │   to date    │
│              │  │              │  │              │  │              │
│              │  │              │  │ Parametric:  │  │ DD = (Peak - │
│              │  │              │  │ μ - 1.65σ    │  │  Current)    │
│              │  │              │  │              │  │  / Peak      │
│              │  │              │  │              │  │              │
│              │  │              │  │              │  │ Max DD =     │
│              │  │              │  │              │  │  max(DD)     │
└──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘
       │                  │                  │                  │
       └──────────────────┴──────────────────┴──────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         STRESS TESTING                                   │
│                                                                          │
│  Apply historical scenarios:                                             │
│                                                                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │
│  │ 2008 Crisis │  │ COVID Crash │  │ 2022 Bear   │  │   Custom    │   │
│  │   -38.5%    │  │   -33.9%    │  │   -18.1%    │  │  Scenario   │   │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │
│                                                                          │
│  Impact = Portfolio Value × Scenario Return × Portfolio Beta             │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                       RISK DASHBOARD OUTPUT                              │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    RISK METRICS SUMMARY                          │   │
│  │                                                                   │   │
│  │  Beta: 1.15        Sharpe: 1.42        Alpha: 2.3%               │   │
│  │  VaR (95%): $12,450    Max Drawdown: -18.5%                      │   │
│  │                                                                   │   │
│  │  Stress Test Results:                                             │   │
│  │  • 2008 Scenario: -$44,275 (-38.5%)                              │   │
│  │  • COVID Scenario: -$39,027 (-33.9%)                             │   │
│  │  • 2022 Scenario: -$20,855 (-18.1%)                              │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## API Request/Response Flow

```
┌──────────────────────────────────────────────────────────────────────────┐
│                    API REQUEST/RESPONSE FLOW                              │
└──────────────────────────────────────────────────────────────────────────┘

                          HTTP REQUEST
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          MIDDLEWARE CHAIN                                │
│                                                                          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │   CORS   │─>│  Logger  │─>│  Rate    │─>│   Auth   │─>│  Parse   │ │
│  │          │  │          │  │  Limiter │  │   JWT    │  │   JSON   │ │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          ROUTE HANDLER                                   │
│                                                                          │
│  Example: GET /api/research/technicals/:symbol                          │
│                                                                          │
│  1. Extract parameters (symbol)                                          │
│  2. Validate input                                                       │
│  3. Call service layer                                                   │
└─────────────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         SERVICE LAYER                                    │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                   TechnicalAnalysisService                       │   │
│  │                                                                   │   │
│  │  async analyzeTechnicals(symbol) {                               │   │
│  │    1. Check cache for existing data                              │   │
│  │    2. If miss → fetch from Yahoo Finance                         │   │
│  │    3. Calculate all technical indicators                         │   │
│  │    4. Generate trading signals                                   │   │
│  │    5. Cache results                                              │   │
│  │    6. Return analysis object                                     │   │
│  │  }                                                                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                       JSON RESPONSE                                      │
│                                                                          │
│  {                                                                        │
│    "symbol": "AAPL",                                                     │
│    "price": 178.50,                                                      │
│    "indicators": {                                                        │
│      "rsi": { "value": 58.2, "signal": "neutral" },                     │
│      "macd": { "value": 1.23, "signal": "bullish" },                    │
│      "bollinger": { "upper": 185, "middle": 175, "lower": 165 }         │
│    },                                                                     │
│    "overallSignal": "BULLISH",                                           │
│    "lastUpdated": "2024-12-17T10:30:00Z"                                │
│  }                                                                        │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## Database Operations

```
┌──────────────────────────────────────────────────────────────────────────┐
│                      DATABASE OPERATIONS                                  │
└──────────────────────────────────────────────────────────────────────────┘

                        APPLICATION
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         PRISMA ORM                                       │
│                                                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │                        CRUD Operations                             │ │
│  │                                                                     │ │
│  │  CREATE:  prisma.portfolio.create({ data: {...} })                │ │
│  │  READ:    prisma.portfolio.findMany({ where: {...} })             │ │
│  │  UPDATE:  prisma.portfolio.update({ where: {...}, data: {...} })  │ │
│  │  DELETE:  prisma.portfolio.delete({ where: {...} })               │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │                       Relations & Joins                            │ │
│  │                                                                     │ │
│  │  prisma.portfolio.findUnique({                                     │ │
│  │    where: { id: portfolioId },                                     │ │
│  │    include: {                                                       │ │
│  │      holdings: {                                                    │ │
│  │        include: { transactions: true }                             │ │
│  │      }                                                              │ │
│  │    }                                                                │ │
│  │  })                                                                 │ │
│  └───────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          SQLite DATABASE                                 │
│                                                                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │
│  │    User     │  │  Portfolio  │  │   Holding   │  │ Transaction │   │
│  │   Table     │──│   Table     │──│   Table     │──│   Table     │   │
│  │             │  │             │  │             │  │             │   │
│  │ id          │  │ id          │  │ id          │  │ id          │   │
│  │ email       │  │ userId (FK) │  │ portfolioId │  │ holdingId   │   │
│  │ password    │  │ name        │  │ symbol      │  │ type        │   │
│  │ name        │  │ description │  │ shares      │  │ shares      │   │
│  │ createdAt   │  │ createdAt   │  │ costBasis   │  │ price       │   │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │
│                                                                          │
│  File: backend/data/wealthpilot.db                                      │
└─────────────────────────────────────────────────────────────────────────┘
```

---

*Document Version: 1.0*
*Last Updated: December 2024*
