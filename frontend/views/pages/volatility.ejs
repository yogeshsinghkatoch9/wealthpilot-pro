<%- include('../partials/header', { pageTitle: 'Volatility Analysis' }) %>

<div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
<div><h1 class="text-2xl font-bold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">Volatility Analysis</h1><p class="<%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Historical & implied volatility metrics</p></div>
<div class="flex gap-2">
<select class="form-input w-32"><option selected>My Holdings</option><option>Watchlist</option></select>
<select class="form-input w-28"><option>30 Days</option><option selected>90 Days</option><option>1 Year</option></select>
</div>
</div>

<!-- Volatility Overview -->
<div class="card p-5 bg-gradient-to-r <%= theme === 'light' ? 'from-green-50 to-red-50' : 'from-green-900/20 to-red-900/20' %>">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Portfolio Volatility Summary</h3>
<div class="grid grid-cols-2 md:grid-cols-5 gap-4">
<div class="text-center">
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Portfolio Vol</p>
<p class="text-3xl font-bold text-green-400">18.4%</p>
<p class="text-xs text-green-400">Annualized</p>
</div>
<div class="text-center">
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">vs S&P 500</p>
<p class="text-3xl font-bold text-red-400">+4.2%</p>
<p class="text-xs">(S&P: 14.2%)</p>
</div>
<div class="text-center">
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Most Volatile</p>
<p class="text-3xl font-bold text-red-400">TSLA</p>
<p class="text-xs text-red-400">52.4% vol</p>
</div>
<div class="text-center">
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Least Volatile</p>
<p class="text-3xl font-bold text-emerald-400">JNJ</p>
<p class="text-xs text-emerald-400">14.2% vol</p>
</div>
<div class="text-center">
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">VIX Level</p>
<p class="text-3xl font-bold text-sky-400">14.8</p>
<p class="text-xs text-emerald-400">Low fear</p>
</div>
</div>
</div>

<!-- Volatility Charts -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div class="card p-5">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Historical Volatility (90-Day)</h3>
<div class="h-64"><canvas id="hvChart"></canvas></div>
</div>
<div class="card p-5">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Volatility vs Return</h3>
<div class="h-64"><canvas id="scatterChart"></canvas></div>
</div>
</div>

<!-- Holdings Volatility Table -->
<div class="card overflow-hidden">
<div class="p-4 border-b <%= theme === 'light' ? 'border-gray-200' : 'border-slate-700' %>">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">Holdings Volatility Metrics</h3>
</div>
<table class="w-full text-sm">
<thead>
<tr class="<%= theme === 'light' ? 'bg-gray-50 text-gray-500' : 'bg-slate-800 text-slate-400' %> text-left">
<th class="px-4 py-3">Stock</th>
<th class="px-4 py-3 text-center">30D Vol</th>
<th class="px-4 py-3 text-center">90D Vol</th>
<th class="px-4 py-3 text-center">1Y Vol</th>
<th class="px-4 py-3 text-center">IV (Options)</th>
<th class="px-4 py-3 text-center">IV Rank</th>
<th class="px-4 py-3 text-center">Beta</th>
<th class="px-4 py-3 text-center">Risk Level</th>
</tr>
</thead>
<tbody class="<%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white text-xs font-bold">TSLA</div><span class="font-medium">Tesla</span></div></td>
<td class="px-4 py-3 text-center text-red-400 font-bold">58.2%</td>
<td class="px-4 py-3 text-center text-red-400 font-bold">52.4%</td>
<td class="px-4 py-3 text-center text-red-400">48.8%</td>
<td class="px-4 py-3 text-center text-green-400">62.4%</td>
<td class="px-4 py-3 text-center">72%</td>
<td class="px-4 py-3 text-center text-red-400">2.12</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-red-500/20 text-red-400 text-xs">VERY HIGH</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold">NVDA</div><span class="font-medium">NVIDIA</span></div></td>
<td class="px-4 py-3 text-center text-red-400 font-bold">48.4%</td>
<td class="px-4 py-3 text-center text-green-400">42.8%</td>
<td class="px-4 py-3 text-center text-green-400">45.2%</td>
<td class="px-4 py-3 text-center text-green-400">54.2%</td>
<td class="px-4 py-3 text-center">58%</td>
<td class="px-4 py-3 text-center text-red-400">1.84</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-red-500/20 text-red-400 text-xs">HIGH</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">AAPL</div><span class="font-medium">Apple</span></div></td>
<td class="px-4 py-3 text-center">24.8%</td>
<td class="px-4 py-3 text-center">22.4%</td>
<td class="px-4 py-3 text-center">24.2%</td>
<td class="px-4 py-3 text-center">26.8%</td>
<td class="px-4 py-3 text-center">42%</td>
<td class="px-4 py-3 text-center">1.18</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-green-500/20 text-green-400 text-xs">MODERATE</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-sky-500 to-sky-600 flex items-center justify-center text-white text-xs font-bold">MSFT</div><span class="font-medium">Microsoft</span></div></td>
<td class="px-4 py-3 text-center">22.4%</td>
<td class="px-4 py-3 text-center">20.8%</td>
<td class="px-4 py-3 text-center">22.6%</td>
<td class="px-4 py-3 text-center">24.2%</td>
<td class="px-4 py-3 text-center">38%</td>
<td class="px-4 py-3 text-center">1.08</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-green-500/20 text-green-400 text-xs">MODERATE</span></td>
</tr>
<tr class="border-b <%= theme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center text-white text-xs font-bold">JNJ</div><span class="font-medium">J&J</span></div></td>
<td class="px-4 py-3 text-center text-emerald-400">12.8%</td>
<td class="px-4 py-3 text-center text-emerald-400 font-bold">14.2%</td>
<td class="px-4 py-3 text-center text-emerald-400">15.4%</td>
<td class="px-4 py-3 text-center text-emerald-400">16.8%</td>
<td class="px-4 py-3 text-center">25%</td>
<td class="px-4 py-3 text-center text-emerald-400">0.62</td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 text-xs">LOW</span></td>
</tr>
</tbody>
</table>
</div>

<!-- Volatility Insights -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div class="card p-5">
<h4 class="font-bold text-red-400 mb-3">ðŸ”´ High Volatility Alert</h4>
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %> mb-3">TSLA & NVDA contribute 42% of portfolio volatility</p>
<p class="text-xs">Consider position sizing adjustments</p>
</div>
<div class="card p-5">
<h4 class="font-bold text-sky-400 mb-3">ðŸ“Š IV vs HV Spread</h4>
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %> mb-3">NVDA: IV 54% vs HV 43% = +11% premium</p>
<p class="text-xs text-emerald-400">Opportunity: Sell options premium</p>
</div>
<div class="card p-5">
<h4 class="font-bold text-emerald-400 mb-3">âœ… Volatility Dampeners</h4>
<p class="text-sm <%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %> mb-3">JNJ, KO reduce overall portfolio vol by 3.2%</p>
<p class="text-xs">Defensive positions working</p>
</div>
</div>

<!-- Volatility Term Structure -->
<div class="card p-5">
<h3 class="font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Volatility Term Structure</h3>
<div class="h-48"><canvas id="termChart"></canvas></div>
</div>
</div></div></main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Chart(document.getElementById('hvChart'), {
  type: 'bar',
  data: { labels: ['TSLA','NVDA','AMD','AAPL','MSFT','GOOGL','JNJ','KO'], datasets: [{ label: '90D Vol', data: [52.4,42.8,38.4,22.4,20.8,24.2,14.2,12.8], backgroundColor: ctx => ctx.raw > 40 ? '#ef4444' : ctx.raw > 25 ? '#f59e0b' : '#10b981' }] },
  options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
});
new Chart(document.getElementById('scatterChart'), {
  type: 'scatter',
  data: { datasets: [{ label: 'Holdings', data: [{x:52.4,y:42},{x:42.8,y:180},{x:22.4,y:25},{x:20.8,y:18},{x:14.2,y:8}], backgroundColor: '#8b5cf6', pointRadius: 8 }] },
  options: { responsive: true, maintainAspectRatio: false, scales: { x: { title: { display: true, text: 'Volatility %' } }, y: { title: { display: true, text: 'YTD Return %' } } } }
});
new Chart(document.getElementById('termChart'), {
  type: 'line',
  data: { labels: ['1W','2W','1M','2M','3M','6M','1Y'], datasets: [
    { label: 'NVDA IV', data: [48,50,52,54,55,56,58], borderColor: '#8b5cf6', fill: false },
    { label: 'AAPL IV', data: [24,25,26,27,27,28,28], borderColor: '#0ea5e9', fill: false },
    { label: 'VIX', data: [14,15,15,16,16,17,17], borderColor: '#f59e0b', fill: false, borderDash: [5,5] }
  ]},
  options: { responsive: true, maintainAspectRatio: false }
});
</script>
<%- include('../partials/footer') %>
