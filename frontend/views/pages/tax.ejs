<%- include('../partials/header', { pageTitle: 'Tax Optimization' }) %>
<main class="p-4 lg:p-6"><div class="max-w-7xl mx-auto space-y-6">
<div class="flex items-center justify-between"><div><h1 class="text-2xl font-bold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %>">Tax Optimization</h1><p class="<%= theme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Tax-loss harvesting</p></div><form method="GET"><select name="portfolio" onchange="this.form.submit()" class="form-input w-48"><% portfolios.forEach(p => { %><option value="<%= p.id %>" <%= selectedPid == p.id ? 'selected' : '' %>><%= p.name %></option><% }) %></select></form></div>
<% if (taxData) { %>
<div class="grid grid-cols-2 lg:grid-cols-4 gap-4"><div class="card p-5"><p class="<%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %> text-sm mb-1">Harvestable</p><p class="text-2xl font-bold text-amber-400"><%= fmt.money(taxData.summary?.total_harvestable_losses) %></p></div><div class="card p-5"><p class="<%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %> text-sm mb-1">Tax Savings</p><p class="text-2xl font-bold text-emerald-400"><%= fmt.money(taxData.summary?.potential_tax_savings) %></p></div><div class="card p-5"><p class="<%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %> text-sm mb-1">Opportunities</p><p class="text-2xl font-bold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %>"><%= taxData.summary?.opportunities_count %></p></div><div class="card p-5"><p class="<%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %> text-sm mb-1">Tax Bracket</p><p class="text-2xl font-bold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %>"><%= taxData.summary?.tax_bracket %>%</p></div></div>
<div class="card p-5 bg-amber-500/10 border-amber-500/30"><div class="flex items-start gap-3"><svg class="w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg><div><h4 class="font-semibold text-amber-400">Wash Sale Warning</h4><p class="<%= theme === 'light' ? 'text-gray-700' : 'text-slate-300' %> text-sm mt-1"><%= taxData.wash_sale_warning %></p></div></div></div>
<div class="card p-5"><h3 class="text-lg font-semibold <%= theme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Opportunities</h3><% if (taxData.opportunities && taxData.opportunities.length > 0) { %><div class="space-y-4"><% taxData.opportunities.forEach(o => { %><div class="p-4 <%= theme === 'light' ? 'bg-gray-100' : 'bg-slate-800/50' %> rounded-xl"><div class="flex items-center justify-between mb-3"><div class="flex items-center gap-3"><div class="w-12 h-12 rounded-xl bg-red-500/20 flex items-center justify-center text-red-400 font-bold text-lg"><%= o.symbol ? o.symbol.slice(0, 2) : '??' %></div><div><p class="<%= theme === 'light' ? 'text-gray-900' : 'text-white' %> font-semibold"><%= o.symbol %></p><p class="<%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %> text-sm"><%= o.name %></p></div></div><div class="text-right"><p class="text-red-400 font-bold text-lg">-<%= fmt.money(o.unrealized_loss) %></p><p class="text-emerald-400 text-sm">Save <%= fmt.money(o.tax_savings) %></p></div></div><div class="flex items-center justify-between text-sm"><span class="<%= o.holding_period === 'long-term' ? 'badge-info' : 'badge-warning' %>"><%= o.holding_period %></span><span class="<%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">Wash sale ends: <span class="<%= theme === 'light' ? 'text-gray-900' : 'text-white' %>"><%= o.wash_sale_end %></span></span></div></div><% }) %></div><% } else { %><p class="text-center py-8 <%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">No opportunities</p><% } %></div>
<% } else { %><div class="card p-12 text-center"><p class="<%= theme === 'light' ? 'text-gray-500' : 'text-slate-400' %>">Select a portfolio</p></div><% } %>
</div></div></main>
<%- include('../partials/footer') %>
