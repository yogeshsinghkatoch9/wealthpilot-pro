<%
// Safe defaults for potentially undefined variables
const safeTheme = typeof theme !== 'undefined' ? theme : 'dark';
%>
<%- include('../partials/header', { pageTitle: 'Insider Sentiment' }) %>

<div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
<div><h1 class="text-2xl font-bold <%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %>">Insider Sentiment</h1><p class="<%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Aggregate insider buying & selling signals</p></div>
<div class="flex gap-2">
<select class="form-input w-32"><option selected>My Holdings</option><option>Watchlist</option><option>S&P 500</option></select>
<select class="form-input w-28"><option selected>90 Days</option><option>30 Days</option><option>1 Year</option></select>
</div>
</div>

<!-- Sentiment Overview -->
<div class="tufte-stat-card p-5 <%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>">
<h3 class="font-semibold <%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Portfolio Insider Sentiment</h3>
<div class="grid grid-cols-2 md:grid-cols-5 gap-4">
<div class="text-center">
<p class="text-sm <%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Net Sentiment</p>
<p class="text-3xl font-bold text-emerald-400">BULLISH</p>
<p class="text-xs text-emerald-400">Score: 72/100</p>
</div>
<div class="text-center">
<p class="text-sm <%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Buy Transactions</p>
<p class="text-3xl font-bold text-emerald-400">48</p>
<p class="text-xs text-emerald-400">$124.8M value</p>
</div>
<div class="text-center">
<p class="text-sm <%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Sell Transactions</p>
<p class="text-3xl font-bold text-red-400">32</p>
<p class="text-xs text-red-400">$86.4M value</p>
</div>
<div class="text-center">
<p class="text-sm <%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Buy/Sell Ratio</p>
<p class="text-3xl font-bold text-emerald-400">1.44</p>
<p class="text-xs text-emerald-400">Above average</p>
</div>
<div class="text-center">
<p class="text-sm <%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Cluster Buys</p>
<p class="text-3xl font-bold text-purple-400">3</p>
<p class="text-xs text-purple-400">Strong signal</p>
</div>
</div>
</div>

<!-- Sentiment by Holding -->
<div class="tufte-stat-card overflow-hidden">
<div class="p-4 border-b <%= safeTheme === 'light' ? 'border-gray-200' : 'border-slate-700' %>">
<h3 class="font-semibold <%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %>">Insider Sentiment by Holding</h3>
</div>
<table class="w-full text-sm">
<thead>
<tr class="<%= safeTheme === 'light' ? 'bg-gray-50 text-gray-500' : 'bg-slate-800 text-slate-400' %> text-left">
<th class="px-4 py-3">Stock</th>
<th class="px-4 py-3 text-center">Sentiment</th>
<th class="px-4 py-3 text-center">Buys</th>
<th class="px-4 py-3 text-center">Sells</th>
<th class="px-4 py-3 text-center">Net Value</th>
<th class="px-4 py-3">Trend</th>
<th class="px-4 py-3 text-center">Signal</th>
</tr>
</thead>
<tbody class="<%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %>">
<tr class="border-b <%= safeTheme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded <%= safeTheme === 'light' ? 'bg-gray-100' : 'bg-slate-800' %> flex items-center justify-center <%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %> text-xs font-bold">NVDA</div><span class="font-medium">NVIDIA</span></div></td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded <%= safeTheme === 'light' ? 'bg-gray-100 text-gray-900' : 'bg-slate-800 text-white' %> text-xs font-bold">VERY BULLISH</span></td>
<td class="px-4 py-3 text-center positive font-bold">12</td>
<td class="px-4 py-3 text-center text-red-400">2</td>
<td class="px-4 py-3 text-center positive font-bold">+$42.8M</td>
<td class="px-4 py-3"><div class="flex gap-1"><span class="text-emerald-400">▲</span><span class="text-emerald-400">▲</span><span class="text-emerald-400">▲</span><span class="text-emerald-400">▲</span><span class="<%= safeTheme === 'light' ? 'text-gray-300' : 'text-slate-600' %>">▲</span></div></td>
<td class="px-4 py-3 text-center"></td>
</tr>
<tr class="border-b <%= safeTheme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded <%= safeTheme === 'light' ? 'bg-gray-100' : 'bg-slate-800' %> flex items-center justify-center text-white text-xs font-bold">AAPL</div><span class="font-medium">Apple</span></div></td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded <%= safeTheme === 'light' ? 'bg-gray-100 text-gray-900' : 'bg-slate-800 text-white' %> text-xs font-bold">NEUTRAL</span></td>
<td class="px-4 py-3 text-center text-emerald-400">5</td>
<td class="px-4 py-3 text-center text-red-400">6</td>
<td class="px-4 py-3 text-center negative">-$8.2M</td>
<td class="px-4 py-3"><div class="flex gap-1"><span class="text-green-400">▲</span><span class="text-red-400">▼</span><span class="text-emerald-400">▲</span><span class="text-red-400">▼</span><span class="text-green-400">▲</span></div></td>
<td class="px-4 py-3 text-center"></td>
</tr>
<tr class="border-b <%= safeTheme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded <%= safeTheme === 'light' ? 'bg-gray-100' : 'bg-slate-800' %> flex items-center justify-center text-white text-xs font-bold">MSFT</div><span class="font-medium">Microsoft</span></div></td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded <%= safeTheme === 'light' ? 'bg-gray-100 text-gray-900' : 'bg-slate-800 text-white' %> text-xs font-bold">BULLISH</span></td>
<td class="px-4 py-3 text-center positive font-bold">8</td>
<td class="px-4 py-3 text-center text-red-400">3</td>
<td class="px-4 py-3 text-center positive font-bold">+$18.4M</td>
<td class="px-4 py-3"><div class="flex gap-1"><span class="text-emerald-400">▲</span><span class="text-emerald-400">▲</span><span class="text-emerald-400">▲</span><span class="text-<%= safeTheme === 'light' ? 'gray-300' : 'slate-600' %>">▲</span><span class="<%= safeTheme === 'light' ? 'text-gray-300' : 'text-slate-600' %>">▲</span></div></td>
<td class="px-4 py-3 text-center"></td>
</tr>
<tr class="border-b <%= safeTheme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded <%= safeTheme === 'light' ? 'bg-gray-100' : 'bg-slate-800' %> flex items-center justify-center text-white text-xs font-bold">TSLA</div><span class="font-medium">Tesla</span></div></td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded <%= safeTheme === 'light' ? 'bg-gray-100 text-gray-900' : 'bg-slate-800 text-white' %> text-xs font-bold">BEARISH</span></td>
<td class="px-4 py-3 text-center text-emerald-400">1</td>
<td class="px-4 py-3 text-center negative font-bold">8</td>
<td class="px-4 py-3 text-center negative font-bold">-$124.6M</td>
<td class="px-4 py-3"><div class="flex gap-1"><span class="text-red-400">▼</span><span class="text-red-400">▼</span><span class="text-red-400">▼</span><span class="text-red-400">▼</span><span class="text-red-400">▼</span></div></td>
<td class="px-4 py-3 text-center"></td>
</tr>
<tr class="border-b <%= safeTheme === 'light' ? 'border-gray-100' : 'border-slate-700/50' %>">
<td class="px-4 py-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded <%= safeTheme === 'light' ? 'bg-gray-100' : 'bg-slate-800' %> flex items-center justify-center text-white text-xs font-bold">JNJ</div><span class="font-medium">J&J</span></div></td>
<td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded <%= safeTheme === 'light' ? 'bg-gray-100 text-gray-900' : 'bg-slate-800 text-white' %> text-xs font-bold">BULLISH</span></td>
<td class="px-4 py-3 text-center positive font-bold">6</td>
<td class="px-4 py-3 text-center text-red-400">2</td>
<td class="px-4 py-3 text-center positive font-bold">+$4.2M</td>
<td class="px-4 py-3"><div class="flex gap-1"><span class="text-emerald-400">▲</span><span class="text-emerald-400">▲</span><span class="text-emerald-400">▲</span><span class="text-<%= safeTheme === 'light' ? 'gray-300' : 'slate-600' %>">▲</span><span class="<%= safeTheme === 'light' ? 'text-gray-300' : 'text-slate-600' %>">▲</span></div></td>
<td class="px-4 py-3 text-center"></td>
</tr>
</tbody>
</table>
</div>

<!-- Cluster Buys -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div class="tufte-stat-card p-5">
<h3 class="font-semibold <%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Cluster Buy Signals</h3>
<p class="text-sm <%= safeTheme === 'light' ? 'text-gray-500' : 'text-slate-400' %> mb-4">3+ insiders buying within 30 days</p>
<div class="space-y-3">
<div class="p-4 rounded-lg border-2 border-emerald-500 <%= safeTheme === 'light' ? '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>' : '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>0/10' %>">
<div class="flex justify-between items-center mb-2"><span class="font-bold">NVDA</span><span class="positive font-bold">5 insiders</span></div>
<p class="text-sm <%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">CEO, CFO, 3 Directors bought $28.4M in Nov</p>
<p class="text-xs text-emerald-400 mt-1">Strong conviction signal</p>
</div>
<div class="p-4 rounded-lg border-2 border-emerald-500 <%= safeTheme === 'light' ? '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>' : '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>0/10' %>">
<div class="flex justify-between items-center mb-2"><span class="font-bold">MSFT</span><span class="positive font-bold">3 insiders</span></div>
<p class="text-sm <%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">CFO, 2 VPs bought $12.8M in Oct</p>
<p class="text-xs text-emerald-400 mt-1">Moderate conviction signal</p>
</div>
<div class="p-4 rounded-lg border-2 border-emerald-500 <%= safeTheme === 'light' ? '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>' : '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>0/10' %>">
<div class="flex justify-between items-center mb-2"><span class="font-bold">JNJ</span><span class="positive font-bold">4 insiders</span></div>
<p class="text-sm <%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">CEO, COO, 2 Directors bought $3.8M in Dec</p>
<p class="text-xs text-emerald-400 mt-1">Recent cluster - watch closely</p>
</div>
</div>
</div>
<div class="tufte-stat-card p-5">
<h3 class="font-semibold <%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Insider Activity Trend</h3>
<div class="h-64"><canvas id="trendChart"></canvas></div>
</div>
</div>

<!-- Recent Transactions -->
<div class="tufte-stat-card p-5">
<h3 class="font-semibold <%= safeTheme === 'light' ? 'text-gray-900' : 'text-white' %> mb-4">Recent Insider Transactions</h3>
<div class="space-y-2">
<div class="flex items-center justify-between p-3 rounded-lg <%= safeTheme === 'light' ? '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>' : '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>0/10' %>">
<div class="flex items-center gap-3"><span class="font-bold">NVDA</span><span class="<%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Jensen Huang (CEO)</span></div>
<div class="text-right"><span class="positive font-bold">BUY $8.4M</span><span class="text-xs ml-2">Dec 8</span></div>
</div>
<div class="flex items-center justify-between p-3 rounded-lg <%= safeTheme === 'light' ? '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>' : '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>0/10' %>">
<div class="flex items-center gap-3"><span class="font-bold">TSLA</span><span class="<%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Elon Musk (CEO)</span></div>
<div class="text-right"><span class="negative font-bold">SELL $42.8M</span><span class="text-xs ml-2">Dec 5</span></div>
</div>
<div class="flex items-center justify-between p-3 rounded-lg <%= safeTheme === 'light' ? '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>' : '<%= safeTheme === 'light' ? 'bg-gray-50' : 'bg-slate-800/50' %>0/10' %>">
<div class="flex items-center gap-3"><span class="font-bold">JNJ</span><span class="<%= safeTheme === 'light' ? 'text-gray-600' : 'text-slate-400' %>">Joaquin Duato (CEO)</span></div>
<div class="text-right"><span class="positive font-bold">BUY $1.2M</span><span class="text-xs ml-2">Dec 4</span></div>
</div>
</div>
</div>
</div></div></main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Chart(document.getElementById('trendChart'), {
  type: 'bar',
  data: {
    labels: ['Jul','Aug','Sep','Oct','Nov','Dec'],
    datasets: [
      { label: 'Buys', data: [12,8,15,22,28,18], backgroundColor: '#10b981' },
      { label: 'Sells', data: [-8,-12,-10,-14,-18,-12], backgroundColor: '#ef4444' }
    ]
  },
  options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
});
</script>
<%- include('../partials/footer') %>
